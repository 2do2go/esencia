{"version":3,"sources":["lib/classes/collection.js","lib/classes/componentsManager.js","lib/classes/model.js","lib/classes/router.js","lib/classes/view.js","lib/esencia.js","lib/utils/componentsManager.js","lib/utils/exec.js","lib/utils/extend.js"],"names":["_","_require","backbone","execUtils","Collection","sync","method","collection","options","prepareOptions","getFakeBaseMethod","prototype","call","exec","extend","parse","success","resp","fetch","reset","context","trigger","wrapError","module","exports","View","isTreeNodeChanged","oldNode","node","Boolean","component","name","view","isWaiting","attached","isUnchanged","ComponentsManager","pick","componentManagerOptions","components","tree","currentNames","autoAddRoot","_addRoot","initialize","apply","arguments","componentOptions","Events","rootEl","defaultParent","undefined","RootView","el","add","parent","defaults","load","hasName","has","hasContainer","hasParent","isString","isRoot","isNull","hasDefaultParent","Error","isUndefined","container","uniqueId","default","get","remove","names","callback","isFunction","noop","isArray","length","_buildTree","oldTree","_applyTree","children","self","buildHashedTree","parentNames","nodes","chain","uniq","map","push","compact","value","each","find","child","isEmpty","filter","some","params","afterCallback","after","iterate","oldChildren","setData","setView","renderViews","include","attachViews","exclude","union","render","index","detach","result","componentsManager","listenToOnce","Model","model","serverAttrs","set","Router","namedParameters","autoloadModules","modulesPath","defaultModuleName","onModuleError","routerOptions","constructor","modules","route","isObject","componentNames","pluck","join","namedParam","splatParam","namesPattern","_routeToRegExp","splatMatch","namedMatch","paramNames","match","replace","substring","_extractParameters","fragment","namedParams","console","log","i","loadModule","history","moduleName","getModuleName","require","moduleInit","loadUrl","split","identity","$","splice","Array","delegateEventSplitter","isContainerSkipped","contains","templateHelpers","waitsCounter","waitAvailable","nestedEntityTypes","nestedEventTypes","resultableOptions","viewOptions","data","key","_prepareNestedEvents","_prepareModels","_prepareCollections","_prepareViews","views","viewsGroup","delegateNestedEvents","omit","wait","collections","models","once","defer","_render","template","force","getTemplateData","html","renderTemplate","$el","setElement","_ensureElement","$container","attach","first","containerEl","domChanged","$els","append","_updateViews","setViews","appendView","_insertViews","appendViews","prependView","prependViews","insertView","insertViews","removeView","getView","_removeViews","removeViews","getViews","clone","concat","oldViews","all","oldView","viewObjs","indexOf","viewObj","sortBy","undelegateNestedEvents","element","$previousEl","_setElement","replaceWith","ensureUI","$ui","ui","mapObject","selector","delegateTriggers","triggers","undelegateTriggers","event","toArray","delegateTrigger","eventName","listener","on","cid","off","undelegateTrigger","type","entities","listeners","_nestedEvents","entity","listenTo","handler","stopListening","entityType","eventType","entityEventsHash","entityNames","bind","entityName","afterAttach","previousView","attr","delegateEvents","detachViews","beforeDetach","removeData","removeAttr","undelegateEvents","getClosestView","$selector","is","closest","Esencia","backboneFields","DEFAULT_EXEC_TYPE","urlError","error","dataType","contentType","processData","url","JSON","stringify","baseMethodsMap","toUpperCase"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;YAAA,a;YAEA,IAAIA,CAAA,GAAIC,QAAA,CAAQ,EAAR,CAAR,C;YACA,IAAIC,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YACA,IAAIE,SAAA,GAAYF,QAAA,CAAQ,CAAR,CAAhB,C;YAOA,IAAIG,UAAA,GAAa,EAAjB,C;YAQAA,UAAA,CAAWC,IAAX,GAAkB,UAASC,MAAT,EAAiBC,UAAjB,EAA6BC,OAA7B,EAAsC;AAAA,gBACvDA,OAAA,GAAUL,SAAA,CAAUM,cAAV,CAAyBH,MAAzB,EAAiCC,UAAjC,EAA6CC,OAA7C,CAAV,CADuD;AAAA,gBAEvDF,MAAA,GAASH,SAAA,CAAUO,iBAAV,CAA4BF,OAA5B,CAAT,CAFuD;AAAA,gBAGvD,OAAON,QAAA,CAASE,UAAT,CAAoBO,SAApB,CAA8BN,IAA9B,CAAmCO,IAAnC,CACN,IADM,EACAN,MADA,EACQC,UADR,EACoBC,OADpB,CAAP,CAHuD;AAAA,aAAxD,C;YAgBAJ,UAAA,CAAWS,IAAX,GAAkB,UAASP,MAAT,EAAiBE,OAAjB,EAA0B;AAAA,gBAC3CA,OAAA,GAAUR,CAAA,CAAEc,MAAF,CAAS,EAACC,KAAA,EAAO,IAAR,EAAT,EAAwBP,OAAxB,CAAV,CAD2C;AAAA,gBAE3C,IAAID,UAAA,GAAa,IAAjB,CAF2C;AAAA,gBAG3C,IAAIS,OAAA,GAAUR,OAAA,CAAQQ,OAAtB,CAH2C;AAAA,gBAI3CR,OAAA,CAAQQ,OAAR,GAAkB,UAASC,IAAT,EAAe;AAAA,oBAChC,IAAIT,OAAA,CAAQU,KAAZ;AAAA,wBAAmBX,UAAA,CAAWC,OAAA,CAAQW,KAAR,GAAgB,OAAhB,GAA0B,KAArC,EAA4CF,IAA5C,EAAkDT,OAAlD,EADa;AAAA,oBAEhC,IAAIQ,OAAJ;AAAA,wBAAaA,OAAA,CAAQJ,IAAR,CAAaJ,OAAA,CAAQY,OAArB,EAA8Bb,UAA9B,EAA0CU,IAA1C,EAAgDT,OAAhD,EAFmB;AAAA,oBAGhCD,UAAA,CAAWc,OAAX,CAAmB,UAAUf,MAA7B,EAAqCC,UAArC,EAAiDU,IAAjD,EAAuDT,OAAvD,EAHgC;AAAA,iBAAjC,CAJ2C;AAAA,gBAS3CL,SAAA,CAAUmB,SAAV,CAAoB,IAApB,EAA0Bd,OAA1B,EAT2C;AAAA,gBAU3C,OAAO,KAAKH,IAAL,CAAUC,MAAV,EAAkB,IAAlB,EAAwBE,OAAxB,CAAP,CAV2C;AAAA,aAA5C,C;YAaAe,MAAA,CAAOC,OAAP,GAAiBtB,QAAA,CAASE,UAAT,CAAoBU,MAApB,CAA2BV,UAA3B,CAAjB,C;;;YChDA,a;YAEA,IAAIJ,CAAA,GAAIC,QAAA,CAAQ,EAAR,CAAR,C;YACA,IAAIC,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YACA,IAAIwB,IAAA,GAAOxB,QAAA,CAAQ,CAAR,CAAX,C;YACA,IAAIa,MAAA,GAASb,QAAA,CAAQ,CAAR,CAAb,C;YAEA,SAASyB,iBAAT,CAA2BC,OAA3B,EAAoCC,IAApC,EAA0C;AAAA,gBACzC,OAAOC,OAAA,CACN,CAACF,OAAD,IACAA,OAAA,CAAQG,SAAR,CAAkBC,IAAlB,KAA2BH,IAAA,CAAKE,SAAL,CAAeC,IAD1C,IAEA,CAACJ,OAAA,CAAQK,IAFT,IAGAL,OAAA,CAAQK,IAAR,YAAwBJ,IAAA,CAAKE,SAAL,CAAeL,IAAvC,KAAgD,KAHhD,IAIAE,OAAA,CAAQK,IAAR,CAAaC,SAAb,EAJA,IAKA,CAACN,OAAA,CAAQK,IAAR,CAAaE,QALd,IAMA,CAACP,OAAA,CAAQK,IAAR,CAAaG,WAAb,EAPK,CAAP,CADyC;AAAA,a;YAgB1C,IAAIC,iBAAA,GAAoB,UAAS5B,OAAT,EAAkB;AAAA,gBACzCA,OAAA,GAAUA,OAAA,IAAW,EAArB,CADyC;AAAA,gBAIzCR,CAAA,CAAEc,MAAF,CAAS,IAAT,EAAed,CAAA,CAAEqC,IAAF,CAAO7B,OAAP,EAAgB8B,uBAAhB,CAAf,EAJyC;AAAA,gBAMzC,KAAK9B,OAAL,GAAeA,OAAf,CANyC;AAAA,gBASzC,KAAK+B,UAAL,GAAkB,EAAlB,CATyC;AAAA,gBAYzC,KAAKC,IAAL,GAAY,EAAZ,CAZyC;AAAA,gBAezC,KAAKC,YAAL,GAAoB,EAApB,CAfyC;AAAA,gBAkBzC,IAAI,KAAKC,WAAT;AAAA,oBAAsB,KAAKC,QAAL,GAlBmB;AAAA,gBAoBzC,KAAKC,UAAL,CAAgBC,KAAhB,CAAsB,IAAtB,EAA4BC,SAA5B,EApByC;AAAA,aAA1C,C;YAuBA,IAAIR,uBAAA,GAA0B;AAAA,oBAC7B,QAD6B;AAAA,oBACnB,aADmB;AAAA,iBAA9B,C;YAIC,IAAIS,gBAAA,GAAmB;AAAA,oBACvB,MADuB;AAAA,oBACf,QADe;AAAA,oBACL,WADK;AAAA,oBACQ,MADR;AAAA,oBACgB,OADhB;AAAA,oBACyB,QADzB;AAAA,oBAEvB,YAFuB;AAAA,oBAET,aAFS;AAAA,oBAEM,aAFN;AAAA,iBAAvB,C;YAKD/C,CAAA,CAAEc,MAAF,CAASsB,iBAAA,CAAkBzB,SAA3B,EAAsCT,QAAA,CAAS8C,MAA/C,EAAuD;AAAA,gBAGtDC,MAAA,EAAQ,MAH8C;AAAA,gBAMtDP,WAAA,EAAa,IANyC;AAAA,gBAWtDQ,aAAA,EAAeC,SAXuC;AAAA,gBAkBtDP,UAAA,EAAY,YAAW;AAAA,iBAlB+B;AAAA,gBAwBtDD,QAAA,EAAU,YAAW;AAAA,oBACpB,IAAIS,QAAA,GAAW3B,IAAA,CAAKX,MAAL,CAAY,EAC1BuC,EAAA,EAAI,KAAKJ,MADiB,EAAZ,CAAf,CADoB;AAAA,oBAKpB,KAAKK,GAAL,CAAS;AAAA,wBACRC,MAAA,EAAQ,IADA;AAAA,wBAER9B,IAAA,EAAM2B,QAFE;AAAA,qBAAT,EALoB;AAAA,iBAxBiC;AAAA,gBAgDtDE,GAAA,EAAK,UAAS9C,OAAT,EAAkB;AAAA,oBACtBA,OAAA,GAAUR,CAAA,CAAEwD,QAAF,CAAW,EAAX,EAAehD,OAAf,EAAwB;AAAA,wBACjC+C,MAAA,EAAQ,KAAKL,aADoB;AAAA,wBAEjCO,IAAA,EAAM,KAF2B;AAAA,qBAAxB,CAAV,CADsB;AAAA,oBAMtB,IAAI3B,SAAA,GAAY9B,CAAA,CAAEqC,IAAF,CAAO7B,OAAP,EAAgBuC,gBAAhB,CAAhB,CANsB;AAAA,oBAQtB,IAAIW,OAAA,GAAU1D,CAAA,CAAE2D,GAAF,CAAM7B,SAAN,EAAiB,MAAjB,CAAd,CARsB;AAAA,oBAStB,IAAI8B,YAAA,GAAe5D,CAAA,CAAE2D,GAAF,CAAM7B,SAAN,EAAiB,WAAjB,CAAnB,CATsB;AAAA,oBAUtB,IAAI+B,SAAA,GAAY7D,CAAA,CAAE8D,QAAF,CAAWhC,SAAA,CAAUyB,MAArB,CAAhB,CAVsB;AAAA,oBAWtB,IAAIQ,MAAA,GAAS/D,CAAA,CAAEgE,MAAF,CAASlC,SAAA,CAAUyB,MAAnB,CAAb,CAXsB;AAAA,oBAYtB,IAAIU,gBAAA,GAAmBjE,CAAA,CAAE8D,QAAF,CAAW,KAAKZ,aAAhB,CAAvB,CAZsB;AAAA,oBActB,IAAIQ,OAAA,IAAW,CAAC1D,CAAA,CAAE8D,QAAF,CAAWhC,SAAA,CAAUC,IAArB,CAAhB,EAA4C;AAAA,wBAC3C,MAAM,IAAImC,KAAJ,CAAU,4CAAV,CAAN,CAD2C;AAAA,qBAdtB;AAAA,oBAkBtB,IAAIR,OAAA,IAAW1D,CAAA,CAAE2D,GAAF,CAAM,KAAKpB,UAAX,EAAuBT,SAAA,CAAUC,IAAjC,CAAf,EAAuD;AAAA,wBACtD,MAAM,IAAImC,KAAJ,CAAU,oCAAoCpC,SAAA,CAAUC,IAA9C,GAAqD,GAA/D,CAAN,CADsD;AAAA,qBAlBjC;AAAA,oBAsBtB,IAAI,CAAC/B,CAAA,CAAE2D,GAAF,CAAM7B,SAAN,EAAiB,MAAjB,CAAL,EAA+B;AAAA,wBAC9B,MAAM,IAAIoC,KAAJ,CAAU,qCAAV,CAAN,CAD8B;AAAA,qBAtBT;AAAA,oBA0BtB,IAAI,CAACD,gBAAD,IAAqBjE,CAAA,CAAEmE,WAAF,CAAcrC,SAAA,CAAUyB,MAAxB,CAAzB,EAA0D;AAAA,wBACzD,MAAM,IAAIW,KAAJ,CACL,6DADK,CAAN,CADyD;AAAA,qBA1BpC;AAAA,oBAgCtB,IAAI,CAACL,SAAD,IAAc,CAACE,MAAnB,EAA2B;AAAA,wBAC1B,MAAM,IAAIG,KAAJ,CAAU,sDAAV,CAAN,CAD0B;AAAA,qBAhCL;AAAA,oBAoCtB,IAAIH,MAAA,IAAUH,YAAd,EAA4B;AAAA,wBAC3B,MAAM,IAAIM,KAAJ,CAAU,2CAAV,CAAN,CAD2B;AAAA,qBApCN;AAAA,oBAwCtB,IAAIL,SAAA,IAAa,CAACD,YAAlB,EAAgC;AAAA,wBAC/B,MAAM,IAAIM,KAAJ,CACL,qEADK,CAAN,CAD+B;AAAA,qBAxCV;AAAA,oBA8CtB,IAAIN,YAAA,IAAgB,CAAC5D,CAAA,CAAE8D,QAAF,CAAWhC,SAAA,CAAUsC,SAArB,CAArB,EAAsD;AAAA,wBACrD,MAAM,IAAIF,KAAJ,CAAU,0DAAV,CAAN,CADqD;AAAA,qBA9ChC;AAAA,oBAmDtB,IAAI,CAACR,OAAL,EAAc;AAAA,wBACb5B,SAAA,CAAUC,IAAV,GAAiB/B,CAAA,CAAEqE,QAAF,CAAW,cAAX,IAA6B,IAA9C,CADa;AAAA,qBAnDQ;AAAA,oBAuDtB,KAAK9B,UAAL,CAAgBT,SAAA,CAAUC,IAA1B,IAAkCD,SAAlC,CAvDsB;AAAA,oBAyDtB,IAAIiC,MAAA,IAAW,EAACE,gBAAD,IAAqBzD,OAAA,CAAQ8D,OAA7B,CAAf,EAAsD;AAAA,wBACrD,KAAKpB,aAAL,GAAqBpB,SAAA,CAAUC,IAA/B,CADqD;AAAA,qBAzDhC;AAAA,oBA8DtB,IAAIvB,OAAA,CAAQiD,IAAZ,EAAkB;AAAA,wBACjB,KAAKA,IAAL,CAAU3B,SAAA,CAAUC,IAApB,EADiB;AAAA,qBA9DI;AAAA,oBAkEtB,OAAOD,SAAP,CAlEsB;AAAA,iBAhD+B;AAAA,gBA4HtDyC,GAAA,EAAK,UAASxC,IAAT,EAAe;AAAA,oBACnB,IAAID,SAAA,GAAY,KAAKS,UAAL,CAAgBR,IAAhB,CAAhB,CADmB;AAAA,oBAGnB,IAAI,CAACD,SAAL,EAAgB;AAAA,wBACf,MAAM,IAAIoC,KAAJ,CAAU,0BAA0BnC,IAA1B,GAAiC,kBAA3C,CAAN,CADe;AAAA,qBAHG;AAAA,oBAOnB,OAAOD,SAAP,CAPmB;AAAA,iBA5HkC;AAAA,gBA4ItD0C,MAAA,EAAQ,UAASzC,IAAT,EAAe;AAAA,oBACtB,OAAO,KAAKQ,UAAL,CAAgBR,IAAhB,CAAP,CADsB;AAAA,iBA5I+B;AAAA,gBAwJtD0B,IAAA,EAAM,UAASgB,KAAT,EAAgBjE,OAAhB,EAAyBkE,QAAzB,EAAmC;AAAA,oBACxC,IAAI1E,CAAA,CAAE2E,UAAF,CAAaF,KAAb,CAAJ,EAAyB;AAAA,wBACxBC,QAAA,GAAWD,KAAX,CADwB;AAAA,wBAExBA,KAAA,GAAQtB,SAAR,CAFwB;AAAA,wBAGxB3C,OAAA,GAAU2C,SAAV,CAHwB;AAAA,qBADe;AAAA,oBAOxC,IAAInD,CAAA,CAAE2E,UAAF,CAAanE,OAAb,CAAJ,EAA2B;AAAA,wBAC1BkE,QAAA,GAAWlE,OAAX,CAD0B;AAAA,wBAE1BA,OAAA,GAAU2C,SAAV,CAF0B;AAAA,qBAPa;AAAA,oBAYxCsB,KAAA,GAAQA,KAAA,IAAS,KAAKhC,YAAtB,CAZwC;AAAA,oBAaxCjC,OAAA,GAAUA,OAAA,IAAW,EAArB,CAbwC;AAAA,oBAcxCkE,QAAA,GAAWA,QAAA,IAAY1E,CAAA,CAAE4E,IAAzB,CAdwC;AAAA,oBAgBxC,IAAI,CAAC5E,CAAA,CAAE6E,OAAF,CAAUJ,KAAV,CAAL;AAAA,wBAAuBA,KAAA,GAAQ,CAACA,KAAD,CAAR,CAhBiB;AAAA,oBAiBxC,IAAI,CAACA,KAAA,CAAMK,MAAX,EAAmB;AAAA,wBAClB,MAAM,IAAIZ,KAAJ,CAAU,+CAAV,CAAN,CADkB;AAAA,qBAjBqB;AAAA,oBAqBxC,IAAI1B,IAAA,GAAO,KAAKuC,UAAL,CAAgBN,KAAhB,CAAX,CArBwC;AAAA,oBAsBxC,IAAIO,OAAA,GAAU,KAAKxC,IAAnB,CAtBwC;AAAA,oBAuBxC,KAAKA,IAAL,GAAY,EAAZ,CAvBwC;AAAA,oBAyBxC,KAAKC,YAAL,GAAoBgC,KAApB,CAzBwC;AAAA,oBA2BxC,KAAKQ,UAAL,CAAgB;AAAA,wBACf1B,MAAA,EAAQ,EAAC2B,QAAA,EAAU,KAAK1C,IAAhB,EADO;AAAA,wBAEfwC,OAAA,EAASA,OAFM;AAAA,wBAGfxC,IAAA,EAAMA,IAHS;AAAA,qBAAhB,EAIGkC,QAJH,EA3BwC;AAAA,iBAxJa;AAAA,gBA0LtDK,UAAA,EAAY,UAASN,KAAT,EAAgB;AAAA,oBAC3B,IAAIU,IAAA,GAAO,IAAX,CAD2B;AAAA,oBAI3B,IAAIC,eAAA,GAAkB,UAASX,KAAT,EAAgBjC,IAAhB,EAAsB;AAAA,wBAE3C,IAAI,CAACiC,KAAA,CAAMK,MAAX;AAAA,4BAAmB,OAAOtC,IAAP,CAFwB;AAAA,wBAI3C,IAAI6C,WAAA,GAAc,EAAlB,CAJ2C;AAAA,wBAO3C,IAAIC,KAAA,GAAQtF,CAAA,CAAEyE,KAAF,EACVc,KADU,GAEVC,IAFU,GAGVC,GAHU,CAGN,UAAS1D,IAAT,EAAe;AAAA,gCACnB,IAAID,SAAA,GAAYqD,IAAA,CAAKZ,GAAL,CAASxC,IAAT,CAAhB,CADmB;AAAA,gCAInB,IAAI/B,CAAA,CAAE2D,GAAF,CAAMnB,IAAN,EAAYV,SAAA,CAAUC,IAAtB,CAAJ;AAAA,oCAAiC,OAAO,IAAP,CAJd;AAAA,gCAOnB,IAAIH,IAAA,GAAO;AAAA,wCACVE,SAAA,EAAWA,SADD;AAAA,wCAEVoD,QAAA,EAAU,EAFA;AAAA,qCAAX,CAPmB;AAAA,gCAanB,IAAIlF,CAAA,CAAE8D,QAAF,CAAWhC,SAAA,CAAUyB,MAArB,CAAJ,EAAkC;AAAA,oCACjC8B,WAAA,CAAYK,IAAZ,CAAiB5D,SAAA,CAAUyB,MAA3B,EADiC;AAAA,iCAbf;AAAA,gCAkBnBf,IAAA,CAAKV,SAAA,CAAUC,IAAf,IAAuBH,IAAvB,CAlBmB;AAAA,gCAoBnB,OAAOA,IAAP,CApBmB;AAAA,6BAHT,EAyBV+D,OAzBU,GA0BVC,KA1BU,EAAZ,CAP2C;AAAA,wBAoC3CpD,IAAA,GAAO4C,eAAA,CAAgBC,WAAhB,EAA6B7C,IAA7B,CAAP,CApC2C;AAAA,wBAuC3CxC,CAAA,CAAEsF,KAAF,EAASO,IAAT,CAAc,UAASjE,IAAT,EAAe;AAAA,4BAC5B,IAAI5B,CAAA,CAAE8D,QAAF,CAAWlC,IAAA,CAAKE,SAAL,CAAeyB,MAA1B,CAAJ,EAAuC;AAAA,gCACtC,IACC3B,IAAA,CAAKE,SAAL,CAAesC,SAAf,IACApE,CAAA,CAAEwC,IAAA,CAAKZ,IAAA,CAAKE,SAAL,CAAeyB,MAApB,EAA4B2B,QAA9B,EAAwCY,IAAxC,CAA6C,UAASC,KAAT,EAAgB;AAAA,wCAC5D,OAAOA,KAAA,CAAMjE,SAAN,CAAgBsC,SAAhB,KAA8BxC,IAAA,CAAKE,SAAL,CAAesC,SAApD,CAD4D;AAAA,qCAA7D,CAFD,EAKE;AAAA,oCACD,MAAM,IAAIF,KAAJ,CACL,iEADK,CAAN,CADC;AAAA,iCANoC;AAAA,gCAYtC1B,IAAA,CAAKZ,IAAA,CAAKE,SAAL,CAAeyB,MAApB,EAA4B2B,QAA5B,CAAqCQ,IAArC,CAA0C9D,IAA1C,EAZsC;AAAA,6BADX;AAAA,yBAA7B,EAvC2C;AAAA,wBAwD3C,OAAOY,IAAP,CAxD2C;AAAA,qBAA5C,CAJ2B;AAAA,oBA+D3B,IAAIA,IAAA,GAAO4C,eAAA,CAAgBX,KAAhB,EAAuB,EAAvB,CAAX,CA/D2B;AAAA,oBAiE3B,IAAIzE,CAAA,CAAEgG,OAAF,CAAUxD,IAAV,CAAJ,EAAqB;AAAA,wBACpB,MAAM,IAAI0B,KAAJ,CAAU,0BAAV,CAAN,CADoB;AAAA,qBAjEM;AAAA,oBAsE3B1B,IAAA,GAAOxC,CAAA,CAAEwC,IAAF,EAAQyD,MAAR,CAAe,UAASrE,IAAT,EAAe;AAAA,wBACpC,OAAO5B,CAAA,CAAEgE,MAAF,CAASpC,IAAA,CAAKE,SAAL,CAAeyB,MAAxB,CAAP,CADoC;AAAA,qBAA9B,CAAP,CAtE2B;AAAA,oBA0E3B,IAAI,CAACf,IAAA,CAAKsC,MAAV,EAAkB;AAAA,wBACjB,MAAM,IAAIZ,KAAJ,CAAU,oDAAV,CAAN,CADiB;AAAA,qBA1ES;AAAA,oBA8E3B,IACClE,CAAA,CAAEwC,IAAF,EAAQ0D,IAAR,CAAa,UAAStE,IAAT,EAAe;AAAA,4BAC3B,OAAOA,IAAA,CAAKE,SAAL,CAAesC,SAAtB,CAD2B;AAAA,yBAA5B,CADD,EAIE;AAAA,wBACD,MAAM,IAAIF,KAAJ,CAAU,2CAAV,CAAN,CADC;AAAA,qBAlFyB;AAAA,oBAsF3B,OAAO1B,IAAP,CAtF2B;AAAA,iBA1L0B;AAAA,gBAmRtDyC,UAAA,EAAY,UAASkB,MAAT,EAAiBzB,QAAjB,EAA2B;AAAA,oBACtC,IAAIS,IAAA,GAAO,IAAX,CADsC;AAAA,oBAGtC,IAAI5B,MAAA,GAAS4C,MAAA,CAAO5C,MAApB,CAHsC;AAAA,oBAKtC,IAAI6C,aAAA,GAAgBpG,CAAA,CAAEqG,KAAF,CAAQF,MAAA,CAAO3D,IAAP,CAAYsC,MAApB,EAA4BJ,QAA5B,CAApB,CALsC;AAAA,oBAOtC,IAAI4B,OAAA,GAAU,UAAS3E,OAAT,EAAkBC,IAAlB,EAAwB;AAAA,wBACrC,IAAIwC,SAAA,GAAYxC,IAAA,CAAKE,SAAL,CAAesC,SAA/B,CADqC;AAAA,wBAGrC,IAAIc,QAAA,GAAWtD,IAAA,CAAKsD,QAApB,CAHqC;AAAA,wBAIrC,IAAIqB,WAAA,GAAc5E,OAAA,GAAUA,OAAA,CAAQuD,QAAlB,GAA6B,EAA/C,CAJqC;AAAA,wBAOrCtD,IAAA,CAAKI,IAAL,CAAUwE,OAAV,GAPqC;AAAA,wBASrC,IAAI,CAAC5E,IAAA,CAAKI,IAAL,CAAUE,QAAX,IAAuBkC,SAA3B,EAAsC;AAAA,4BAErCb,MAAA,CAAOvB,IAAP,CACEyE,OADF,CACU7E,IAAA,CAAKI,IADf,EACqBoC,SADrB,EAEEsC,WAFF,CAEc,EAACC,OAAA,EAAS,CAACvC,SAAD,CAAV,EAFd,EAGEwC,WAHF,CAGc,EAACD,OAAA,EAAS,CAACvC,SAAD,CAAV,EAHd,EAFqC;AAAA,yBAAtC,MAMO;AAAA,4BAEN,IAAIyC,OAAA,GAAU7G,CAAA,CAAE8G,KAAF,CACb9G,CAAA,CAAEkF,QAAF,EAAYK,KAAZ,GAAoBE,GAApB,CAAwB,UAASM,KAAT,EAAgB;AAAA,oCACvC,OAAOA,KAAA,CAAMjE,SAAN,CAAgBsC,SAAvB,CADuC;AAAA,iCAAxC,EAEGuB,OAFH,GAEaC,KAFb,EADa,EAIb5F,CAAA,CAAEuG,WAAF,EAAehB,KAAf,GAAuBE,GAAvB,CAA2B,UAASM,KAAT,EAAgB;AAAA,oCAC1C,OAAOA,KAAA,CAAMjE,SAAN,CAAgBsC,SAAvB,CAD0C;AAAA,iCAA3C,EAEGuB,OAFH,GAEaC,KAFb,EAJa,CAAd,CAFM;AAAA,4BAYNhE,IAAA,CAAKI,IAAL,CAAU+E,MAAV,CAAiB,EAACF,OAAA,EAASA,OAAV,EAAjB,EAZM;AAAA,yBAf8B;AAAA,wBAgCrCjF,IAAA,CAAKsD,QAAL,GAAgB,EAAhB,CAhCqC;AAAA,wBAmCrC3B,MAAA,CAAO2B,QAAP,CAAgBQ,IAAhB,CAAqB9D,IAArB,EAnCqC;AAAA,wBAsCrCuD,IAAA,CAAKF,UAAL,CAAgB;AAAA,4BACf1B,MAAA,EAAQ3B,IADO;AAAA,4BAEfoD,OAAA,EAASuB,WAFM;AAAA,4BAGf/D,IAAA,EAAM0C,QAHS;AAAA,yBAAhB,EAIGkB,aAJH,EAtCqC;AAAA,qBAAtC,CAPsC;AAAA,oBAoDtCpG,CAAA,CAAEmG,MAAA,CAAO3D,IAAT,EAAeqD,IAAf,CAAoB,UAASjE,IAAT,EAAeoF,KAAf,EAAsB;AAAA,wBAEzC,IAAIrF,OAAA,GAAUwE,MAAA,CAAOnB,OAAP,CAAegC,KAAf,KAAyB,IAAvC,CAFyC;AAAA,wBAIzC,IAAItF,iBAAA,CAAkBC,OAAlB,EAA2BC,IAA3B,CAAJ,EAAsC;AAAA,4BACrC,IAAID,OAAA,IAAWA,OAAA,CAAQK,IAAvB,EAA6B;AAAA,gCAC5B,IAAIL,OAAA,CAAQG,SAAR,CAAkBsC,SAAtB,EAAiC;AAAA,oCAEhC,IAAIzC,OAAA,CAAQG,SAAR,CAAkBsC,SAAlB,KAAgCxC,IAAA,CAAKE,SAAL,CAAesC,SAAnD,EAA8D;AAAA,wCAC7DzC,OAAA,CAAQK,IAAR,CAAawC,MAAb,GAD6D;AAAA,qCAF9B;AAAA,iCAAjC,MAKO;AAAA,oCAEN7C,OAAA,CAAQK,IAAR,CAAaiF,MAAb,GAFM;AAAA,iCANqB;AAAA,6BADQ;AAAA,4BAcrCrF,IAAA,CAAKI,IAAL,GAAY,IAAKJ,IAAA,CAAKE,SAAL,CAAeL,IAApB,CACXzB,CAAA,CAAE4B,IAAA,CAAKE,SAAP,EACEyD,KADF,GAEElD,IAFF,CAEO,OAFP,EAEgB,QAFhB,EAE0B,YAF1B,EAEwC,aAFxC,EAGEvB,MAHF,CAGSd,CAAA,CAAEkH,MAAF,CAAStF,IAAA,CAAKE,SAAd,EAAyB,aAAzB,CAHT,EAGkD,EAChDqF,iBAAA,EAAmB,IAD6B,EAHlD,EAMEvB,KANF,EADW,CAAZ,CAdqC;AAAA,4BAyBrC,IAAIhE,IAAA,CAAKI,IAAL,CAAUC,SAAV,EAAJ,EAA2B;AAAA,gCAE1BkD,IAAA,CAAKiC,YAAL,CAAkBxF,IAAA,CAAKI,IAAvB,EAA6B,iBAA7B,EAAgD,YAAW;AAAA,oCAC1DsE,OAAA,CAAQ,IAAR,EAAc1E,IAAd,EAD0D;AAAA,iCAA3D,EAF0B;AAAA,6BAA3B,MAKO;AAAA,gCACN0E,OAAA,CAAQ,IAAR,EAAc1E,IAAd,EADM;AAAA,6BA9B8B;AAAA,yBAAtC,MAiCO;AAAA,4BAENA,IAAA,CAAKI,IAAL,GAAYL,OAAA,CAAQK,IAApB,CAFM;AAAA,4BAKNsE,OAAA,CAAQ3E,OAAR,EAAiBC,IAAjB,EALM;AAAA,yBArCkC;AAAA,qBAA1C,EApDsC;AAAA,iBAnRe;AAAA,aAAvD,E;YAuXAQ,iBAAA,CAAkBtB,MAAlB,GAA2BA,MAA3B,C;YAEAS,MAAA,CAAOC,OAAP,GAAiBY,iBAAjB,C;;;YChbA,a;YAEA,IAAIpC,CAAA,GAAIC,QAAA,CAAQ,EAAR,CAAR,C;YACA,IAAIC,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YACA,IAAIE,SAAA,GAAYF,QAAA,CAAQ,CAAR,CAAhB,C;YAOA,IAAIoH,KAAA,GAAQ,EAAZ,C;YAQAA,KAAA,CAAMhH,IAAN,GAAa,UAASC,MAAT,EAAiBgH,KAAjB,EAAwB9G,OAAxB,EAAiC;AAAA,gBAC7CA,OAAA,GAAUL,SAAA,CAAUM,cAAV,CAAyBH,MAAzB,EAAiCgH,KAAjC,EAAwC9G,OAAxC,CAAV,CAD6C;AAAA,gBAE7CF,MAAA,GAASH,SAAA,CAAUO,iBAAV,CAA4BF,OAA5B,CAAT,CAF6C;AAAA,gBAG7C,OAAON,QAAA,CAASmH,KAAT,CAAe1G,SAAf,CAAyBN,IAAzB,CAA8BO,IAA9B,CAAmC,IAAnC,EAAyCN,MAAzC,EAAiDgH,KAAjD,EAAwD9G,OAAxD,CAAP,CAH6C;AAAA,aAA9C,C;YAcA6G,KAAA,CAAMxG,IAAN,GAAa,UAASP,MAAT,EAAiBE,OAAjB,EAA0B;AAAA,gBACtCA,OAAA,GAAUR,CAAA,CAAEc,MAAF,CAAS,EAACC,KAAA,EAAO,IAAR,EAAT,EAAwBP,OAAxB,CAAV,CADsC;AAAA,gBAEtC,IAAI8G,KAAA,GAAQ,IAAZ,CAFsC;AAAA,gBAGtC,IAAItG,OAAA,GAAUR,OAAA,CAAQQ,OAAtB,CAHsC;AAAA,gBAItCR,OAAA,CAAQQ,OAAR,GAAkB,UAASC,IAAT,EAAe;AAAA,oBAChC,IAAIT,OAAA,CAAQU,KAAZ,EAAmB;AAAA,wBAClB,IAAIqG,WAAA,GAAc/G,OAAA,CAAQO,KAAR,GAAgBuG,KAAA,CAAMvG,KAAN,CAAYE,IAAZ,EAAkBT,OAAlB,CAAhB,GAA6CS,IAA/D,CADkB;AAAA,wBAElB,IAAI,CAACqG,KAAA,CAAME,GAAN,CAAUD,WAAV,EAAuB/G,OAAvB,CAAL;AAAA,4BAAsC,OAAO,KAAP,CAFpB;AAAA,qBADa;AAAA,oBAKhC,IAAIQ,OAAJ;AAAA,wBAAaA,OAAA,CAAQJ,IAAR,CAAaJ,OAAA,CAAQY,OAArB,EAA8BkG,KAA9B,EAAqCrG,IAArC,EAA2CT,OAA3C,EALmB;AAAA,oBAMhC8G,KAAA,CAAMjG,OAAN,CAAc,UAAUf,MAAxB,EAAgCgH,KAAhC,EAAuCrG,IAAvC,EAA6CT,OAA7C,EANgC;AAAA,iBAAjC,CAJsC;AAAA,gBAYtCL,SAAA,CAAUmB,SAAV,CAAoB,IAApB,EAA0Bd,OAA1B,EAZsC;AAAA,gBAatC,OAAO,KAAKH,IAAL,CAAUC,MAAV,EAAkB,IAAlB,EAAwBE,OAAxB,CAAP,CAbsC;AAAA,aAAvC,C;YAgBAe,MAAA,CAAOC,OAAP,GAAiBtB,QAAA,CAASmH,KAAT,CAAevG,MAAf,CAAsBuG,KAAtB,CAAjB,C;;;YCjDA,a;YAEA,IAAIrH,CAAA,GAAIC,QAAA,CAAQ,EAAR,CAAR,C;YACA,IAAIC,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YACA,IAAIkH,iBAAA,GAAoBlH,QAAA,CAAQ,CAAR,CAAxB,C;YAOA,IAAIwH,MAAA,GAAS;AAAA,oBACZN,iBAAA,EAAmBA,iBADP;AAAA,oBAEZO,eAAA,EAAiB,IAFL;AAAA,oBAGZC,eAAA,EAAiB,IAHL;AAAA,oBAIZC,WAAA,EAAa,UAJD;AAAA,oBAKZC,iBAAA,EAAmB,MALP;AAAA,oBAMZC,aAAA,EAAe,YAAW;AAAA,qBANd;AAAA,iBAAb,C;YASA,IAAIC,aAAA,GAAgB;AAAA,oBACnB,mBADmB;AAAA,oBACE,iBADF;AAAA,oBAEnB,iBAFmB;AAAA,oBAEA,aAFA;AAAA,oBAEe,mBAFf;AAAA,oBAEoC,eAFpC;AAAA,iBAApB,C;YAUAN,MAAA,CAAOO,WAAP,GAAqB,UAASxH,OAAT,EAAkB;AAAA,gBACtCA,OAAA,GAAUA,OAAA,IAAW,EAArB,CADsC;AAAA,gBAItCR,CAAA,CAAEc,MAAF,CAAS,IAAT,EAAed,CAAA,CAAEqC,IAAF,CAAO7B,OAAP,EAAgBuH,aAAhB,CAAf,EAJsC;AAAA,gBAMtC,KAAKvH,OAAL,GAAeA,OAAf,CANsC;AAAA,gBAQtC,KAAKyH,OAAL,GAAe,EAAf,CARsC;AAAA,gBAUtC/H,QAAA,CAASuH,MAAT,CAAgB5E,KAAhB,CAAsB,IAAtB,EAA4BC,SAA5B,EAVsC;AAAA,aAAvC,C;YAmBA2E,MAAA,CAAO3F,SAAP,GAAmB,UAAStB,OAAT,EAAkB;AAAA,gBACpC,OAAO,KAAK2G,iBAAL,CAAuB7D,GAAvB,CAA2B9C,OAA3B,CAAP,CADoC;AAAA,aAArC,C;YAUAiH,MAAA,CAAOS,KAAP,GAAe,UAASA,KAAT,EAAgB1H,OAAhB,EAAyBkE,QAAzB,EAAmC;AAAA,gBACjD,IAAIS,IAAA,GAAO,IAAX,CADiD;AAAA,gBAGjD,IAAInF,CAAA,CAAE2E,UAAF,CAAanE,OAAb,CAAJ,EAA2B;AAAA,oBAC1BkE,QAAA,GAAWlE,OAAX,CAD0B;AAAA,oBAE1BA,OAAA,GAAU,EAAV,CAF0B;AAAA,iBAHsB;AAAA,gBAQjD,IAAI,CAACR,CAAA,CAAEmI,QAAF,CAAW3H,OAAX,CAAL,EAA0B;AAAA,oBACzBA,OAAA,GAAU,EAACuB,IAAA,EAAMvB,OAAP,EAAV,CADyB;AAAA,iBARuB;AAAA,gBAYjD,IAAIuB,IAAA,GAAO,EAAX,CAZiD;AAAA,gBAcjD,IAAI/B,CAAA,CAAE2D,GAAF,CAAMnD,OAAN,EAAe,YAAf,KAAgCR,CAAA,CAAE2D,GAAF,CAAMnD,OAAN,EAAe,WAAf,CAApC,EAAiE;AAAA,oBAChE,IAAI+B,UAAA,GAAavC,CAAA,CAAEQ,OAAA,CAAQ+B,UAAR,IAAsB,CAAC/B,OAAA,CAAQsB,SAAT,CAAxB,EACf2D,GADe,CACX,UAAS1C,gBAAT,EAA2B;AAAA,4BAC/B,IAAI/C,CAAA,CAAE8D,QAAF,CAAWf,gBAAX,CAAJ,EAAkC;AAAA,gCACjC,OAAOoC,IAAA,CAAKgC,iBAAL,CAAuB5C,GAAvB,CAA2BxB,gBAA3B,CAAP,CADiC;AAAA,6BAAlC,MAEO;AAAA,gCACN,OAAOoC,IAAA,CAAKrD,SAAL,CAAeiB,gBAAf,CAAP,CADM;AAAA,6BAHwB;AAAA,yBADhB,CAAjB,CADgE;AAAA,oBAUhE,IAAIqF,cAAA,GAAiBpI,CAAA,CAAEqI,KAAF,CAAQ9F,UAAR,EAAoB,MAApB,CAArB,CAVgE;AAAA,oBAYhER,IAAA,GAAOqG,cAAA,CAAeE,IAAf,CAAoB,GAApB,CAAP,CAZgE;AAAA,oBAehE5D,QAAA,GAAW,YAAW;AAAA,wBACrBS,IAAA,CAAKgC,iBAAL,CAAuB1D,IAAvB,CAA4B2E,cAA5B,EADqB;AAAA,qBAAtB,CAfgE;AAAA,iBAdhB;AAAA,gBAkCjDrG,IAAA,GAAOvB,OAAA,CAAQuB,IAAR,IAAgBA,IAAvB,CAlCiD;AAAA,gBAqCjD7B,QAAA,CAASuH,MAAT,CAAgB9G,SAAhB,CAA0BuH,KAA1B,CAAgCtH,IAAhC,CAAqC,IAArC,EAA2CsH,KAA3C,EAAkDnG,IAAlD,EAAwD2C,QAAxD,EArCiD;AAAA,aAAlD,C;YAwCA,IAAI6D,UAAA,GAAa,cAAjB,EACCC,UAAA,GAAa,QADd,EAECC,YAAA,GAAe,qBAFhB,C;YAIAhB,MAAA,CAAOiB,cAAP,GAAwB,UAASR,KAAT,EAAgB;AAAA,gBACvC,IAAIS,UAAA,GAAcH,UAAA,CAAW3H,IAAX,CAAgBqH,KAAhB,KAA0B,EAAClB,KAAA,EAAO,CAAC,CAAT,EAA5C,EACC4B,UAAA,GAAcL,UAAA,CAAW1H,IAAX,CAAgBqH,KAAhB,KAA0B,EAAClB,KAAA,EAAO,CAAC,CAAT,EADzC,EAEC6B,UAAA,GAAaX,KAAA,CAAMY,KAAN,CAAYL,YAAZ,KAA6B,EAF3C,CADuC;AAAA,gBAKvCP,KAAA,GAAQhI,QAAA,CAASuH,MAAT,CAAgB9G,SAAhB,CAA0B+H,cAA1B,CAAyC9H,IAAzC,CAA8C,IAA9C,EAAoDsH,KAApD,CAAR,CALuC;AAAA,gBAQvC,IAAIS,UAAA,CAAW3B,KAAX,IAAoB,CAAxB,EAA2B;AAAA,oBAE1B,IAAI4B,UAAA,IAAc,CAAlB,EAAqB;AAAA,wBAEpBV,KAAA,CAAMS,UAAN,GAAmBA,UAAA,CAAW3B,KAAX,GAAmB4B,UAAA,CAAW5B,KAAjD,CAFoB;AAAA,qBAArB,MAGO;AAAA,wBACNkB,KAAA,CAAMS,UAAN,GAAmB,CAAC,CAApB,CADM;AAAA,qBALmB;AAAA,iBARY;AAAA,gBAmBvCT,KAAA,CAAMW,UAAN,GAAmB7I,CAAA,CAAE6I,UAAF,EAAcpD,GAAd,CAAkB,UAAS1D,IAAT,EAAe;AAAA,oBACnD,OAAOA,IAAA,CAAKgH,OAAL,CAAa,KAAb,EAAoB,EAApB,EAAwBC,SAAxB,CAAkC,CAAlC,CAAP,CADmD;AAAA,iBAAjC,CAAnB,CAnBuC;AAAA,gBAuBvC,OAAOd,KAAP,CAvBuC;AAAA,aAAxC,C;YA0BAT,MAAA,CAAOwB,kBAAP,GAA4B,UAASf,KAAT,EAAgBgB,QAAhB,EAA0B;AAAA,gBACrD,IAAI/C,MAAA,GAASjG,QAAA,CAASuH,MAAT,CAAgB9G,SAAhB,CAA0BsI,kBAA1B,CAA6CrI,IAA7C,CACZ,IADY,EACNsH,KADM,EACCgB,QADD,CAAb,CADqD;AAAA,gBAIrD,IAAIC,WAAA,GAAc,EAAlB,CAJqD;AAAA,gBAOrD,IAAIrE,MAAA,GAASqB,MAAA,CAAOrB,MAApB,CAPqD;AAAA,gBAQrD,IAAIoD,KAAA,CAAMS,UAAV,EAAsB;AAAA,oBACrB,IAAIT,KAAA,CAAMS,UAAN,GAAmB,CAAvB,EAA0B;AAAA,wBAEzB,OAAOxC,MAAP,CAFyB;AAAA,qBAA1B,MAGO;AAAA,wBACNrB,MAAA,GAASA,MAAA,GAAS,CAAlB,CADM;AAAA,qBAJc;AAAA,iBAR+B;AAAA,gBAiBrDsE,OAAA,CAAQC,GAAR,CAAY,UAAZ,EAAwBvE,MAAxB,EAAgCoD,KAAA,CAAMW,UAAtC,EAjBqD;AAAA,gBAmBrD,KAAK,IAAIS,CAAA,GAAI,CAAR,CAAL,CAAgBA,CAAA,GAAIxE,MAApB,EAA4BwE,CAAA,EAA5B,EAAiC;AAAA,oBAChC,IAAItJ,CAAA,CAAE8D,QAAF,CAAWqC,MAAA,CAAOmD,CAAP,CAAX,CAAJ,EAA2B;AAAA,wBAC1B,IAAIpB,KAAA,CAAMW,UAAN,IAAoBX,KAAA,CAAMW,UAAN,CAAiB/D,MAAjB,IAA2BwE,CAAA,GAAI,CAAvD,EAA0D;AAAA,4BACzDH,WAAA,CAAYjB,KAAA,CAAMW,UAAN,CAAiBS,CAAjB,CAAZ,IAAmCnD,MAAA,CAAOmD,CAAP,CAAnC,CADyD;AAAA,yBADhC;AAAA,qBADK;AAAA,iBAnBoB;AAAA,gBA2BrDF,OAAA,CAAQC,GAAR,CAAY,UAAZ,EAAwBF,WAAxB,EA3BqD;AAAA,gBA6BrD,OAAO,KAAKzB,eAAL,GAAuB,CAACyB,WAAD,CAAvB,GAAuChD,MAA9C,CA7BqD;AAAA,aAAtD,C;YA0CAsB,MAAA,CAAO8B,UAAP,GAAoB,UAASL,QAAT,EAAmB;AAAA,gBACtC,IAAI/D,IAAA,GAAO,IAAX,CADsC;AAAA,gBAGtC+D,QAAA,GAAWA,QAAA,IAAYhJ,QAAA,CAASsJ,OAAT,CAAiBN,QAAxC,CAHsC;AAAA,gBAKtC,IAAIO,UAAA,GAAa,KAAKC,aAAL,CAAmBR,QAAnB,CAAjB,CALsC;AAAA,gBAQtCS,OAAA,CAAQ,CAAC,KAAK/B,WAAL,GAAmB6B,UAApB,CAAR,EAAyC,UAASG,UAAT,EAAqB;AAAA,oBAE7D,IAAI,CAACzE,IAAA,CAAK8C,OAAL,CAAawB,UAAb,CAAL,EAA+B;AAAA,wBAE9BG,UAAA,CAAWzE,IAAX,EAF8B;AAAA,wBAK9BA,IAAA,CAAK8C,OAAL,CAAawB,UAAb,IAA2B,IAA3B,CAL8B;AAAA,wBAQ9BvJ,QAAA,CAASsJ,OAAT,CAAiBK,OAAjB,CAAyBX,QAAzB,EAR8B;AAAA,qBAF8B;AAAA,iBAA9D,EAYG,KAAKpB,aAZR,EARsC;AAAA,aAAvC,C;YAuBAL,MAAA,CAAOiC,aAAP,GAAuB,UAASR,QAAT,EAAmB;AAAA,gBACzC,OAAOlJ,CAAA,CAAEkJ,QAAA,CAASY,KAAT,CAAe,GAAf,CAAF,EAAuBhE,IAAvB,CAA4B9F,CAAA,CAAE+J,QAA9B,KAA2C,KAAKlC,iBAAvD,CADyC;AAAA,aAA1C,C;YAIAtG,MAAA,CAAOC,OAAP,GAAiBtB,QAAA,CAASuH,MAAT,CAAgB3G,MAAhB,CAAuB2G,MAAvB,CAAjB,C;;;YCtMA,a;YAEA,IAAIzH,CAAA,GAAIC,QAAA,CAAQ,EAAR,CAAR,C;YACA,IAAIC,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YAGA,IAAI+J,CAAA,GAAI9J,QAAA,CAAS8J,CAAjB,C;YAEA,IAAIC,MAAA,GAASC,KAAA,CAAMvJ,SAAN,CAAgBsJ,MAA7B,C;YAGA,IAAIE,qBAAA,GAAwB,gBAA5B,C;YAEA,SAASC,kBAAT,CAA4BhG,SAA5B,EAAuC5D,OAAvC,EAAgD;AAAA,gBAC/C,IAAIqG,OAAA,GAAUrG,OAAA,CAAQqG,OAAtB,CAD+C;AAAA,gBAE/C,IAAIF,OAAA,GAAUnG,OAAA,CAAQmG,OAAtB,CAF+C;AAAA,gBAG/C,OAAO9E,OAAA,CACNgF,OAAA,IAAW7G,CAAA,CAAEqK,QAAF,CAAWrK,CAAA,CAAE6E,OAAF,CAAUgC,OAAV,IAAqBA,OAArB,GAA+B,CAACA,OAAD,CAA1C,EAAqDzC,SAArD,CAAX,IACAuC,OAAA,IAAW,CAAC3G,CAAA,CAAEqK,QAAF,CAAWrK,CAAA,CAAE6E,OAAF,CAAU8B,OAAV,IAAqBA,OAArB,GAA+B,CAACA,OAAD,CAA1C,EAAqDvC,SAArD,CAFN,CAAP,CAH+C;AAAA,a;YAchD,IAAI3C,IAAA,GAAO;AAAA,oBAEV6I,eAAA,EAAiB,EAFP;AAAA,oBAKVC,YAAA,EAAc,CALJ;AAAA,oBASVC,aAAA,EAAe,IATL;AAAA,oBAYVtI,QAAA,EAAU,KAZA;AAAA,iBAAX,C;YAeA,IAAIuI,iBAAA,GAAoB;AAAA,oBAAC,OAAD;AAAA,oBAAU,QAAV;AAAA,oBAAoB,aAApB;AAAA,iBAAxB,C;YACA,IAAIC,gBAAA,GAAmB;AAAA,oBAAC,YAAD;AAAA,oBAAe,aAAf;AAAA,oBAA8B,kBAA9B;AAAA,iBAAvB,C;YACA,IAAIC,iBAAA,GAAoB3K,CAAA,CAAE8G,KAAF,CACvB2D,iBADuB,EACJC,gBADI,EACc;AAAA,oBAAC,IAAD;AAAA,oBAAO,UAAP;AAAA,iBADd,CAAxB,C;YAGA,IAAIE,WAAA,GAAc5K,CAAA,CAAE8G,KAAF,CAAQ6D,iBAAR,EAA2B;AAAA,oBAC5C,OAD4C;AAAA,oBACnC,YADmC;AAAA,oBACrB,MADqB;AAAA,oBACb,mBADa;AAAA,oBAE5C,UAF4C;AAAA,oBAEhC,iBAFgC;AAAA,iBAA3B,CAAlB,C;YAUAlJ,IAAA,CAAKuG,WAAL,GAAmB,UAASxH,OAAT,EAAkB;AAAA,gBACpC,IAAI2E,IAAA,GAAO,IAAX,CADoC;AAAA,gBAGpC3E,OAAA,GAAUA,OAAA,IAAW,EAArB,CAHoC;AAAA,gBAMpC,KAAKqK,IAAL,GAAY,EAAZ,CANoC;AAAA,gBASpC7K,CAAA,CAAEc,MAAF,CAAS,IAAT,EAAed,CAAA,CAAEqC,IAAF,CAAO7B,OAAP,EAAgBoK,WAAhB,CAAf,EAToC;AAAA,gBAWpC,KAAKpK,OAAL,GAAeA,OAAf,CAXoC;AAAA,gBAcpCR,CAAA,CAAE2K,iBAAF,EAAqB9E,IAArB,CAA0B,UAASiF,GAAT,EAAc;AAAA,oBACvC3F,IAAA,CAAK2F,GAAL,IAAY9K,CAAA,CAAEkH,MAAF,CAAS/B,IAAT,EAAe2F,GAAf,EAAoB,EAApB,CAAZ,CADuC;AAAA,iBAAxC,EAdoC;AAAA,gBAmBpC,KAAKC,oBAAL,GAnBoC;AAAA,gBAsBpC,KAAKC,cAAL,GAtBoC;AAAA,gBAyBpC,KAAKC,mBAAL,GAzBoC;AAAA,gBA4BpC,KAAKC,aAAL,GA5BoC;AAAA,gBA+BpClL,CAAA,CAAE,KAAKmL,KAAP,EAActF,IAAd,CAAmB,UAASuF,UAAT,EAAqBhH,SAArB,EAAgC;AAAA,oBAClDe,IAAA,CAAKkG,oBAAL,CAA0B,OAA1B,EAAmCjH,SAAnC,EAA8CgH,UAA9C,EADkD;AAAA,iBAAnD,EA/BoC;AAAA,gBAqCpClL,QAAA,CAASuB,IAAT,CAAcb,IAAd,CAAmB,IAAnB,EAAyBZ,CAAA,CAAEsL,IAAF,CAAO9K,OAAP,EAAgB,OAAhB,EAAyB,YAAzB,CAAzB,EArCoC;AAAA,gBAwCpCR,CAAA,CAAE,KAAKmL,KAAP,EAActF,IAAd,CAAmB,UAASsF,KAAT,EAAgB;AAAA,oBAClCnL,CAAA,CAAEmL,KAAF,EAAStF,IAAT,CAAc,UAAS7D,IAAT,EAAe;AAAA,wBAC5B,IAAIA,IAAA,CAAKC,SAAL,EAAJ,EAAsB;AAAA,4BACrBkD,IAAA,CAAKiC,YAAL,CAAkBpF,IAAlB,EAAwB,iBAAxB,EAA2CmD,IAAA,CAAKoG,IAAL,EAA3C,EADqB;AAAA,yBADM;AAAA,qBAA7B,EADkC;AAAA,iBAAnC,EAxCoC;AAAA,gBAiDpC,KAAKf,aAAL,GAAqB,KAArB,CAjDoC;AAAA,gBAuDpCxK,CAAA,CAAE,KAAKwL,WAAP,EAAoB3F,IAApB,CAAyB,UAAStF,UAAT,EAAqBwB,IAArB,EAA2B;AAAA,oBACnDoD,IAAA,CAAKkG,oBAAL,CAA0B,aAA1B,EAAyCtJ,IAAzC,EAA+CxB,UAA/C,EADmD;AAAA,iBAApD,EAvDoC;AAAA,gBA4DpCP,CAAA,CAAE,KAAKyL,MAAP,EAAe5F,IAAf,CAAoB,UAASyB,KAAT,EAAgBvF,IAAhB,EAAsB;AAAA,oBACzCoD,IAAA,CAAKkG,oBAAL,CAA0B,QAA1B,EAAoCtJ,IAApC,EAA0CuF,KAA1C,EADyC;AAAA,iBAA1C,EA5DoC;AAAA,aAArC,C;YA0EA7F,IAAA,CAAK+E,OAAL,GAAe,UAASqE,IAAT,EAAe;AAAA,gBAC7B,IAAIA,IAAJ;AAAA,oBAAU,KAAKA,IAAL,GAAYA,IAAZ,CADmB;AAAA,gBAE7B,OAAO,IAAP,CAF6B;AAAA,aAA9B,C;YAaApJ,IAAA,CAAKU,WAAL,GAAmB,YAAW;AAAA,gBAC7B,OAAO,IAAP,CAD6B;AAAA,aAA9B,C;YAUAV,IAAA,CAAK8J,IAAL,GAAY,YAAW;AAAA,gBACtB,IAAI,CAAC,KAAKf,aAAV,EAAyB;AAAA,oBACxB,MAAM,IAAItG,KAAJ,CAAU,qDAAV,CAAN,CADwB;AAAA,iBADH;AAAA,gBAKtB,IAAIiB,IAAA,GAAO,IAAX,CALsB;AAAA,gBAOtB,KAAKoF,YAAL,GAPsB;AAAA,gBAStB,KAAKlJ,OAAL,CAAa,cAAb,EATsB;AAAA,gBAYtB,OAAOrB,CAAA,CAAE0L,IAAF,CAAO,YAAW;AAAA,oBACxB1L,CAAA,CAAE2L,KAAF,CAAQ,YAAW;AAAA,wBAClBxG,IAAA,CAAKoF,YAAL,GADkB;AAAA,wBAElB,IAAI,CAACpF,IAAA,CAAKlD,SAAL,EAAL,EAAuB;AAAA,4BACtBkD,IAAA,CAAK9D,OAAL,CAAa,iBAAb,EADsB;AAAA,yBAFL;AAAA,qBAAnB,EADwB;AAAA,iBAAlB,CAAP,CAZsB;AAAA,aAAvB,C;YA4BAI,IAAA,CAAKQ,SAAL,GAAiB,YAAW;AAAA,gBAC3B,OAAO,KAAKsI,YAAL,GAAoB,CAA3B,CAD2B;AAAA,aAA5B,C;YAYA9I,IAAA,CAAKmK,OAAL,GAAe,UAASpL,OAAT,EAAkB;AAAA,gBAEhC,IAAI,KAAKyB,SAAL,EAAJ;AAAA,oBAAsB,OAAO,IAAP,CAFU;AAAA,gBAIhCzB,OAAA,GAAUA,OAAA,IAAW,EAArB,CAJgC;AAAA,gBAMhC,IAAI,KAAKqL,QAAT,EAAmB;AAAA,oBAElB,IAAIrL,OAAA,CAAQsL,KAAR,IAAiB,CAAC,KAAK5J,QAAvB,IAAmC,CAAC,KAAKC,WAAL,EAAxC,EAA4D;AAAA,wBAE3D,KAAK8E,MAAL,GAF2D;AAAA,wBAK3D,IAAI4D,IAAA,GAAO7K,CAAA,CAAE,IAAF,EACTuF,KADS,GAET2B,MAFS,CAEF,iBAFE,EAGTpG,MAHS,CAGF,KAAKiL,eAAL,EAHE,EAITnG,KAJS,EAAX,CAL2D;AAAA,wBAU3D,IAAIoG,IAAA,GAAO,KAAKC,cAAL,CAAoB,KAAKJ,QAAzB,EAAmChB,IAAnC,CAAX,CAV2D;AAAA,wBAY3D,IAAI,CAAC7K,CAAA,CAAE8D,QAAF,CAAWkI,IAAX,CAAL,EAAuB;AAAA,4BACtB,MAAM,IAAI9H,KAAJ,CAAU,qDAAV,CAAN,CADsB;AAAA,yBAZoC;AAAA,wBAiB3D,IAAIgI,GAAA,GAAMlC,CAAA,CAAEgC,IAAF,CAAV,CAjB2D;AAAA,wBAmB3D,IAAI,CAACE,GAAA,CAAIpH,MAAT,EAAiB;AAAA,4BAChB,MAAM,IAAIZ,KAAJ,CAAU,mCAAV,CAAN,CADgB;AAAA,yBAnB0C;AAAA,wBAuB3D,IAAIgI,GAAA,CAAIpH,MAAJ,GAAa,CAAjB,EAAoB;AAAA,4BACnB,MAAM,IAAIZ,KAAJ,CACL,8DADK,CAAN,CADmB;AAAA,yBAvBuC;AAAA,wBA6B3D,KAAKiI,UAAL,CAAgBD,GAAhB,EA7B2D;AAAA,qBAF1C;AAAA,iBAAnB,MAiCO;AAAA,oBAEN,IAAI,CAAC,KAAKA,GAAL,CAASpH,MAAd;AAAA,wBAAsB,KAAKsH,cAAL,GAFhB;AAAA,iBAvCyB;AAAA,gBA6ChC,KAAK/K,OAAL,CAAa,gBAAb,EA7CgC;AAAA,gBAgDhC,KAAKqF,WAAL,CAAiBlG,OAAjB,EAhDgC;AAAA,gBAkDhC,IAAI,CAAC,KAAK+C,MAAN,IAAgB,KAAK8I,UAAzB,EAAqC;AAAA,oBAEpC,KAAKzF,WAAL,CAAiBpG,OAAjB,EAFoC;AAAA,oBAKpC,KAAK8L,MAAL,GALoC;AAAA,iBAlDL;AAAA,gBA2DhC,OAAO,IAAP,CA3DgC;AAAA,aAAjC,C;YAqEA7K,IAAA,CAAKsF,MAAL,GAAc,UAASvG,OAAT,EAAkB;AAAA,gBAC/B,OAAO,KAAKoL,OAAL,CAAapL,OAAb,CAAP,CAD+B;AAAA,aAAhC,C;YAWAiB,IAAA,CAAKsK,eAAL,GAAuB,YAAW;AAAA,gBACjC,OAAO,KAAKlB,IAAZ,CADiC;AAAA,aAAlC,C;YAcApJ,IAAA,CAAKwK,cAAL,GAAsB,UAASJ,QAAT,EAAmBhB,IAAnB,EAAyB;AAAA,gBAC9C,IAAI,CAAC7K,CAAA,CAAE2E,UAAF,CAAakH,QAAb,CAAL,EAA6B;AAAA,oBAC5B,MAAM,IAAI3H,KAAJ,CAAU,sCAAV,CAAN,CAD4B;AAAA,iBADiB;AAAA,gBAK9C,OAAO2H,QAAA,CAAShB,IAAT,CAAP,CAL8C;AAAA,aAA/C,C;YAgBApJ,IAAA,CAAKiF,WAAL,GAAmB,UAASlG,OAAT,EAAkB;AAAA,gBACpC,IAAI2E,IAAA,GAAO,IAAX,CADoC;AAAA,gBAIpCnF,CAAA,CAAE,KAAKmL,KAAP,EAActF,IAAd,CAAmB,UAASuF,UAAT,EAAqBhH,SAArB,EAAgC;AAAA,oBAClD,IAAIgG,kBAAA,CAAmBhG,SAAnB,EAA8B5D,OAA9B,CAAJ;AAAA,wBAA4C,OADM;AAAA,oBAIlD,IAAI,CAAC4K,UAAA,CAAWtG,MAAhB;AAAA,wBAAwB,OAJ0B;AAAA,oBAOlD9E,CAAA,CAAEoL,UAAF,EAAcvF,IAAd,CAAmB,UAAS7D,IAAT,EAAe;AAAA,wBACjCA,IAAA,CAAK+E,MAAL,CAAY/G,CAAA,CAAEsL,IAAF,CAAO9K,OAAP,EAAgB,SAAhB,EAA2B,SAA3B,CAAZ,EADiC;AAAA,qBAAlC,EAPkD;AAAA,oBAYlD,IAAI6L,UAAA,GAAajI,SAAA,GAAYe,IAAA,CAAK6E,CAAL,CAAO5F,SAAP,EAAkBmI,KAAlB,EAAZ,GAAwCpH,IAAA,CAAK+G,GAA9D,CAZkD;AAAA,oBAclD,IAAI,CAACG,UAAA,CAAWvH,MAAhB,EAAwB;AAAA,wBACvB,MAAM,IAAIZ,KAAJ,CAAU,gBAAgBE,SAAhB,GAA4B,gBAAtC,CAAN,CADuB;AAAA,qBAd0B;AAAA,oBAkBlD,IAAIoI,WAAA,GAAcH,UAAA,CAAW9H,GAAX,CAAe,CAAf,CAAlB,CAlBkD;AAAA,oBAqBlD,IAAIkI,UAAA,GAAazM,CAAA,CAAEoL,UAAF,EAAclF,IAAd,CAAmB,UAASlE,IAAT,EAAe;AAAA,4BAClD,OACC,CAACA,IAAA,CAAKE,QAAN,IACA,CAACF,IAAA,CAAKqK,UADN,IAEArK,IAAA,CAAKqK,UAAL,CAAgB9H,GAAhB,CAAoB,CAApB,MAA2BiI,WAH5B,CADkD;AAAA,yBAAlC,CAAjB,CArBkD;AAAA,oBA6BlD,IAAIC,UAAJ,EAAgB;AAAA,wBAEf,IAAIC,IAAA,GAAO,EAAX,CAFe;AAAA,wBAIf1M,CAAA,CAAEoL,UAAF,EAAcvF,IAAd,CAAmB,UAAS7D,IAAT,EAAe;AAAA,4BACjCA,IAAA,CAAKqK,UAAL,GAAkBA,UAAlB,CADiC;AAAA,4BAEjCK,IAAA,CAAKhH,IAAL,CAAU1D,IAAA,CAAKkK,GAAf,EAFiC;AAAA,yBAAlC,EAJe;AAAA,wBAYfG,UAAA,CAAWM,MAAX,CAAkBD,IAAlB,EAZe;AAAA,qBA7BkC;AAAA,iBAAnD,EAJoC;AAAA,gBAkDpC,OAAO,IAAP,CAlDoC;AAAA,aAArC,C;YA+DAjL,IAAA,CAAKgF,OAAL,GAAe,UAASzE,IAAT,EAAeoC,SAAf,EAA0B4C,KAA1B,EAAiC;AAAA,gBAC/C,OAAO,KAAK4F,YAAL,CAAkB,CAAC5K,IAAD,CAAlB,EAA0BoC,SAA1B,EAAqC4C,KAArC,CAAP,CAD+C;AAAA,aAAhD,C;YAcAvF,IAAA,CAAKoL,QAAL,GAAgB,UAAS1B,KAAT,EAAgB/G,SAAhB,EAA2B4C,KAA3B,EAAkC;AAAA,gBACjD,OAAO,KAAK4F,YAAL,CAAkBzB,KAAlB,EAAyB/G,SAAzB,EAAoC4C,KAApC,CAAP,CADiD;AAAA,aAAlD,C;YAaAvF,IAAA,CAAKqL,UAAL,GAAkB,UAAS9K,IAAT,EAAeoC,SAAf,EAA0B;AAAA,gBAC3C,OAAO,KAAK2I,YAAL,CAAkB,CAAC/K,IAAD,CAAlB,EAA0BoC,SAA1B,CAAP,CAD2C;AAAA,aAA5C,C;YAaA3C,IAAA,CAAKuL,WAAL,GAAmB,UAAS7B,KAAT,EAAgB/G,SAAhB,EAA2B;AAAA,gBAC7C,OAAO,KAAK2I,YAAL,CAAkB5B,KAAlB,EAAyB/G,SAAzB,CAAP,CAD6C;AAAA,aAA9C,C;YAaA3C,IAAA,CAAKwL,WAAL,GAAmB,UAASjL,IAAT,EAAeoC,SAAf,EAA0B;AAAA,gBAC5C,OAAO,KAAK2I,YAAL,CAAkB,CAAC/K,IAAD,CAAlB,EAA0BoC,SAA1B,EAAqC,CAArC,CAAP,CAD4C;AAAA,aAA7C,C;YAaA3C,IAAA,CAAKyL,YAAL,GAAoB,UAAS/B,KAAT,EAAgB/G,SAAhB,EAA2B;AAAA,gBAC9C,OAAO,KAAK2I,YAAL,CAAkB5B,KAAlB,EAAyB/G,SAAzB,EAAoC,CAApC,CAAP,CAD8C;AAAA,aAA/C,C;YAcA3C,IAAA,CAAK0L,UAAL,GAAkB,UAASnL,IAAT,EAAeoC,SAAf,EAA0B4C,KAA1B,EAAiC;AAAA,gBAClD,OAAO,KAAK+F,YAAL,CAAkB,CAAC/K,IAAD,CAAlB,EAA0BoC,SAA1B,EAAqC4C,KAArC,CAAP,CADkD;AAAA,aAAnD,C;YAcAvF,IAAA,CAAK2L,WAAL,GAAmB,UAASjC,KAAT,EAAgB/G,SAAhB,EAA2B4C,KAA3B,EAAkC;AAAA,gBACpD,OAAO,KAAK+F,YAAL,CAAkB5B,KAAlB,EAAyB/G,SAAzB,EAAoC4C,KAApC,CAAP,CADoD;AAAA,aAArD,C;YAcAvF,IAAA,CAAK4L,UAAL,GAAkB,UAASrL,IAAT,EAAeoC,SAAf,EAA0B4C,KAA1B,EAAiC;AAAA,gBAClD,IAAIlE,SAAA,CAAUgC,MAAV,GAAmB,CAAvB,EAA0B;AAAA,oBACzB,MAAM,IAAIZ,KAAJ,CAAU,+CAAV,CAAN,CADyB;AAAA,iBADwB;AAAA,gBAKlD,IAAIlE,CAAA,CAAE8D,QAAF,CAAW9B,IAAX,CAAJ,EAAsB;AAAA,oBACrBgF,KAAA,GAAQ5C,SAAR,CADqB;AAAA,oBAErBA,SAAA,GAAYpC,IAAZ,CAFqB;AAAA,oBAGrBA,IAAA,GAAO,KAAKsL,OAAL,CAAalJ,SAAb,EAAwB4C,KAAxB,CAAP,CAHqB;AAAA,oBAIrB,IAAI,CAAChF,IAAL;AAAA,wBAAW,OAAO,IAAP,CAJU;AAAA,iBAL4B;AAAA,gBAYlD,OAAO,KAAKuL,YAAL,CAAkB,CAACvL,IAAD,CAAlB,EAA0BoC,SAA1B,CAAP,CAZkD;AAAA,aAAnD,C;YAyBA3C,IAAA,CAAK+L,WAAL,GAAmB,UAASrC,KAAT,EAAgB/G,SAAhB,EAA2B;AAAA,gBAC7C,IAAIpE,CAAA,CAAE8D,QAAF,CAAWqH,KAAX,CAAJ,EAAuB;AAAA,oBACtB/G,SAAA,GAAY+G,KAAZ,CADsB;AAAA,oBAEtBA,KAAA,GAAQ,KAAKsC,QAAL,CAAcrJ,SAAd,CAAR,CAFsB;AAAA,iBADsB;AAAA,gBAM7C,OAAO,KAAKmJ,YAAL,CAAkBpC,KAAlB,EAAyB/G,SAAzB,CAAP,CAN6C;AAAA,aAA9C,C;YAiBA3C,IAAA,CAAK6L,OAAL,GAAe,UAASlJ,SAAT,EAAoB4C,KAApB,EAA2B;AAAA,gBACzC,OAAO,KAAKyG,QAAL,CAAcrJ,SAAd,EAAyB4C,KAAA,IAAS,CAAlC,KAAwC,IAA/C,CADyC;AAAA,aAA1C,C;YAWAvF,IAAA,CAAKgM,QAAL,GAAgB,UAASrJ,SAAT,EAAoB;AAAA,gBACnC,OAAOpE,CAAA,CAAE0N,KAAF,CAAQ,KAAKvC,KAAL,CAAW/G,SAAX,CAAR,KAAkC,EAAzC,CADmC;AAAA,aAApC,C;YAIA3C,IAAA,CAAKsL,YAAL,GAAoB,UAAS5B,KAAT,EAAgB/G,SAAhB,EAA2B4C,KAA3B,EAAkC;AAAA,gBACrD,IAAI7B,IAAA,GAAO,IAAX,CADqD;AAAA,gBAGrD,IAAIiG,UAAA,GAAa,KAAKqC,QAAL,CAAcrJ,SAAd,CAAjB,CAHqD;AAAA,gBAKrDpE,CAAA,CAAEmL,KAAF,EAAStF,IAAT,CAAc,UAAS7D,IAAT,EAAe;AAAA,oBAC5B,IAAIA,IAAA,CAAKuB,MAAT,EAAiB;AAAA,wBAChBvB,IAAA,CAAKuB,MAAL,CAAY8J,UAAZ,CAAuBrL,IAAvB,EAA6BA,IAAA,CAAKoC,SAAlC,EADgB;AAAA,qBADW;AAAA,iBAA7B,EALqD;AAAA,gBAWrD,IAAIgH,UAAA,CAAWtG,MAAf,EAAuB;AAAA,oBAEtB,IAAI,OAAOkC,KAAP,KAAiB,WAArB,EAAkC;AAAA,wBACjCA,KAAA,GAAQoE,UAAA,CAAWtG,MAAnB,CADiC;AAAA,qBAFZ;AAAA,oBAOtBmF,MAAA,CAAOpH,KAAP,CAAa,KAAKsI,KAAL,CAAW/G,SAAX,CAAb,EAAoC;AAAA,wBAAC4C,KAAD;AAAA,wBAAQ,CAAR;AAAA,sBAAW2G,MAAX,CAAkBxC,KAAlB,CAApC,EAPsB;AAAA,iBAAvB,MAQO;AAAA,oBAEN,KAAKA,KAAL,CAAW/G,SAAX,IAAwB+G,KAAxB,CAFM;AAAA,iBAnB8C;AAAA,gBAyBrDnL,CAAA,CAAEmL,KAAF,EAAStF,IAAT,CAAc,UAAS7D,IAAT,EAAe;AAAA,oBAC5BA,IAAA,CAAKuB,MAAL,GAAc4B,IAAd,CAD4B;AAAA,oBAE5BnD,IAAA,CAAKoC,SAAL,GAAiBA,SAAjB,CAF4B;AAAA,iBAA7B,EAzBqD;AAAA,gBA8BrD,KAAKiH,oBAAL,CAA0B,OAA1B,EAAmCjH,SAAnC,EAA8C+G,KAA9C,EA9BqD;AAAA,gBAgCrD,OAAO,IAAP,CAhCqD;AAAA,aAAtD,C;YAmCA1J,IAAA,CAAKmL,YAAL,GAAoB,UAASzB,KAAT,EAAgB/G,SAAhB,EAA2B4C,KAA3B,EAAkC;AAAA,gBACrD,IAAI4G,QAAJ,CADqD;AAAA,gBAGrD,IAAI,OAAO5G,KAAP,KAAiB,WAArB,EAAkC;AAAA,oBAEjC4G,QAAA,GAAW,KAAKH,QAAL,CAAcrJ,SAAd,CAAX,CAFiC;AAAA,iBAAlC,MAGO;AAAA,oBAENwJ,QAAA,GAAW,KAAKN,OAAL,CAAalJ,SAAb,EAAwB4C,KAAxB,CAAX,CAFM;AAAA,oBAGN4G,QAAA,GAAWA,QAAA,GAAW,CAACA,QAAD,CAAX,GAAwB,EAAnC,CAHM;AAAA,iBAN8C;AAAA,gBAarD,IACCA,QAAA,CAAS9I,MAAT,KAAoBqG,KAAA,CAAMrG,MAA1B,IACA9E,CAAA,CAAE4N,QAAF,EAAYC,GAAZ,CAAgB,UAASC,OAAT,EAAkB9G,KAAlB,EAAyB;AAAA,wBACxC,OAAO8G,OAAA,KAAY3C,KAAA,CAAMnE,KAAN,CAAnB,CADwC;AAAA,qBAAzC,CAFD;AAAA,oBAKE,OAAO,IAAP,CAlBmD;AAAA,gBAoBrD,IAAI4G,QAAA,CAAS9I,MAAb,EAAqB;AAAA,oBAEpB,KAAKyI,YAAL,CAAkBK,QAAlB,EAA4BxJ,SAA5B,EAFoB;AAAA,oBAKpBpE,CAAA,CAAE4N,QAAF,EAAY/H,IAAZ,CAAiB,UAAS7D,IAAT,EAAe;AAAA,wBAC/BA,IAAA,CAAKwC,MAAL,GAD+B;AAAA,qBAAhC,EALoB;AAAA,iBApBgC;AAAA,gBA+BrD,OAAO,KAAKuI,YAAL,CAAkB5B,KAAlB,EAAyB/G,SAAzB,EAAoC4C,KAApC,CAAP,CA/BqD;AAAA,aAAtD,C;YAkCAvF,IAAA,CAAK8L,YAAL,GAAoB,UAASpC,KAAT,EAAgB/G,SAAhB,EAA2B;AAAA,gBAC9C,IAAIe,IAAA,GAAO,IAAX,CAD8C;AAAA,gBAG9C,IAAIiG,UAAA,GAAa,KAAKqC,QAAL,CAAcrJ,SAAd,CAAjB,CAH8C;AAAA,gBAK9C,IAAI,CAACgH,UAAA,CAAWtG,MAAhB;AAAA,oBAAwB,OAAO,IAAP,CALsB;AAAA,gBAO9C,IAAIiJ,QAAA,GAAW/N,CAAA,CAAEmL,KAAF,EACb5F,KADa,GAEbC,IAFa,GAGbC,GAHa,CAGT,UAASzD,IAAT,EAAe;AAAA,wBACnB,OAAO;AAAA,4BACNA,IAAA,EAAMA,IADA;AAAA,4BAENgF,KAAA,EAAOhH,CAAA,CAAEgO,OAAF,CAAU5C,UAAV,EAAsBpJ,IAAtB,CAFD;AAAA,yBAAP,CADmB;AAAA,qBAHN,EASbiE,MATa,CASN,UAASgI,OAAT,EAAkB;AAAA,wBACzB,OAAOA,OAAA,CAAQjH,KAAR,IAAiB,CAAxB,CADyB;AAAA,qBATZ,EAYbkH,MAZa,CAYN,UAASD,OAAT,EAAkB;AAAA,wBACzB,OAAO,CAACA,OAAA,CAAQjH,KAAhB,CADyB;AAAA,qBAZZ,EAebpB,KAfa,EAAf,CAP8C;AAAA,gBAwB9C,IAAI,CAACmI,QAAA,CAASjJ,MAAd;AAAA,oBAAsB,OAAO,IAAP,CAxBwB;AAAA,gBA0B9C9E,CAAA,CAAE+N,QAAF,EAAYlI,IAAZ,CAAiB,UAASoI,OAAT,EAAkB;AAAA,oBAClC,IAAIjM,IAAA,GAAOiM,OAAA,CAAQjM,IAAnB,CADkC;AAAA,oBAIlCiI,MAAA,CAAOrJ,IAAP,CAAYuE,IAAA,CAAKgG,KAAL,CAAW/G,SAAX,CAAZ,EAAmC6J,OAAA,CAAQjH,KAA3C,EAAkD,CAAlD,EAJkC;AAAA,oBAOlC7B,IAAA,CAAKgJ,sBAAL,CAA4BnM,IAA5B,EAPkC;AAAA,oBAUlC,OAAOA,IAAA,CAAKuB,MAAZ,CAVkC;AAAA,iBAAnC,EA1B8C;AAAA,gBAuC9C,OAAO,IAAP,CAvC8C;AAAA,aAA/C,C;YAkDA9B,IAAA,CAAK0K,UAAL,GAAkB,UAASiC,OAAT,EAAkB;AAAA,gBACnC,IAAIC,WAAA,GAAc,KAAKnC,GAAvB,CADmC;AAAA,gBAGnC,KAAKoC,WAAL,CAAiBF,OAAjB,EAHmC;AAAA,gBAMnC,IAAIC,WAAA,IAAe,KAAKhC,UAAxB,EAAoC;AAAA,oBACnCgC,WAAA,CAAYE,WAAZ,CAAwB,KAAKrC,GAA7B,EADmC;AAAA,iBAND;AAAA,gBAUnC,KAAKsC,QAAL,GAVmC;AAAA,gBAYnC,OAAO,IAAP,CAZmC;AAAA,aAApC,C;YAeA/M,IAAA,CAAK+M,QAAL,GAAgB,YAAW;AAAA,gBAC1B,IAAIrJ,IAAA,GAAO,IAAX,CAD0B;AAAA,gBAG1B,KAAKsJ,GAAL,GAAWzO,CAAA,CAAE,KAAK0O,EAAP,EAAWC,SAAX,CAAqB,UAASC,QAAT,EAAmB;AAAA,oBAClD,OAAOzJ,IAAA,CAAK6E,CAAL,CAAO4E,QAAP,CAAP,CADkD;AAAA,iBAAxC,CAAX,CAH0B;AAAA,gBAO1B,OAAO,IAAP,CAP0B;AAAA,aAA3B,C;YAUAnN,IAAA,CAAKoN,gBAAL,GAAwB,UAASC,QAAT,EAAmB;AAAA,gBAC1CA,QAAA,GAAWA,QAAA,IAAY9O,CAAA,CAAEkH,MAAF,CAAS,IAAT,EAAe,UAAf,CAAvB,CAD0C;AAAA,gBAE1C,IAAI,CAAC4H,QAAL;AAAA,oBAAe,OAAO,IAAP,CAF2B;AAAA,gBAG1C,IAAI3J,IAAA,GAAO,IAAX,CAH0C;AAAA,gBAI1C,KAAK4J,kBAAL,GAJ0C;AAAA,gBAK1C/O,CAAA,CAAE8O,QAAF,EAAYjJ,IAAZ,CAAiB,UAASmJ,KAAT,EAAgBlE,GAAhB,EAAqB;AAAA,oBACrC,IAAIxK,MAAA,GAAS,YAAW;AAAA,wBACvB6E,IAAA,CAAK9D,OAAL,CAAawB,KAAb,CAAmBsC,IAAnB,EAAyB,CAAC6J,KAAD,EAAQrB,MAAR,CAAe3N,CAAA,CAAEiP,OAAF,CAAUnM,SAAV,CAAf,CAAzB,EADuB;AAAA,qBAAxB,CADqC;AAAA,oBAIrC,IAAIgG,KAAA,GAAQgC,GAAA,CAAIhC,KAAJ,CAAUqB,qBAAV,CAAZ,CAJqC;AAAA,oBAKrChF,IAAA,CAAK+J,eAAL,CAAqBpG,KAAA,CAAM,CAAN,CAArB,EAA+BA,KAAA,CAAM,CAAN,CAA/B,EAAyCxI,MAAzC,EALqC;AAAA,iBAAtC,EAL0C;AAAA,gBAY1C,OAAO,IAAP,CAZ0C;AAAA,aAA3C,C;YAeAmB,IAAA,CAAKyN,eAAL,GAAuB,UAASC,SAAT,EAAoBP,QAApB,EAA8BQ,QAA9B,EAAwC;AAAA,gBAC9D,KAAKlD,GAAL,CAASmD,EAAT,CAAYF,SAAA,GAAY,mBAAZ,GAAkC,KAAKG,GAAnD,EAAwDV,QAAxD,EAAkEQ,QAAlE,EAD8D;AAAA,gBAE9D,OAAO,IAAP,CAF8D;AAAA,aAA/D,C;YAKA3N,IAAA,CAAKsN,kBAAL,GAA0B,YAAW;AAAA,gBACpC,IAAI,KAAK7C,GAAT;AAAA,oBAAc,KAAKA,GAAL,CAASqD,GAAT,CAAa,sBAAsB,KAAKD,GAAxC,EADsB;AAAA,gBAEpC,OAAO,IAAP,CAFoC;AAAA,aAArC,C;YAKA7N,IAAA,CAAK+N,iBAAL,GAAyB,UAASL,SAAT,EAAoBP,QAApB,EAA8BQ,QAA9B,EAAwC;AAAA,gBAChE,KAAKlD,GAAL,CAASqD,GAAT,CAAaJ,SAAA,GAAY,mBAAZ,GAAkC,KAAKG,GAApD,EAAyDV,QAAzD,EAAmEQ,QAAnE,EADgE;AAAA,gBAEhE,OAAO,IAAP,CAFgE;AAAA,aAAjE,C;YAKA3N,IAAA,CAAK4J,oBAAL,GAA4B,UAASoE,IAAT,EAAe1N,IAAf,EAAqB2N,QAArB,EAA+B;AAAA,gBAC1D,IAAI,CAAC1P,CAAA,CAAEqK,QAAF,CAAWI,iBAAX,EAA8BgF,IAA9B,CAAL,EAA0C;AAAA,oBACzC,MAAM,IAAIvL,KAAJ,CACL,wBAAwBuL,IAAxB,GAA+B,uBAA/B,GACAhF,iBAAA,CAAkBnC,IAAlB,CAAuB,IAAvB,CAFK,CAAN,CADyC;AAAA,iBADgB;AAAA,gBAQ1D,IAAInD,IAAA,GAAO,IAAX,CAR0D;AAAA,gBAU1D,IAAI,CAACuK,QAAL;AAAA,oBAAeA,QAAA,GAAW,KAAKD,IAAL,EAAW1N,IAAX,CAAX,CAV2C;AAAA,gBAW1D,IAAI,CAAC2N,QAAL;AAAA,oBAAe,OAAO,IAAP,CAX2C;AAAA,gBAY1D,IAAI,CAAC1P,CAAA,CAAE6E,OAAF,CAAU6K,QAAV,CAAL;AAAA,oBAA0BA,QAAA,GAAW,CAACA,QAAD,CAAX,CAZgC;AAAA,gBAa1D,IAAIC,SAAA,GAAY,KAAKC,aAAL,CAAmBH,IAAnB,EAAyB1N,IAAzB,CAAhB,CAb0D;AAAA,gBAc1D,IAAI4N,SAAJ,EAAe;AAAA,oBACd,KAAKxB,sBAAL,CAA4BuB,QAA5B,EADc;AAAA,oBAGd1P,CAAA,CAAE2P,SAAF,EAAa9J,IAAb,CAAkB,UAASuJ,QAAT,EAAmB;AAAA,wBACpCpP,CAAA,CAAE0P,QAAF,EAAY7J,IAAZ,CAAiB,UAASgK,MAAT,EAAiB;AAAA,4BACjC1K,IAAA,CAAK2K,QAAL,CAAcD,MAAd,EAAsBT,QAAA,CAASD,SAA/B,EAA0CC,QAAA,CAASW,OAAnD,EADiC;AAAA,yBAAlC,EADoC;AAAA,qBAArC,EAHc;AAAA,iBAd2C;AAAA,gBAwB1D,OAAO,IAAP,CAxB0D;AAAA,aAA3D,C;YA2BAtO,IAAA,CAAK0M,sBAAL,GAA8B,UAASuB,QAAT,EAAmB;AAAA,gBAChD,IAAIvK,IAAA,GAAO,IAAX,CADgD;AAAA,gBAGhD,IAAI,CAACnF,CAAA,CAAE6E,OAAF,CAAU6K,QAAV,CAAL;AAAA,oBAA0BA,QAAA,GAAW,CAACA,QAAD,CAAX,CAHsB;AAAA,gBAIhD1P,CAAA,CAAE0P,QAAF,EAAY7J,IAAZ,CAAiB,UAASgK,MAAT,EAAiB;AAAA,oBACjC1K,IAAA,CAAK6K,aAAL,CAAmBH,MAAnB,EADiC;AAAA,iBAAlC,EAJgD;AAAA,gBAQhD,OAAO,IAAP,CARgD;AAAA,aAAjD,C;YAWApO,IAAA,CAAKsJ,oBAAL,GAA4B,YAAW;AAAA,gBACtC,IAAI5F,IAAA,GAAO,IAAX,CADsC;AAAA,gBAItC,KAAKyK,aAAL,GAAqB,EAArB,CAJsC;AAAA,gBAKtC5P,CAAA,CAAEyK,iBAAF,EAAqB5E,IAArB,CAA0B,UAASoK,UAAT,EAAqB;AAAA,oBAC9C9K,IAAA,CAAKyK,aAAL,CAAmBK,UAAnB,IAAiC,EAAjC,CAD8C;AAAA,iBAA/C,EALsC;AAAA,gBAUtCjQ,CAAA,CAAE0K,gBAAF,EAAoB7E,IAApB,CAAyB,UAASqK,SAAT,EAAoBlJ,KAApB,EAA2B;AAAA,oBACnD,IAAIiJ,UAAA,GAAaxF,iBAAA,CAAkBzD,KAAlB,CAAjB,CADmD;AAAA,oBAEnD,IAAImJ,gBAAA,GAAmBhL,IAAA,CAAKyK,aAAL,CAAmBK,UAAnB,CAAvB,CAFmD;AAAA,oBAInDjQ,CAAA,CAAEmF,IAAA,CAAK+K,SAAL,CAAF,EAAmBrK,IAAnB,CAAwB,UAASvF,MAAT,EAAiBwK,GAAjB,EAAsB;AAAA,wBAC7C,IAAI,CAAC9K,CAAA,CAAE2E,UAAF,CAAarE,MAAb,CAAL;AAAA,4BAA2BA,MAAA,GAAS6E,IAAA,CAAK7E,MAAL,CAAT,CADkB;AAAA,wBAE7C,IAAI,CAACA,MAAL;AAAA,4BAAa,OAFgC;AAAA,wBAG7C,IAAIwI,KAAA,GAAQgC,GAAA,CAAIhC,KAAJ,CAAUqB,qBAAV,CAAZ,CAH6C;AAAA,wBAI7C,IAAIgF,SAAA,GAAYrG,KAAA,CAAM,CAAN,CAAhB,CAJ6C;AAAA,wBAK7C,IAAIsH,WAAA,GAActH,KAAA,CAAM,CAAN,EAASC,OAAT,CAAiB,QAAjB,EAA2B,GAA3B,EAAgCe,KAAhC,CAAsC,GAAtC,CAAlB,CAL6C;AAAA,wBAM7CxJ,MAAA,GAASN,CAAA,CAAEqQ,IAAF,CAAO/P,MAAP,EAAe6E,IAAf,CAAT,CAN6C;AAAA,wBAS7CnF,CAAA,CAAEoQ,WAAF,EAAevK,IAAf,CAAoB,UAASyK,UAAT,EAAqB;AAAA,4BACxCH,gBAAA,CAAiBG,UAAjB,IAA+BH,gBAAA,CAAiBG,UAAjB,KAAgC,EAA/D,CADwC;AAAA,4BAExCH,gBAAA,CAAiBG,UAAjB,EAA6B5K,IAA7B,CAAkC;AAAA,gCACjCyJ,SAAA,EAAWA,SADsB;AAAA,gCAEjCY,OAAA,EAASzP,MAFwB;AAAA,6BAAlC,EAFwC;AAAA,yBAAzC,EAT6C;AAAA,qBAA9C,EAJmD;AAAA,iBAApD,EAVsC;AAAA,aAAvC,C;YAsCAmB,IAAA,CAAKyJ,aAAL,GAAqB,YAAW;AAAA,gBAC/B,IAAI/F,IAAA,GAAO,IAAX,CAD+B;AAAA,gBAG/BnF,CAAA,CAAE,KAAKmL,KAAP,EAActF,IAAd,CAAmB,UAASsF,KAAT,EAAgB/G,SAAhB,EAA2B;AAAA,oBAC7C,IAAI,CAACpE,CAAA,CAAE6E,OAAF,CAAUsG,KAAV,CAAL;AAAA,wBAAuBA,KAAA,GAAQ,CAACA,KAAD,CAAR,CADsB;AAAA,oBAG7ChG,IAAA,CAAKgG,KAAL,CAAW/G,SAAX,IAAwB+G,KAAA,GAAQnL,CAAA,CAAEmL,KAAF,EAAS1F,GAAT,CAAa,UAASzD,IAAT,EAAe;AAAA,wBAC3D,IAAIhC,CAAA,CAAE2E,UAAF,CAAa3C,IAAb,CAAJ;AAAA,4BAAwBA,IAAA,GAAO,IAAIA,IAAJ,EAAP,CADmC;AAAA,wBAE3D,OAAOA,IAAP,CAF2D;AAAA,qBAA5B,CAAhC,CAH6C;AAAA,iBAA9C,EAH+B;AAAA,aAAhC,C;YAaAP,IAAA,CAAKuJ,cAAL,GAAsB,YAAW;AAAA,gBAChC,IAAI7F,IAAA,GAAO,IAAX,CADgC;AAAA,gBAGhCnF,CAAA,CAAE,KAAKyL,MAAP,EAAe5F,IAAf,CAAoB,UAASyB,KAAT,EAAgBvF,IAAhB,EAAsB;AAAA,oBACzC,IAAI/B,CAAA,CAAE2E,UAAF,CAAa2C,KAAb,CAAJ;AAAA,wBAAyBnC,IAAA,CAAKsG,MAAL,CAAY1J,IAAZ,IAAoB,IAAIuF,KAAJ,EAApB,CADgB;AAAA,iBAA1C,EAHgC;AAAA,gBAOhC,IAAI,KAAKA,KAAT,EAAgB;AAAA,oBACf,IAAItH,CAAA,CAAE2E,UAAF,CAAa,KAAK2C,KAAlB,CAAJ;AAAA,wBAA8B,KAAKA,KAAL,GAAa,IAAI,KAAKA,KAAT,EAAb,CADf;AAAA,oBAEf,KAAKmE,MAAL,CAAY,EAAZ,IAAkB,KAAKnE,KAAvB,CAFe;AAAA,iBAPgB;AAAA,aAAjC,C;YAaA7F,IAAA,CAAKwJ,mBAAL,GAA2B,YAAW;AAAA,gBACrC,IAAI9F,IAAA,GAAO,IAAX,CADqC;AAAA,gBAGrCnF,CAAA,CAAE,KAAKwL,WAAP,EAAoB3F,IAApB,CAAyB,UAAStF,UAAT,EAAqBwB,IAArB,EAA2B;AAAA,oBACnD,IAAI/B,CAAA,CAAE2E,UAAF,CAAapE,UAAb,CAAJ;AAAA,wBAA8B4E,IAAA,CAAKqG,WAAL,CAAiBzJ,IAAjB,IAAyB,IAAIxB,UAAJ,EAAzB,CADqB;AAAA,iBAApD,EAHqC;AAAA,gBAOrC,IAAI,KAAKA,UAAT,EAAqB;AAAA,oBACpB,IAAIP,CAAA,CAAE2E,UAAF,CAAa,KAAKpE,UAAlB,CAAJ;AAAA,wBAAmC,KAAKA,UAAL,GAAkB,IAAI,KAAKA,UAAT,EAAlB,CADf;AAAA,oBAEpB,KAAKiL,WAAL,CAAiB,EAAjB,IAAuB,KAAKjL,UAA5B,CAFoB;AAAA,iBAPgB;AAAA,aAAtC,C;YAmBAkB,IAAA,CAAKmF,WAAL,GAAmB,UAASpG,OAAT,EAAkB;AAAA,gBACpCA,OAAA,GAAUA,OAAA,IAAW,EAArB,CADoC;AAAA,gBAIpCR,CAAA,CAAE,KAAKmL,KAAP,EAActF,IAAd,CAAmB,UAASuF,UAAT,EAAqBhH,SAArB,EAAgC;AAAA,oBAClD,IAAIgG,kBAAA,CAAmBhG,SAAnB,EAA8B5D,OAA9B,CAAJ;AAAA,wBAA4C,OADM;AAAA,oBAIlD,IAAI,CAAC4K,UAAA,CAAWtG,MAAhB;AAAA,wBAAwB,OAJ0B;AAAA,oBAOlD9E,CAAA,CAAEoL,UAAF,EAAcvF,IAAd,CAAmB,UAAS7D,IAAT,EAAe;AAAA,wBAEjCA,IAAA,CAAK4E,WAAL,CAAiB5G,CAAA,CAAEsL,IAAF,CAAO9K,OAAP,EAAgB,SAAhB,EAA2B,SAA3B,CAAjB,EAFiC;AAAA,wBAKjCwB,IAAA,CAAKsK,MAAL,GALiC;AAAA,qBAAlC,EAPkD;AAAA,iBAAnD,EAJoC;AAAA,gBAqBpC,OAAO,IAAP,CArBoC;AAAA,aAArC,C;YAgCA7K,IAAA,CAAK8O,WAAL,GAAmB,YAAW;AAAA,gBAC7B,OAAO,IAAP,CAD6B;AAAA,aAA9B,C;YAUA9O,IAAA,CAAK6K,MAAL,GAAc,YAAW;AAAA,gBAExB,IAAI,KAAKpK,QAAT;AAAA,oBAAmB,OAAO,IAAP,CAFK;AAAA,gBAKxB,IAAIsO,YAAA,GAAe,KAAKtE,GAAL,CAASrB,IAAT,CAAc,cAAd,CAAnB,CALwB;AAAA,gBAMxB,IAAI2F,YAAJ;AAAA,oBAAkBA,YAAA,CAAavJ,MAAb,GANM;AAAA,gBASxB,KAAKiF,GAAL,CAASrB,IAAT,CAAc,cAAd,EAA8B,IAA9B,EAAoC4F,IAApC,CAAyC,cAAzC,EAAyD,KAAKnB,GAA9D,EATwB;AAAA,gBAYxB,KAAKoB,cAAL,GAZwB;AAAA,gBAcxB,KAAK7B,gBAAL,GAdwB;AAAA,gBAgBxB,KAAK3M,QAAL,GAAgB,IAAhB,CAhBwB;AAAA,gBAmBxB,KAAKqO,WAAL,GAnBwB;AAAA,gBAsBxB,KAAKlP,OAAL,CAAa,gBAAb,EAtBwB;AAAA,gBAwBxB,OAAO,IAAP,CAxBwB;AAAA,aAAzB,C;YAiCAI,IAAA,CAAKkP,WAAL,GAAmB,YAAW;AAAA,gBAE7B3Q,CAAA,CAAE,KAAKmL,KAAP,EAActF,IAAd,CAAmB,UAASuF,UAAT,EAAqB;AAAA,oBAEvC,IAAI,CAACA,UAAA,CAAWtG,MAAhB;AAAA,wBAAwB,OAFe;AAAA,oBAKvC9E,CAAA,CAAEoL,UAAF,EAAcvF,IAAd,CAAmB,UAAS7D,IAAT,EAAe;AAAA,wBAEjCA,IAAA,CAAK2O,WAAL,GAFiC;AAAA,wBAKjC3O,IAAA,CAAKiF,MAAL,GALiC;AAAA,qBAAlC,EALuC;AAAA,iBAAxC,EAF6B;AAAA,gBAiB7B,OAAO,IAAP,CAjB6B;AAAA,aAA9B,C;YA4BAxF,IAAA,CAAKmP,YAAL,GAAoB,YAAW;AAAA,gBAC9B,OAAO,IAAP,CAD8B;AAAA,aAA/B,C;YAUAnP,IAAA,CAAKwF,MAAL,GAAc,YAAW;AAAA,gBAExB,IAAI,CAAC,KAAK/E,QAAV;AAAA,oBAAoB,OAAO,IAAP,CAFI;AAAA,gBAKxB,KAAKb,OAAL,CAAa,gBAAb,EALwB;AAAA,gBAQxB,KAAKuP,YAAL,GARwB;AAAA,gBAWxB,KAAK1E,GAAL,CAAS2E,UAAT,CAAoB,cAApB,EAAoCC,UAApC,CAA+C,cAA/C,EAXwB;AAAA,gBAcxB,KAAKC,gBAAL,GAdwB;AAAA,gBAgBxB,KAAKhC,kBAAL,GAhBwB;AAAA,gBAkBxB,KAAK7M,QAAL,GAAgB,KAAhB,CAlBwB;AAAA,gBAqBxB,OAAO,IAAP,CArBwB;AAAA,aAAzB,C;YA4BAT,IAAA,CAAK+C,MAAL,GAAc,YAAW;AAAA,gBAExB,IAAI,KAAKjB,MAAT,EAAiB;AAAA,oBAChB,KAAKA,MAAL,CAAY8J,UAAZ,CAAuB,IAAvB,EAA6B,KAAKjJ,SAAlC,EADgB;AAAA,iBAFO;AAAA,gBAOxB,KAAKuM,WAAL,GAPwB;AAAA,gBAUxB,KAAK1J,MAAL,GAVwB;AAAA,gBAaxB,OAAO/G,QAAA,CAASuB,IAAT,CAAcd,SAAd,CAAwB6D,MAAxB,CAA+B5D,IAA/B,CAAoC,IAApC,CAAP,CAbwB;AAAA,aAAzB,C;YAuBAa,IAAA,CAAKuP,cAAL,GAAsB,UAASpC,QAAT,EAAmB;AAAA,gBACxC,IAAIqC,SAAA,GAAYjH,CAAA,CAAE4E,QAAF,CAAhB,CADwC;AAAA,gBAGxC,IAAI,CAACqC,SAAA,CAAUC,EAAV,CAAa,gBAAb,CAAL,EAAqC;AAAA,oBACpCD,SAAA,GAAYA,SAAA,CAAUE,OAAV,CAAkB,gBAAlB,CAAZ,CADoC;AAAA,iBAHG;AAAA,gBAOxC,OAAOF,SAAA,CAAUnM,MAAV,GAAmBmM,SAAA,CAAUpG,IAAV,CAAe,cAAf,CAAnB,GAAoD,IAA3D,CAPwC;AAAA,aAAzC,C;YAUAtJ,MAAA,CAAOC,OAAP,GAAiBtB,QAAA,CAASuB,IAAT,CAAcX,MAAd,CAAqBW,IAArB,CAAjB,C;;;YCz+BA,a;YAEA,IAAIvB,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YACA,IAAID,CAAA,GAAIC,QAAA,CAAQ,EAAR,CAAR,C;YACA,IAAIwH,MAAA,GAASxH,QAAA,CAAQ,CAAR,CAAb,C;YACA,IAAIG,UAAA,GAAaH,QAAA,CAAQ,CAAR,CAAjB,C;YACA,IAAIoH,KAAA,GAAQpH,QAAA,CAAQ,CAAR,CAAZ,C;YACA,IAAIwB,IAAA,GAAOxB,QAAA,CAAQ,CAAR,CAAX,C;YACA,IAAImC,iBAAA,GAAoBnC,QAAA,CAAQ,CAAR,CAAxB,C;YACA,IAAIkH,iBAAA,GAAoBlH,QAAA,CAAQ,CAAR,CAAxB,C;YACA,IAAIa,MAAA,GAASb,QAAA,CAAQ,CAAR,CAAb,C;YAEA,IAAImR,OAAA,GAAU5P,OAAd,C;YAIAxB,CAAA,CAAEc,MAAF,CAASsQ,OAAT,EAAkBlR,QAAA,CAAS8C,MAA3B,E;YAGA,IAAIqO,cAAA,GAAiB;AAAA,oBAAC,QAAD;AAAA,oBAAW,SAAX;AAAA,oBAAsB,SAAtB;AAAA,iBAArB,C;YACArR,CAAA,CAAEc,MAAF,CAASsQ,OAAT,EAAkBpR,CAAA,CAAEqC,IAAF,CAAOnC,QAAP,EAAiBmR,cAAjB,CAAlB,E;YAGArR,CAAA,CAAEc,MAAF,CAASsQ,OAAT,EAAkB;AAAA,gBACjB3J,MAAA,EAAQA,MADS;AAAA,gBAEjBrH,UAAA,EAAYA,UAFK;AAAA,gBAGjBiH,KAAA,EAAOA,KAHU;AAAA,gBAIjB5F,IAAA,EAAMA,IAJW;AAAA,gBAKjBW,iBAAA,EAAmBA,iBALF;AAAA,aAAlB,E;YASAgP,OAAA,CAAQjK,iBAAR,GAA4BA,iBAA5B,C;YAGAiK,OAAA,CAAQtQ,MAAR,GAAiBA,MAAjB,C;;;YCnCA,a;YAEA,IAAIsB,iBAAA,GAAoBnC,QAAA,CAAQ,CAAR,CAAxB,C;YAGAsB,MAAA,CAAOC,OAAP,GAAiB,IAAIY,iBAAJ,EAAjB,C;;;YCLA,a;YAEA,IAAIpC,CAAA,GAAIC,QAAA,CAAQ,EAAR,CAAR,C;YAGA,IAAIqR,iBAAA,GAAoB,KAAxB,C;YAGA,IAAIC,QAAA,GAAW,YAAW;AAAA,gBACzB,MAAM,IAAIrN,KAAJ,CAAU,gDAAV,CAAN,CADyB;AAAA,aAA1B,C;YAKA1C,OAAA,CAAQF,SAAR,GAAoB,UAASgG,KAAT,EAAgB9G,OAAhB,EAAyB;AAAA,gBAC5C,IAAIgR,KAAA,GAAQhR,OAAA,CAAQgR,KAApB,CAD4C;AAAA,gBAE5ChR,OAAA,CAAQgR,KAAR,GAAgB,UAASvQ,IAAT,EAAe;AAAA,oBAC9B,IAAIuQ,KAAJ;AAAA,wBAAWA,KAAA,CAAM5Q,IAAN,CAAWJ,OAAA,CAAQY,OAAnB,EAA4BkG,KAA5B,EAAmCrG,IAAnC,EAAyCT,OAAzC,EADmB;AAAA,oBAE9B8G,KAAA,CAAMjG,OAAN,CAAc,OAAd,EAAuBiG,KAAvB,EAA8BrG,IAA9B,EAAoCT,OAApC,EAF8B;AAAA,iBAA/B,CAF4C;AAAA,aAA7C,C;YAQAgB,OAAA,CAAQf,cAAR,GAAyB,UAASH,MAAT,EAAiBgH,KAAjB,EAAwB9G,OAAxB,EAAiC;AAAA,gBACzDA,OAAA,GAAUR,CAAA,CAAEc,MAAF,CAAS;AAAA,oBAClB2O,IAAA,EAAM6B,iBADY;AAAA,oBAElBG,QAAA,EAAU,MAFQ;AAAA,oBAGlBC,WAAA,EAAa,kBAHK;AAAA,oBAIlBC,WAAA,EAAa,KAJK;AAAA,iBAAT,EAKPnR,OALO,CAAV,CADyD;AAAA,gBASzD,IAAI,CAACA,OAAA,CAAQoR,GAAb,EAAkB;AAAA,oBACjB,IAAIA,GAAA,GAAM5R,CAAA,CAAEkH,MAAF,CAASI,KAAT,EAAgB,KAAhB,KAA0BiK,QAAA,EAApC,CADiB;AAAA,oBAEjB/Q,OAAA,CAAQoR,GAAR,GAAcA,GAAA,CAAI7I,OAAJ,CAAY,QAAZ,EAAsB,KAAtB,IAA+BzI,MAA7C,CAFiB;AAAA,iBATuC;AAAA,gBAezD,IAAIE,OAAA,CAAQqK,IAAR,IAAgB7K,CAAA,CAAEmI,QAAF,CAAW3H,OAAA,CAAQqK,IAAnB,CAAhB,IAA4C,CAACrK,OAAA,CAAQmR,WAAzD,EAAsE;AAAA,oBACrEnR,OAAA,CAAQqK,IAAR,GAAegH,IAAA,CAAKC,SAAL,CAAetR,OAAA,CAAQqK,IAAvB,CAAf,CADqE;AAAA,iBAfb;AAAA,gBAmBzD,OAAOrK,OAAP,CAnByD;AAAA,aAA1D,C;YAuBA,IAAIuR,cAAA,GAAiB;AAAA,oBACpB,QAAQ,QADY;AAAA,oBAEpB,OAAO,QAFa;AAAA,oBAGpB,SAAS,OAHW;AAAA,oBAIpB,UAAU,QAJU;AAAA,oBAKpB,OAAO,MALa;AAAA,iBAArB,C;YAQAvQ,OAAA,CAAQd,iBAAR,GAA4B,UAASF,OAAT,EAAkB;AAAA,gBAC7C,OAAOuR,cAAA,CAAevR,OAAA,CAAQiP,IAAR,CAAauC,WAAb,EAAf,CAAP,CAD6C;AAAA,aAA9C,C;;;YCpDA,a;YAEA,IAAI9R,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YAIAsB,MAAA,CAAOC,OAAP,GAAiBtB,QAAA,CAASuB,IAAT,CAAcX,MAA/B,C","file":"esencia.js","sourceRoot":".","sourcesContent":["'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar execUtils = require('../utils/exec');\n\n/**\n * @class Esencia.Collection\n * @extend Backbone.Collection\n */\n\nvar Collection = {};\n\n/**\n * Override `sync` to add exec custom method functionality\n *\n * @override\n */\n\nCollection.sync = function(method, collection, options) {\n\toptions = execUtils.prepareOptions(method, collection, options);\n\tmethod = execUtils.getFakeBaseMethod(options);\n\treturn backbone.Collection.prototype.sync.call(\n\t\tthis, method, collection, options\n\t);\n};\n\n/**\n * Exec custom non-REST method on collection\n * It trigger `exec:[method]` event after success method exec\n *\n * @param {String} method\n * @param {Object} options\n */\n\nCollection.exec = function(method, options) {\n\toptions = _.extend({parse: true}, options);\n\tvar collection = this;\n\tvar success = options.success;\n\toptions.success = function(resp) {\n\t\tif (options.fetch) collection[options.reset ? 'reset' : 'set'](resp, options);\n\t\tif (success) success.call(options.context, collection, resp, options);\n\t\tcollection.trigger('exec:' + method, collection, resp, options);\n\t};\n\texecUtils.wrapError(this, options);\n\treturn this.sync(method, this, options);\n};\n\nmodule.exports = backbone.Collection.extend(Collection);\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar View = require('./view');\nvar extend = require('../utils/extend');\n\nfunction isTreeNodeChanged(oldNode, node) {\n\treturn Boolean(\n\t\t!oldNode ||\n\t\toldNode.component.name !== node.component.name ||\n\t\t!oldNode.view ||\n\t\toldNode.view instanceof node.component.View === false ||\n\t\toldNode.view.isWaiting() ||\n\t\t!oldNode.view.attached ||\n\t\t!oldNode.view.isUnchanged()\n\t);\n}\n\n/**\n * @class Esencia.ComponentsManager\n */\n\nvar ComponentsManager = function(options) {\n\toptions = options || {};\n\n\t// populate ComponentsManager instance with fields from options\n\t_.extend(this, _.pick(options, componentManagerOptions));\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\t// all components hash\n\tthis.components = {};\n\n\t// current components tree that loaded at this moment\n\tthis.tree = [];\n\n\t// component names of the loaded tree at this moment\n\tthis.currentNames = [];\n\n\t// add default root component, in most cases this is what you need\n\tif (this.autoAddRoot) this._addRoot();\n\n\tthis.initialize.apply(this, arguments);\n};\n\nvar componentManagerOptions = [\n\t'rootEl', 'autoAddRoot'\n];\n\n var componentOptions = [\n\t'name', 'parent', 'container', 'View', 'model', 'models',\n\t'collection', 'collections', 'viewOptions'\n];\n\n_.extend(ComponentsManager.prototype, backbone.Events, {\n\t// You can set selector of any element at the page if you want restrict\n\t// specific page area that component manager will process\n\trootEl: 'html',\n\n\t// Add default root component, in most cases this is what you need\n\tautoAddRoot: true,\n\n\t// Default parent component name is undefined until any root component will\n\t// added\n\t// When root component is added, it name will set as value of this field\n\tdefaultParent: undefined,\n\n\t/**\n\t * Initialize is an empty function by default. Override it with your own\n\t * initialization logic.\n\t */\n\n\tinitialize: function() {},\n\n\t/**\n\t * Add default root component to the components list\n\t */\n\n\t_addRoot: function() {\n\t\tvar RootView = View.extend({\n\t\t\tel: this.rootEl\n\t\t});\n\n\t\tthis.add({\n\t\t\tparent: null,\n\t\t\tView: RootView\n\t\t});\n\t},\n\n\t/**\n\t * Add component to the components list\n\t *\n\t * @param {Object} options\n\t * @param {String} options.name - component name\n\t * @param {View} options.View - component view constructor\n\t * @param {String|Null} [options.parent] - component parent name or null\n\t * for roots\n\t * @param {String} [options.container] - view container, required if parent\n\t * is string\n\t * @param {Boolean} [options.load] - load component after add\n\t */\n\n\tadd: function(options) {\n\t\toptions = _.defaults({}, options, {\n\t\t\tparent: this.defaultParent,\n\t\t\tload: false\n\t\t});\n\n\t\tvar component = _.pick(options, componentOptions);\n\n\t\tvar hasName = _.has(component, 'name');\n\t\tvar hasContainer = _.has(component, 'container');\n\t\tvar hasParent = _.isString(component.parent);\n\t\tvar isRoot = _.isNull(component.parent);\n\t\tvar hasDefaultParent = _.isString(this.defaultParent);\n\n\t\tif (hasName && !_.isString(component.name)) {\n\t\t\tthrow new Error('Component `name` option should be a string');\n\t\t}\n\n\t\tif (hasName && _.has(this.components, component.name)) {\n\t\t\tthrow new Error('Duplicate component with name \"' + component.name + '\"');\n\t\t}\n\n\t\tif (!_.has(component, 'View')) {\n\t\t\tthrow new Error('Component `View` option is required');\n\t\t}\n\n\t\tif (!hasDefaultParent && _.isUndefined(component.parent)) {\n\t\t\tthrow new Error(\n\t\t\t\t'Default root component is not set, add root component first'\n\t\t\t);\n\t\t}\n\n\t\tif (!hasParent && !isRoot) {\n\t\t\tthrow new Error('Component `parent` option should be a string or null');\n\t\t}\n\n\t\tif (isRoot && hasContainer) {\n\t\t\tthrow new Error('Root component could not have a container');\n\t\t}\n\n\t\tif (hasParent && !hasContainer) {\n\t\t\tthrow new Error(\n\t\t\t\t'Component `container` option is required for components with parent'\n\t\t\t);\n\t\t}\n\n\t\tif (hasContainer && !_.isString(component.container)) {\n\t\t\tthrow new Error('Component `container` option should be a string selector');\n\t\t}\n\n\t\t// generate uniq component name if compoent has not a name\n\t\tif (!hasName) {\n\t\t\tcomponent.name = _.uniqueId('__COMPONENT_') + '__';\n\t\t}\n\n\t\tthis.components[component.name] = component;\n\n\t\tif (isRoot && (!hasDefaultParent || options.default)) {\n\t\t\tthis.defaultParent = component.name;\n\t\t}\n\n\t\t// process components tree in force mode\n\t\tif (options.load) {\n\t\t\tthis.load(component.name);\n\t\t}\n\n\t\treturn component;\n\t},\n\n\t/**\n\t * Get component by name\n\t *\n\t * @param {String} name - component name\n\t * @return {Object} component\n\t */\n\n\tget: function(name) {\n\t\tvar component = this.components[name];\n\n\t\tif (!component) {\n\t\t\tthrow new Error('Component with name \"' + name + '\" does not exist');\n\t\t}\n\n\t\treturn component;\n\t},\n\n\t/**\n\t * Remove component by name\n\t *\n\t * @param {String} name - component name\n\t */\n\n\tremove: function(name) {\n\t\tdelete this.components[name];\n\t},\n\n\t/**\n\t * Load components tree by name(s) and call a callback on done\n\t *\n\t * @param {String|String[]} [names] - component name or names list\n\t * @param {Object} [options]\n\t * @params {Function} [callback]\n\t */\n\n\tload: function(names, options, callback) {\n\t\tif (_.isFunction(names)) {\n\t\t\tcallback = names;\n\t\t\tnames = undefined;\n\t\t\toptions = undefined;\n\t\t}\n\n\t\tif (_.isFunction(options)) {\n\t\t\tcallback = options;\n\t\t\toptions = undefined;\n\t\t}\n\n\t\tnames = names || this.currentNames;\n\t\toptions = options || {};\n\t\tcallback = callback || _.noop;\n\n\t\tif (!_.isArray(names)) names = [names];\n\t\tif (!names.length) {\n\t\t\tthrow new Error('Component name or names to load should be set');\n\t\t}\n\n\t\tvar tree = this._buildTree(names);\n\t\tvar oldTree = this.tree;\n\t\tthis.tree = [];\n\n\t\tthis.currentNames = names;\n\n\t\tthis._applyTree({\n\t\t\tparent: {children: this.tree},\n\t\t\toldTree: oldTree,\n\t\t\ttree: tree\n\t\t}, callback);\n\t},\n\n\t_buildTree: function(names) {\n\t\tvar self = this;\n\n\t\t// internal function for recursion\n\t\tvar buildHashedTree = function(names, tree) {\n\t\t\t// exit with empty tree if names list is empty\n\t\t\tif (!names.length) return tree;\n\n\t\t\tvar parentNames = [];\n\n\t\t\t// create component nodes\n\t\t\tvar nodes = _(names)\n\t\t\t\t.chain()\n\t\t\t\t.uniq()\n\t\t\t\t.map(function(name) {\n\t\t\t\t\tvar component = self.get(name);\n\n\t\t\t\t\t// skip component if it is already in the tree\n\t\t\t\t\tif (_.has(tree, component.name)) return null;\n\n\t\t\t\t\t// create node\n\t\t\t\t\tvar node = {\n\t\t\t\t\t\tcomponent: component,\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t};\n\n\t\t\t\t\t// add parent name to the list\n\t\t\t\t\tif (_.isString(component.parent)) {\n\t\t\t\t\t\tparentNames.push(component.parent);\n\t\t\t\t\t}\n\n\t\t\t\t\t// add nodes to the hashed tree first to prevent cycles\n\t\t\t\t\ttree[component.name] = node;\n\n\t\t\t\t\treturn node;\n\t\t\t\t})\n\t\t\t\t.compact()\n\t\t\t\t.value();\n\n\t\t\t// build new tree for parent components\n\t\t\ttree = buildHashedTree(parentNames, tree);\n\n\t\t\t// add each node to the parent children list if component has a parent\n\t\t\t_(nodes).each(function(node) {\n\t\t\t\tif (_.isString(node.component.parent)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tnode.component.container &&\n\t\t\t\t\t\t_(tree[node.component.parent].children).find(function(child) {\n\t\t\t\t\t\t\treturn child.component.container === node.component.container;\n\t\t\t\t\t\t})\n\t\t\t\t\t) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t'Components could not have same container and parent in one tree'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\ttree[node.component.parent].children.push(node);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn tree;\n\t\t};\n\n\t\tvar tree = buildHashedTree(names, {});\n\n\t\tif (_.isEmpty(tree)) {\n\t\t\tthrow new Error('Components tree is empty');\n\t\t}\n\n\t\t// filter root components\n\t\ttree = _(tree).filter(function(node) {\n\t\t\treturn _.isNull(node.component.parent);\n\t\t});\n\n\t\tif (!tree.length) {\n\t\t\tthrow new Error('Components tree should have at least one root node');\n\t\t}\n\n\t\tif (\n\t\t\t_(tree).some(function(node) {\n\t\t\t\treturn node.component.container;\n\t\t\t})\n\t\t) {\n\t\t\tthrow new Error('Root component could not have a container');\n\t\t}\n\n\t\treturn tree;\n\t},\n\n\t_applyTree: function(params, callback) {\n\t\tvar self = this;\n\n\t\tvar parent = params.parent;\n\n\t\tvar afterCallback = _.after(params.tree.length, callback);\n\n\t\tvar iterate = function(oldNode, node) {\n\t\t\tvar container = node.component.container;\n\n\t\t\tvar children = node.children;\n\t\t\tvar oldChildren = oldNode ? oldNode.children : [];\n\n\t\t\t// set view data\n\t\t\tnode.view.setData();\n\n\t\t\tif (!node.view.attached && container) {\n\t\t\t\t// render view with container from parent view\n\t\t\t\tparent.view\n\t\t\t\t\t.setView(node.view, container)\n\t\t\t\t\t.renderViews({include: [container]})\n\t\t\t\t\t.attachViews({include: [container]});\n\t\t\t} else {\n\t\t\t\t// exclude list is an union of old and new children\n\t\t\t\tvar exclude = _.union(\n\t\t\t\t\t_(children).chain().map(function(child) {\n\t\t\t\t\t\treturn child.component.container;\n\t\t\t\t\t}).compact().value(),\n\t\t\t\t\t_(oldChildren).chain().map(function(child) {\n\t\t\t\t\t\treturn child.component.container;\n\t\t\t\t\t}).compact().value()\n\t\t\t\t);\n\n\t\t\t\t// render view without container directly\n\t\t\t\tnode.view.render({exclude: exclude});\n\t\t\t}\n\n\t\t\t// clear children field in new node because it will set recursive\n\t\t\t// and should be empty in error case\n\t\t\tnode.children = [];\n\n\t\t\t// save node to the parent children\n\t\t\tparent.children.push(node);\n\n\t\t\t// recursive call for children nodes\n\t\t\tself._applyTree({\n\t\t\t\tparent: node,\n\t\t\t\toldTree: oldChildren,\n\t\t\t\ttree: children\n\t\t\t}, afterCallback);\n\t\t};\n\n\t\t_(params.tree).each(function(node, index) {\n\t\t\t// TODO get oldNode in better way\n\t\t\tvar oldNode = params.oldTree[index] || null;\n\n\t\t\tif (isTreeNodeChanged(oldNode, node)) {\n\t\t\t\tif (oldNode && oldNode.view) {\n\t\t\t\t\tif (oldNode.component.container) {\n\t\t\t\t\t\t// remove old view if container for new view dirrent\n\t\t\t\t\t\tif (oldNode.component.container !== node.component.container) {\n\t\t\t\t\t\t\toldNode.view.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// detach old view if it has not a container\n\t\t\t\t\t\toldNode.view.detach();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// create new view\n\t\t\t\tnode.view = new (node.component.View)(\n\t\t\t\t\t_(node.component)\n\t\t\t\t\t\t.chain()\n\t\t\t\t\t\t.pick('model', 'models', 'collection', 'collections')\n\t\t\t\t\t\t.extend(_.result(node.component, 'viewOptions'), {\n\t\t\t\t\t\t\tcomponentsManager: this\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.value()\n\t\t\t\t);\n\n\t\t\t\t// stop processing old components tree by passing null as oldNode\n\t\t\t\tif (node.view.isWaiting()) {\n\t\t\t\t\t// wait when view will be resolved\n\t\t\t\t\tself.listenToOnce(node.view, 'esencia:resolve', function() {\n\t\t\t\t\t\titerate(null, node);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\titerate(null, node);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// save old view to new node\n\t\t\t\tnode.view = oldNode.view;\n\n\t\t\t\t// process old components tree\n\t\t\t\titerate(oldNode, node);\n\t\t\t}\n\t\t});\n\t}\n});\n\nComponentsManager.extend = extend;\n\nmodule.exports = ComponentsManager;\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar execUtils = require('../utils/exec');\n\n/**\n * @class Esencia.Model\n * @extend Backbone.Model\n */\n\nvar Model = {};\n\n/**\n * Override `sync` to add exec custom method functionality\n *\n * @override\n */\n\nModel.sync = function(method, model, options) {\n\toptions = execUtils.prepareOptions(method, model, options);\n\tmethod = execUtils.getFakeBaseMethod(options);\n\treturn backbone.Model.prototype.sync.call(this, method, model, options);\n};\n\n/**\n * Exec custom non-REST method on model\n * It trigger `exec:[method]` event after success method exec\n *\n * @param {String} method\n * @param {Object} options\n */\n\nModel.exec = function(method, options) {\n\toptions = _.extend({parse: true}, options);\n\tvar model = this;\n\tvar success = options.success;\n\toptions.success = function(resp) {\n\t\tif (options.fetch) {\n\t\t\tvar serverAttrs = options.parse ? model.parse(resp, options) : resp;\n\t\t\tif (!model.set(serverAttrs, options)) return false;\n\t\t}\n\t\tif (success) success.call(options.context, model, resp, options);\n\t\tmodel.trigger('exec:' + method, model, resp, options);\n\t};\n\texecUtils.wrapError(this, options);\n\treturn this.sync(method, this, options);\n};\n\nmodule.exports = backbone.Model.extend(Model);\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar componentsManager = require('../utils/componentsManager');\n\n/**\n * @class Esencia.Router\n * @extend Backbone.Router\n */\n\nvar Router = {\n\tcomponentsManager: componentsManager,\n\tnamedParameters: true,\n\tautoloadModules: true,\n\tmodulesPath: 'modules/',\n\tdefaultModuleName: 'main',\n\tonModuleError: function() {}\n};\n\nvar routerOptions = [\n\t'componentsManager', 'namedParameters',\n\t'autoloadModules', 'modulesPath', 'defaultModuleName', 'onModuleError'\n];\n\n/**\n * @constructor\n * @param {Object} [options]\n */\n\nRouter.constructor = function(options) {\n\toptions = options || {};\n\n\t// populate Router instance with fields from options\n\t_.extend(this, _.pick(options, routerOptions));\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\tthis.modules = {};\n\n\tbackbone.Router.apply(this, arguments);\n};\n\n/**\n * Add new component to components manager\n *\n * @param {Object} options - component options\n */\n\nRouter.component = function(options) {\n\treturn this.componentsManager.add(options);\n};\n\n/**\n * Override `route` to add components processing functionality\n *\n * @override\n */\n\nRouter.route = function(route, options, callback) {\n\tvar self = this;\n\n\tif (_.isFunction(options)) {\n\t\tcallback = options;\n\t\toptions = {};\n\t}\n\n\tif (!_.isObject(options)) {\n\t\toptions = {name: options};\n\t}\n\n\tvar name = '';\n\n\tif (_.has(options, 'components') || _.has(options, 'component')) {\n\t\tvar components = _(options.components || [options.component])\n\t\t\t.map(function(componentOptions) {\n\t\t\t\tif (_.isString(componentOptions)) {\n\t\t\t\t\treturn self.componentsManager.get(componentOptions);\n\t\t\t\t} else {\n\t\t\t\t\treturn self.component(componentOptions);\n\t\t\t\t}\n\t\t\t});\n\n\t\tvar componentNames = _.pluck(components, 'name');\n\n\t\tname = componentNames.join(',');\n\n\t\t// create callback to load components tree\n\t\tcallback = function() {\n\t\t\tself.componentsManager.load(componentNames);\n\t\t};\n\t}\n\n\tname = options.name || name;\n\n\t// bind component to route\n\tbackbone.Router.prototype.route.call(this, route, name, callback);\n};\n\nvar namedParam = /(\\(\\?)?:\\w+/g,\n\tsplatParam = /\\*\\w+/g,\n\tnamesPattern = /[\\:\\*]([^\\:\\?\\/]+)/g;\n\nRouter._routeToRegExp = function(route) {\n\tvar splatMatch = (splatParam.exec(route) || {index: -1}),\n\t\tnamedMatch = (namedParam.exec(route) || {index: -1}),\n\t\tparamNames = route.match(namesPattern) || [];\n\n\troute = backbone.Router.prototype._routeToRegExp.call(this, route);\n\n\t// use the rtn value to hold some parameter data\n\tif (splatMatch.index >= 0) {\n\t\t// there is a splat\n\t\tif (namedMatch >= 0) {\n\t\t\t// negative value will indicate there is a splat match before any named matches\n\t\t\troute.splatMatch = splatMatch.index - namedMatch.index;\n\t\t} else {\n\t\t\troute.splatMatch = -1;\n\t\t}\n\t}\n\n\t// Map and remove any trailing ')' character that has been caught up in regex matching\n\troute.paramNames = _(paramNames).map(function(name) {\n\t\treturn name.replace(/\\)$/, '').substring(1);\n\t});\n\n\treturn route;\n};\n\nRouter._extractParameters = function(route, fragment) {\n\tvar params = backbone.Router.prototype._extractParameters.call(\n\t\tthis, route, fragment\n\t);\n\tvar namedParams = {};\n\n\t// decode params\n\tvar length = params.length;\n\tif (route.splatMatch) {\n\t\tif (route.splatMatch < 0) {\n\t\t\t// splat param is first\n\t\t\treturn params;\n\t\t} else {\n\t\t\tlength = length - 1;\n\t\t}\n\t}\n\n\tconsole.log('>>>>>>>>', length, route.paramNames)\n\n\tfor (var i = 0; i < length; i++) {\n\t\tif (_.isString(params[i])) {\n\t\t\tif (route.paramNames && route.paramNames.length >= i - 1) {\n\t\t\t\tnamedParams[route.paramNames[i]] = params[i];\n\t\t\t}\n\t\t}\n\t}\n\n\tconsole.log('>>>>>>>>', namedParams)\n\n\treturn this.namedParameters ? [namedParams] : params;\n\n\n\t// return backbone.Router.prototype._extractParameters\n\t// \t.call(this, route, fragment);\n};\n\n/**\n * Load module file and init it\n *\n * @param {Object} fragment\n */\n\nRouter.loadModule = function(fragment) {\n\tvar self = this;\n\n\tfragment = fragment || backbone.history.fragment;\n\n\tvar moduleName = this.getModuleName(fragment);\n\n\t// require module file\n\trequire([this.modulesPath + moduleName], function(moduleInit) {\n\t\t// if module is loaded first time\n\t\tif (!self.modules[moduleName]) {\n\t\t\t// init it\n\t\t\tmoduleInit(self);\n\n\t\t\t// set module init flag to true\n\t\t\tself.modules[moduleName] = true;\n\n\t\t\t// and navigate again with force flag\n\t\t\tbackbone.history.loadUrl(fragment);\n\t\t}\n\t}, this.onModuleError);\n};\n\nRouter.getModuleName = function(fragment) {\n\treturn _(fragment.split('/')).find(_.identity) || this.defaultModuleName;\n};\n\nmodule.exports = backbone.Router.extend(Router);\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\n\n// Take jquery or other selectors lib from backbone\nvar $ = backbone.$;\n\nvar splice = Array.prototype.splice;\n\n// Cached regex to split keys for `delegate`.\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\n\nfunction isContainerSkipped(container, options) {\n\tvar exclude = options.exclude;\n\tvar include = options.include;\n\treturn Boolean(\n\t\texclude && _.contains(_.isArray(exclude) ? exclude : [exclude], container) ||\n\t\tinclude && !_.contains(_.isArray(include) ? include : [include], container)\n\t);\n}\n\n/**\n * @class Esencia.View\n * @extend Backbone.View\n */\n\nvar View = {\n\t// Helpers (Object|Fuction) which will be passed to the template\n\ttemplateHelpers: {},\n\n\t// Views are in the resolved state by default\n\twaitsCounter: 0,\n\n\t// This flag is used to check that .wait() is called\n\t// in the constructor/initialize\n\twaitAvailable: true,\n\n\t// Views are not attached by default\n\tattached: false\n};\n\nvar nestedEntityTypes = ['views', 'models', 'collections'];\nvar nestedEventTypes = ['viewEvents', 'modelEvents', 'collectionEvents'];\nvar resultableOptions = _.union(\n\tnestedEntityTypes, nestedEventTypes, ['ui', 'triggers']\n);\nvar viewOptions = _.union(resultableOptions, [\n\t'model', 'collection', 'data', 'componentsManager',\n\t'template', 'templateHelpers'\n]);\n\n/**\n * @constructor\n * @param {Object} [options]\n */\n\nView.constructor = function(options) {\n\tvar self = this;\n\n\toptions = options || {};\n\n\t// data is empty object by default\n\tthis.data = {};\n\n\t// populate View instance with fields from options\n\t_.extend(this, _.pick(options, viewOptions));\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\t// initialize properties with _.result call and default empty-object value\n\t_(resultableOptions).each(function(key) {\n\t\tself[key] = _.result(self, key, {});\n\t});\n\n\t// create special hash object for all nested events for fast search\n\tthis._prepareNestedEvents();\n\n\t// create instances of nested models\n\tthis._prepareModels();\n\n\t// create instances of nested collections\n\tthis._prepareCollections();\n\n\t// prepare nested views: create instances and wrap to arrays\n\tthis._prepareViews();\n\n\t// delegate events for each views group before constructor\n\t_(this.views).each(function(viewsGroup, container) {\n\t\tself.delegateNestedEvents('views', container, viewsGroup);\n\t});\n\n\t// apply default backbone.View constructor\n\t// omit model and collection because we alredy processed this options\n\tbackbone.View.call(this, _.omit(options, 'model', 'collection'));\n\n\t// set waiting state for current view if some nested view is in waiting state\n\t_(this.views).each(function(views) {\n\t\t_(views).each(function(view) {\n\t\t\tif (view.isWaiting()) {\n\t\t\t\tself.listenToOnce(view, 'esencia:resolve', self.wait());\n\t\t\t}\n\t\t});\n\t});\n\n\t// disable .wait(), it available only in the constructor/initialize\n\tthis.waitAvailable = false;\n\n\t// we should delegate events after parent constructor call because\n\t// collections and models could be created in the initialize method\n\n\t// delegate events for each collection\n\t_(this.collections).each(function(collection, name) {\n\t\tself.delegateNestedEvents('collections', name, collection);\n\t});\n\n\t// delegate events for each model\n\t_(this.models).each(function(model, name) {\n\t\tself.delegateNestedEvents('models', name, model);\n\t});\n};\n\n/**\n * Update view data\n * Method is used to update view state, could be overriden to modify nested\n * views state\n *\n * @param {Object} [data] - new data object\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.setData = function(data) {\n\tif (data) this.data = data;\n\treturn this;\n};\n\n/**\n * Check that view is changed and should be re-rendered\n * Method returns true by default (always unchanged), could be overriden\n * for specific logic\n *\n * @return {Boolean}\n */\n\nView.isUnchanged = function() {\n\treturn true;\n};\n\n/**\n * Switch view to the waiting state\n *\n * @return {Function} - callback function, should be called to resolve view\n */\n\nView.wait = function() {\n\tif (!this.waitAvailable) {\n\t\tthrow new Error('Method .wait() is available only in the constructor');\n\t}\n\n\tvar self = this;\n\n\tthis.waitsCounter++;\n\n\tthis.trigger('esencia:wait');\n\n\t// TODO: think about promises\n\treturn _.once(function() {\n\t\t_.defer(function() {\n\t\t\tself.waitsCounter--;\n\t\t\tif (!self.isWaiting()) {\n\t\t\t\tself.trigger('esencia:resolve');\n\t\t\t}\n\t\t});\n\t});\n};\n\n/**\n * Check view waiting state\n *\n * @return {Boolean}\n */\n\nView.isWaiting = function() {\n\treturn this.waitsCounter > 0;\n};\n\n/**\n * Render view\n *\n * @param {Object} options\n * @param {Boolean} options.force\n * @return {Esencia.View} - view instance for chaining\n */\n\nView._render = function(options) {\n\t// stop rendering if view in `waiting` state, resolve it first\n\tif (this.isWaiting()) return this;\n\n\toptions = options || {};\n\n\tif (this.template) {\n\t\t// re-render template only if it exists and if it is necessary\n\t\tif (options.force || !this.attached || !this.isUnchanged()) {\n\t\t\t// detach view from DOM element\n\t\t\tthis.detach();\n\n\t\t\t// render template with data\n\t\t\tvar data = _(this)\n\t\t\t\t.chain()\n\t\t\t\t.result('templateHelpers')\n\t\t\t\t.extend(this.getTemplateData())\n\t\t\t\t.value();\n\t\t\tvar html = this.renderTemplate(this.template, data);\n\n\t\t\tif (!_.isString(html)) {\n\t\t\t\tthrow new Error('`renderTemplate` method should return a HTML string');\n\t\t\t}\n\n\t\t\t// render html with jqeury (or other lib) call\n\t\t\tvar $el = $(html);\n\n\t\t\tif (!$el.length) {\n\t\t\t\tthrow new Error('View template produces empty html');\n\t\t\t}\n\n\t\t\tif ($el.length > 1) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'View template produces html with more than one root elements'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.setElement($el);\n\t\t}\n\t} else {\n\t\t// re-ensure element if it is not ensured\n\t\tif (!this.$el.length) this._ensureElement();\n\t}\n\n\t// trigger event\n\tthis.trigger('esencia:render');\n\n\t// render nested views\n\tthis.renderViews(options);\n\n\tif (!this.parent || this.$container) {\n\t\t// attach all nested views first\n\t\tthis.attachViews(options);\n\n\t\t// attach current view\n\t\tthis.attach();\n\t}\n\n\t// return this for chaining\n\treturn this;\n};\n\n/**\n * Render view by calling private _render method\n *\n * @override\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.render = function(options) {\n\treturn this._render(options);\n};\n\n/**\n * Get data for template rendering\n * Returns data by default, could be overriden\n *\n * @return {Object}\n */\n\nView.getTemplateData = function() {\n\treturn this.data;\n};\n\n/**\n * Render template with data, return html\n * By default this method simply calls template function with data as argument\n * Override this function to change template rendering logic\n *\n * @param {Function} template - template function for rendering\n * @param {Object} data - data for rendering\n * @return {String} - rendered html\n */\n\nView.renderTemplate = function(template, data) {\n\tif (!_.isFunction(template)) {\n\t\tthrow new Error('View `template` should be a function');\n\t}\n\n\treturn template(data);\n};\n\n/**\n * Render all nested view\n *\n * @param {Object} options\n * @param {Boolean} options.force\n * @return {Esencia.View} - view instance for chaining\n*/\n\nView.renderViews = function(options) {\n\tvar self = this;\n\n\t// iterate by each views group\n\t_(this.views).each(function(viewsGroup, container) {\n\t\tif (isContainerSkipped(container, options)) return;\n\n\t\t// return if view group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call render for each views from view group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\tview.render(_.omit(options, 'include', 'exclude'));\n\t\t});\n\n\t\t// get first container or $el\n\t\tvar $container = container ? self.$(container).first() : self.$el;\n\n\t\tif (!$container.length) {\n\t\t\tthrow new Error('Container \"' + container + '\" is not found');\n\t\t}\n\n\t\tvar containerEl = $container.get(0);\n\n\t\t// dom is changed if some view from group is not in current container\n\t\tvar domChanged = _(viewsGroup).some(function(view) {\n\t\t\treturn (\n\t\t\t\t!view.attached ||\n\t\t\t\t!view.$container ||\n\t\t\t\tview.$container.get(0) !== containerEl\n\t\t\t);\n\t\t});\n\n\t\tif (domChanged) {\n\t\t\t// re-append views group to container\n\t\t\tvar $els = [];\n\n\t\t\t_(viewsGroup).each(function(view) {\n\t\t\t\tview.$container = $container;\n\t\t\t\t$els.push(view.$el);\n\t\t\t});\n\n\t\t\t// TODO: add some rendering optimizations here\n\n\t\t\t// put all views to $container\n\t\t\t$container.append($els);\n\t\t}\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/**\n * Set view to views group or replace some view in specified position\n * If index is passed it replace only one view with index in views group\n *\n * @param {Esencia.View} view - view to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.setView = function(view, container, index) {\n\treturn this._updateViews([view], container, index);\n};\n\n/**\n * Set views to views group or replace some view in specified position\n * If index is passed it replace only one view with index in views group\n *\n * @param {Esencia.View[]} views - views to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.setViews = function(views, container, index) {\n\treturn this._updateViews(views, container, index);\n};\n\n/**\n * Append view to end of views group\n * This method is alias for insertView without index argument\n *\n * @param {Esencia.View} view - view to append\n * @param {String} container - container of views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.appendView = function(view, container) {\n\treturn this._insertViews([view], container);\n};\n\n/**\n * Append views to end of views group\n * This method is alias for insertViews without index argument\n *\n * @param {Esencia.View[]} views - views to append\n * @param {String} container - container of views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.appendViews = function(views, container) {\n\treturn this._insertViews(views, container);\n};\n\n/**\n * Prepend view to start of views group\n * This method is alias for insertView with `0` as index argument value\n *\n * @param {Esencia.View} view - view to prepend\n * @param {String} container - container of views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.prependView = function(view, container) {\n\treturn this._insertViews([view], container, 0);\n};\n\n/**\n * Prepend views to start of views group\n * This method is alias for insertViews with `0` as index argument value\n *\n * @param {Esencia.View[]} views - view to prepend\n * @param {String} container - container of views group\n\t* @return {Esencia.View} - view instance for chaining\n */\n\nView.prependViews = function(views, container) {\n\treturn this._insertViews(views, container, 0);\n};\n\n/**\n * Insert view to specified position of views group in the container\n * If index is not passed method inserts view to the end of views group (append)\n *\n * @param {Esencia.View} view - view to insert\n * @param {String} container - container of views group\n * @param {Number} [index] - position in views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.insertView = function(view, container, index) {\n\treturn this._insertViews([view], container, index);\n};\n\n/**\n * Insert views to specified position of views group container\n * If index is not passed method inserts views to the end of views group\n *\n * @param {Esencia.View[]} views - views to insert\n * @param {String} container - container of views group\n * @param {Number} [index] - position in views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.insertViews = function(views, container, index) {\n\treturn this._insertViews(views, container, index);\n};\n\n/**\n * Remove view from views group container by index or view instance\n * If index is passed it remove view in the index position\n *\n * @param {Esencia.View} [view] - view to remove\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.removeView = function(view, container, index) {\n\tif (arguments.length < 2) {\n\t\tthrow new Error('\"view\" or \"index\" arguments must be specified');\n\t}\n\n\tif (_.isString(view)) {\n\t\tindex = container;\n\t\tcontainer = view;\n\t\tview = this.getView(container, index);\n\t\tif (!view) return this;\n\t}\n\n\treturn this._removeViews([view], container);\n};\n\n/**\n * Remove views from views group container\n * If views are passed remove only these views\n * Othervise remove all views from container\n *\n * @param {Esencia.View[]} [views] - views to remove\n * @param {String} container - container of views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.removeViews = function(views, container) {\n\tif (_.isString(views)) {\n\t\tcontainer = views;\n\t\tviews = this.getViews(container);\n\t}\n\n\treturn this._removeViews(views, container);\n};\n\n/**\n * Get single view from container by index\n *\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in views group\n * @return {Esencia.View}\n */\n\nView.getView = function(container, index) {\n\treturn this.getViews(container)[index || 0] || null;\n};\n\n/**\n * Get views group from container\n *\n * @param {String} container - container of views group\n * @return {Esencia.View[]}\n */\n\nView.getViews = function(container) {\n\treturn _.clone(this.views[container]) || [];\n};\n\nView._insertViews = function(views, container, index) {\n\tvar self = this;\n\n\tvar viewsGroup = this.getViews(container);\n\n\t_(views).each(function(view) {\n\t\tif (view.parent) {\n\t\t\tview.parent.removeView(view, view.container);\n\t\t}\n\t});\n\n\tif (viewsGroup.length) {\n\t\t// if index is not specified set it value as last index of views group\n\t\tif (typeof index === 'undefined') {\n\t\t\tindex = viewsGroup.length;\n\t\t}\n\n\t\t// insert views\n\t\tsplice.apply(this.views[container], [index, 0].concat(views));\n\t} else {\n\t\t// if group is empty - set views as whole views group value\n\t\tthis.views[container] = views;\n\t}\n\n\t// set each view parent to current\n\t_(views).each(function(view) {\n\t\tview.parent = self;\n\t\tview.container = container;\n\t});\n\n\tthis.delegateNestedEvents('views', container, views);\n\n\treturn this;\n};\n\nView._updateViews = function(views, container, index) {\n\tvar oldViews;\n\n\tif (typeof index === 'undefined') {\n\t\t// if no index - get all views from group as old\n\t\toldViews = this.getViews(container);\n\t} else {\n\t\t// if index is specified get view from specific position as old\n\t\toldViews = this.getView(container, index);\n\t\toldViews = oldViews ? [oldViews] : [];\n\t}\n\n\t// exit if views equal oldViews\n\tif (\n\t\toldViews.length === views.length &&\n\t\t_(oldViews).all(function(oldView, index) {\n\t\t\treturn oldView === views[index];\n\t\t})\n\t) return this;\n\n\tif (oldViews.length) {\n\t\t// if old views array is not empty remove them from parent view\n\t\tthis._removeViews(oldViews, container);\n\n\t\t// and remove views from DOM\n\t\t_(oldViews).each(function(view) {\n\t\t\tview.remove();\n\t\t});\n\t}\n\n\t// insert new views\n\treturn this._insertViews(views, container, index);\n};\n\nView._removeViews = function(views, container) {\n\tvar self = this;\n\n\tvar viewsGroup = this.getViews(container);\n\n\tif (!viewsGroup.length) return this;\n\n\tvar viewObjs = _(views)\n\t\t.chain()\n\t\t.uniq()\n\t\t.map(function(view) {\n\t\t\treturn {\n\t\t\t\tview: view,\n\t\t\t\tindex: _.indexOf(viewsGroup, view)\n\t\t\t};\n\t\t})\n\t\t.filter(function(viewObj) {\n\t\t\treturn viewObj.index >= 0;\n\t\t})\n\t\t.sortBy(function(viewObj) {\n\t\t\treturn -viewObj.index;\n\t\t})\n\t\t.value();\n\n\tif (!viewObjs.length) return this;\n\n\t_(viewObjs).each(function(viewObj) {\n\t\tvar view = viewObj.view;\n\n\t\t// remove item from group\n\t\tsplice.call(self.views[container], viewObj.index, 1);\n\n\t\t// undelegate all nested entity events\n\t\tself.undelegateNestedEvents(view);\n\n\t\t// unset view parent\n\t\tdelete view.parent;\n\t});\n\n\treturn this;\n};\n\n/**\n * Original setElement do undelegateEvents/delegateEvents, we remove it\n * because we have special detach/attach methods for this purpose\n *\n * @override\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.setElement = function(element) {\n\tvar $previousEl = this.$el;\n\n\tthis._setElement(element);\n\n\t// insert html to $el\n\tif ($previousEl && this.$container) {\n\t\t$previousEl.replaceWith(this.$el);\n\t}\n\n\tthis.ensureUI();\n\n\treturn this;\n};\n\nView.ensureUI = function() {\n\tvar self = this;\n\n\tthis.$ui = _(this.ui).mapObject(function(selector) {\n\t\treturn self.$(selector);\n\t});\n\n\treturn this;\n};\n\nView.delegateTriggers = function(triggers) {\n\ttriggers = triggers || _.result(this, 'triggers');\n\tif (!triggers) return this;\n\tvar self = this;\n\tthis.undelegateTriggers();\n\t_(triggers).each(function(event, key) {\n\t\tvar method = function() {\n\t\t\tself.trigger.apply(self, [event].concat(_.toArray(arguments)));\n\t\t};\n\t\tvar match = key.match(delegateEventSplitter);\n\t\tself.delegateTrigger(match[1], match[2], method);\n\t});\n\treturn this;\n};\n\nView.delegateTrigger = function(eventName, selector, listener) {\n\tthis.$el.on(eventName + '.delegateTriggers' + this.cid, selector, listener);\n\treturn this;\n};\n\nView.undelegateTriggers = function() {\n\tif (this.$el) this.$el.off('.delegateTriggers' + this.cid);\n\treturn this;\n};\n\nView.undelegateTrigger = function(eventName, selector, listener) {\n\tthis.$el.off(eventName + '.delegateTriggers' + this.cid, selector, listener);\n\treturn this;\n};\n\nView.delegateNestedEvents = function(type, name, entities) {\n\tif (!_.contains(nestedEntityTypes, type)) {\n\t\tthrow new Error(\n\t\t\t'Wrong entity type \"' + type + '\", available values: ' +\n\t\t\tnestedEntityTypes.join(', ')\n\t\t);\n\t}\n\n\tvar self = this;\n\n\tif (!entities) entities = this[type][name];\n\tif (!entities) return this;\n\tif (!_.isArray(entities)) entities = [entities];\n\tvar listeners = this._nestedEvents[type][name];\n\tif (listeners) {\n\t\tthis.undelegateNestedEvents(entities);\n\n\t\t_(listeners).each(function(listener) {\n\t\t\t_(entities).each(function(entity) {\n\t\t\t\tself.listenTo(entity, listener.eventName, listener.handler);\n\t\t\t});\n\t\t});\n\t}\n\n\treturn this;\n};\n\nView.undelegateNestedEvents = function(entities) {\n\tvar self = this;\n\n\tif (!_.isArray(entities)) entities = [entities];\n\t_(entities).each(function(entity) {\n\t\tself.stopListening(entity);\n\t});\n\n\treturn this;\n};\n\nView._prepareNestedEvents = function() {\n\tvar self = this;\n\n\t// Hash for nested events fast search\n\tthis._nestedEvents = {};\n\t_(nestedEntityTypes).each(function(entityType) {\n\t\tself._nestedEvents[entityType] = {};\n\t});\n\n\t// bind all prefixed events to view then call native delegate events\n\t_(nestedEventTypes).each(function(eventType, index) {\n\t\tvar entityType = nestedEntityTypes[index];\n\t\tvar entityEventsHash = self._nestedEvents[entityType];\n\n\t\t_(self[eventType]).each(function(method, key) {\n\t\t\tif (!_.isFunction(method)) method = self[method];\n\t\t\tif (!method) return;\n\t\t\tvar match = key.match(delegateEventSplitter);\n\t\t\tvar eventName = match[1];\n\t\t\tvar entityNames = match[2].replace(/ *, */g, ',').split(',');\n\t\t\tmethod = _.bind(method, self);\n\n\t\t\t// fill _nestedEvents\n\t\t\t_(entityNames).each(function(entityName) {\n\t\t\t\tentityEventsHash[entityName] = entityEventsHash[entityName] || [];\n\t\t\t\tentityEventsHash[entityName].push({\n\t\t\t\t\teventName: eventName,\n\t\t\t\t\thandler: method\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n};\n\n/**\n * Wrap all non-array view groups to arrays with one element and delegate events\n */\n\nView._prepareViews = function() {\n\tvar self = this;\n\n\t_(this.views).each(function(views, container) {\n\t\tif (!_.isArray(views)) views = [views];\n\n\t\tself.views[container] = views = _(views).map(function(view) {\n\t\t\tif (_.isFunction(view)) view = new view();\n\t\t\treturn view;\n\t\t});\n\t});\n};\n\nView._prepareModels = function() {\n\tvar self = this;\n\n\t_(this.models).each(function(model, name) {\n\t\tif (_.isFunction(model)) self.models[name] = new model();\n\t});\n\n\tif (this.model) {\n\t\tif (_.isFunction(this.model)) this.model = new this.model();\n\t\tthis.models[''] = this.model;\n\t}\n};\n\nView._prepareCollections = function() {\n\tvar self = this;\n\n\t_(this.collections).each(function(collection, name) {\n\t\tif (_.isFunction(collection)) self.collections[name] = new collection();\n\t});\n\n\tif (this.collection) {\n\t\tif (_.isFunction(this.collection)) this.collection = new this.collection();\n\t\tthis.collections[''] = this.collection;\n\t}\n};\n\n/**\n * Attach all nested views\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.attachViews = function(options) {\n\toptions = options || {};\n\n\t// iterate by each nested views groups\n\t_(this.views).each(function(viewsGroup, container) {\n\t\tif (isContainerSkipped(container, options)) return;\n\n\t\t// return if views group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call attach method for each nested view from views group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\t// recursive attach all nested views\n\t\t\tview.attachViews(_.omit(options, 'include', 'exclude'));\n\n\t\t\t// attach current view\n\t\t\tview.attach();\n\t\t});\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/**\n * afterAttach is empty by default\n * It called after attach call, could be verriden to add some specific logic\n * for DOM manipulations\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.afterAttach = function() {\n\treturn this;\n};\n\n/**\n * Attach new view to current view $el\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.attach = function() {\n\t// return if current view is already attached\n\tif (this.attached) return this;\n\n\t// detach previous view\n\tvar previousView = this.$el.data('esencia-view');\n\tif (previousView) previousView.detach();\n\n\t// attach current view and set attr\n\tthis.$el.data('esencia-view', this).attr('esencia-view', this.cid);\n\n\t// enable all DOM events\n\tthis.delegateEvents();\n\n\tthis.delegateTriggers();\n\n\tthis.attached = true;\n\n\t// do some user afterAttach actions\n\tthis.afterAttach();\n\n\t// trigger attach event\n\tthis.trigger('esencia:attach');\n\n\treturn this;\n};\n\n/**\n * Detach all nested views\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.detachViews = function() {\n\t// iterate by each views groups\n\t_(this.views).each(function(viewsGroup) {\n\t\t// return if views group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call detach method for each nested view from views group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\t// recursive detach all nested views\n\t\t\tview.detachViews();\n\n\t\t\t// detach current view\n\t\t\tview.detach();\n\t\t});\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/**\n * beforeDetach is empty by default\n * It called before detach method call, could be overriden to add some specific\n * logic before view detach from dom\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.beforeDetach = function() {\n\treturn this;\n};\n\n/**\n * Detach view from current view $el\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.detach = function() {\n\t// return if current view is not already attached\n\tif (!this.attached) return this;\n\n\t// trigger detach event\n\tthis.trigger('esencia:detach');\n\n\t// do some user beforeDetach actions\n\tthis.beforeDetach();\n\n\t// remove attr and data from $el\n\tthis.$el.removeData('esencia-view').removeAttr('esencia-view');\n\n\t// disable all DOM events\n\tthis.undelegateEvents();\n\n\tthis.undelegateTriggers();\n\n\tthis.attached = false;\n\n\t// return this for chaining\n\treturn this;\n};\n\n/**\n * Remove view from parent container and remove element from DOM\n */\n\nView.remove = function() {\n\t// remove current view from parent view container\n\tif (this.parent) {\n\t\tthis.parent.removeView(this, this.container);\n\t}\n\n\t// detach all nested views first\n\tthis.detachViews();\n\n\t// detach current view\n\tthis.detach();\n\n\t// remove DOM element\n\treturn backbone.View.prototype.remove.call(this);\n};\n\n/**\n * Get view, that attached to closest element with attr `esencia-view`\n *\n * @param {String | $} selector\n * @return {Esencia.View | Null}\n */\n\nView.getClosestView = function(selector) {\n\tvar $selector = $(selector);\n\n\tif (!$selector.is('[esencia-view]')) {\n\t\t$selector = $selector.closest('[esencia-view]');\n\t}\n\n\treturn $selector.length ? $selector.data('esencia-view') : null;\n};\n\nmodule.exports = backbone.View.extend(View);\n","'use strict';\n\nvar backbone = require('backbone');\nvar _ = require('underscore');\nvar Router = require('./classes/router');\nvar Collection = require('./classes/collection');\nvar Model = require('./classes/model');\nvar View = require('./classes/view');\nvar ComponentsManager = require('./classes/componentsManager');\nvar componentsManager = require('./utils/componentsManager');\nvar extend = require('./utils/extend');\n\nvar Esencia = exports;\n\n// Allow the `Esencia` object to serve as a global event bus, for folks who\n// want global \"pubsub\" in a convenient place.\n_.extend(Esencia, backbone.Events);\n\n// Export some Backbone fields\nvar backboneFields = ['Events', 'History', 'history'];\n_.extend(Esencia, _.pick(backbone, backboneFields));\n\n// Export all Esencia classes\n_.extend(Esencia, {\n\tRouter: Router,\n\tCollection: Collection,\n\tModel: Model,\n\tView: View,\n\tComponentsManager: ComponentsManager\n});\n\n// Export the default Esencia.componentsManager\nEsencia.componentsManager = componentsManager;\n\n// Export extend helper for subclassing\nEsencia.extend = extend;\n","'use strict';\n\nvar ComponentsManager = require('../classes/componentsManager');\n\n// Create the default Esencia.componentsManager\nmodule.exports = new ComponentsManager();\n","'use strict';\n\nvar _ = require('underscore');\n\n// Default http method type for exec methods\nvar DEFAULT_EXEC_TYPE = 'PUT';\n\n// Throw an error when a URL is needed, and none is supplied.\nvar urlError = function() {\n\tthrow new Error('A `url` property or function must be specified');\n};\n\n// Wrap an optional error callback with a fallback error event.\nexports.wrapError = function(model, options) {\n\tvar error = options.error;\n\toptions.error = function(resp) {\n\t\tif (error) error.call(options.context, model, resp, options);\n\t\tmodel.trigger('error', model, resp, options);\n\t};\n};\n\nexports.prepareOptions = function(method, model, options) {\n\toptions = _.extend({\n\t\ttype: DEFAULT_EXEC_TYPE,\n\t\tdataType: 'json',\n\t\tcontentType: 'application/json',\n\t\tprocessData: false\n\t}, options);\n\n\t// Ensure that we have a URL and add method name to it\n\tif (!options.url) {\n\t\tvar url = _.result(model, 'url') || urlError();\n\t\toptions.url = url.replace(/[^\\/]$/, '$&/') + method;\n\t}\n\n\t// stringify data to json\n\tif (options.data && _.isObject(options.data) && !options.processData) {\n\t\toptions.data = JSON.stringify(options.data);\n\t}\n\n\treturn options;\n};\n\n// HTTP type to backbone sync methods map\nvar baseMethodsMap = {\n\t'POST': 'create',\n\t'PUT': 'update',\n\t'PATCH': 'patch',\n\t'DELETE': 'delete',\n\t'GET': 'read'\n};\n\nexports.getFakeBaseMethod = function(options) {\n\treturn baseMethodsMap[options.type.toUpperCase()];\n};\n","'use strict';\n\nvar backbone = require('backbone');\n\n// There is no good exports of extend method from backbone.\n// Take it from View because no other ways\nmodule.exports = backbone.View.extend;\n"]}