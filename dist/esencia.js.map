{"version":3,"sources":["lib/collection.js","lib/esencia.js","lib/router.js","lib/view.js"],"names":["_","_require","backbone","Collection","baseMethods","execMethodType","sync","method","model","options","contains","params","type","dataType","contentType","processData","url","result","urlError","charAt","length","data","isObject","JSON","stringify","xhr","ajax","extend","trigger","prototype","call","exec","clone","collection","success","resp","error","Error","module","exports","Router","View","root","rootViewEl","modulesPath","defaultModuleName","pushState","namedParameters","autoloadModules","debug","config","onModuleError","nowhereUrl","routerOptions","constructor","pick","components","componentsTree","urlParams","modules","history","apply","arguments","route","setModule","_initRootComponent","RootView","el","component","name","parent","_populateUrlParams","componentName","key","has","componentOptions","router","defaults","defaultUrlParams","viewOptions","process","isUndefined","uniqueId","isString","isNull","_processComponent","_calculateComponentsTree","child","node","_isComponentTreeNodeChanged","oldNode","view","isAttached","isUnchanged","_applyComponentsTree","callback","self","parentNode","iterateNode","childNode","onViewResolve","setData","container","setView","renderViews","render","chain","value","isWaiting","once","oldChildNode","oldChildNodeContainer","removeView","noop","newComponentsTree","isFunction","args","_defaultMiddleware","navigate","fragment","indexOf","substring","force","replace","omit","qs","each","val","undefined","toFragment","next","middleware","defaultMiddleware","moduleName","split","find","identity","require","moduleInit","start","$","splice","Array","delegateEventSplitter","nestedEventTypes","templateHelpers","wait","_waiting","views","template","_normalizeViews","_prepareNestedEvents","collections","delegateNestedEvents","models","_createTemplateElement","_isAfterAttachNeeded","attach","$el","_afterAttachViews","getTemplateData","renderTemplate","templateData","html","$html","$newEl","first","replaceWith","setElement","viewsGroup","$container","some","is","append","pluck","setViews","index","_updateViews","replaceView","replaceViews","appendView","appendViews","insertViews","prependView","prependViews","insertView","removeViews","getView","getViews","isArray","removedViews","remove","concat","viewObjs","uniq","map","filter","viewObj","sortBy","undelegateNestedEvents","delegateEvents","events","entities","listeners","_nestedEventsHash","listener","entity","listenTo","eventName","handler","stopListening","typeEventsHash","match","entityKeys","bind","entityKey","push","Boolean","afterAttach","previousView","detach","attr","cid","_detachViews","beforeDetach","removeData","removeAttr","undelegateEvents","_removeElement","getClosestView","selector","$selector","closest"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;YAAA,a;YAEA,IAAIA,CAAA,GAAIC,QAAA,CAAQ,CAAR,CAAR,C;YACA,IAAIC,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YAEA,IAAIE,UAAA,GAAa,EAAjB,C;YAGA,IAAIC,WAAA,GAAc;AAAA,oBAAC,QAAD;AAAA,oBAAW,QAAX;AAAA,oBAAqB,OAArB;AAAA,oBAA8B,QAA9B;AAAA,oBAAwC,MAAxC;AAAA,iBAAlB,C;YAEA,IAAIC,cAAA,GAAiB,KAArB,C;YAMAF,UAAA,CAAWG,IAAX,GAAkB,UAASC,MAAT,EAAiBC,KAAjB,EAAwBC,OAAxB,EAAiC;AAAA,gBAElD,IAAI,CAACT,CAAA,CAAEU,QAAF,CAAWN,WAAX,EAAwBG,MAAxB,CAAL,EAAsC;AAAA,oBACrCE,OAAA,GAAUA,OAAA,IAAW,EAArB,CADqC;AAAA,oBAGrC,IAAIE,MAAA,GAAS;AAAA,4BACZC,IAAA,EAAMP,cADM;AAAA,4BAEZQ,QAAA,EAAU,MAFE;AAAA,4BAGZC,WAAA,EAAa,kBAHD;AAAA,4BAIZC,WAAA,EAAa,KAJD;AAAA,yBAAb,CAHqC;AAAA,oBAWrC,IAAI,CAACN,OAAA,CAAQO,GAAb,EAAkB;AAAA,wBACjB,IAAIA,GAAA,GAAMhB,CAAA,CAAEiB,MAAF,CAAST,KAAT,EAAgB,KAAhB,KAA0BU,QAAA,EAApC,CADiB;AAAA,wBAEjBP,MAAA,CAAOK,GAAP,GAAaA,GAAA,GAAO,CAAAA,GAAA,CAAIG,MAAJ,CAAWH,GAAA,CAAII,MAAJ,GAAa,CAAxB,MAA+B,GAA/B,GAAqC,EAArC,GAA0C,GAA1C,CAAP,GAAwDb,MAArE,CAFiB;AAAA,qBAXmB;AAAA,oBAiBrC,IAAIE,OAAA,CAAQY,IAAR,IAAgBrB,CAAA,CAAEsB,QAAF,CAAWb,OAAA,CAAQY,IAAnB,CAApB,EAA8C;AAAA,wBAC7CZ,OAAA,CAAQY,IAAR,GAAeE,IAAA,CAAKC,SAAL,CAAef,OAAA,CAAQY,IAAvB,CAAf,CAD6C;AAAA,qBAjBT;AAAA,oBAsBrC,IAAII,GAAA,GAAMhB,OAAA,CAAQgB,GAAR,GAAcvB,QAAA,CAASwB,IAAT,CAAc1B,CAAA,CAAE2B,MAAF,CAAShB,MAAT,EAAiBF,OAAjB,CAAd,CAAxB,CAtBqC;AAAA,oBAuBrCD,KAAA,CAAMoB,OAAN,CAAc,SAAd,EAAyBpB,KAAzB,EAAgCiB,GAAhC,EAAqChB,OAArC,EAvBqC;AAAA,oBAwBrC,OAAOgB,GAAP,CAxBqC;AAAA,iBAAtC,MAyBO;AAAA,oBAEN,OAAOvB,QAAA,CAASC,UAAT,CAAoB0B,SAApB,CAA8BvB,IAA9B,CAAmCwB,IAAnC,CAAwC,IAAxC,EAA8CvB,MAA9C,EAAsDC,KAAtD,EAA6DC,OAA7D,CAAP,CAFM;AAAA,iBA3B2C;AAAA,aAAnD,C;YAyCAN,UAAA,CAAW4B,IAAX,GAAkB,UAASxB,MAAT,EAAiBE,OAAjB,EAA0B;AAAA,gBAC3CA,OAAA,GAAUA,OAAA,GAAUT,CAAA,CAAEgC,KAAF,CAAQvB,OAAR,CAAV,GAA6B,EAAvC,CAD2C;AAAA,gBAG3C,IAAIwB,UAAA,GAAa,IAAjB,CAH2C;AAAA,gBAI3C,IAAIC,OAAA,GAAUzB,OAAA,CAAQyB,OAAtB,CAJ2C;AAAA,gBAK3CzB,OAAA,CAAQyB,OAAR,GAAkB,UAASC,IAAT,EAAe;AAAA,oBAChC,IAAID,OAAJ;AAAA,wBAAaA,OAAA,CAAQD,UAAR,EAAoBE,IAApB,EAA0B1B,OAA1B,EADmB;AAAA,oBAEhCwB,UAAA,CAAWL,OAAX,CAAmB,UAAUrB,MAA7B,EAAqC0B,UAArC,EAAiDE,IAAjD,EAAuD1B,OAAvD,EAFgC;AAAA,iBAAjC,CAL2C;AAAA,gBAU3C,IAAI2B,KAAA,GAAQ3B,OAAA,CAAQ2B,KAApB,CAV2C;AAAA,gBAW3C3B,OAAA,CAAQ2B,KAAR,GAAgB,UAASD,IAAT,EAAe;AAAA,oBAC9B,IAAIC,KAAJ;AAAA,wBAAWA,KAAA,CAAMH,UAAN,EAAkBE,IAAlB,EAAwB1B,OAAxB,EADmB;AAAA,oBAE9BwB,UAAA,CAAWL,OAAX,CAAmB,OAAnB,EAA4BK,UAA5B,EAAwCE,IAAxC,EAA8C1B,OAA9C,EAF8B;AAAA,iBAA/B,CAX2C;AAAA,gBAgB3C,OAAO,KAAKH,IAAL,CAAUC,MAAV,EAAkB,IAAlB,EAAwBE,OAAxB,CAAP,CAhB2C;AAAA,aAA5C,C;YAoBA,IAAIS,QAAA,GAAW,YAAW;AAAA,gBACzB,MAAM,IAAImB,KAAJ,CAAU,gDAAV,CAAN,CADyB;AAAA,aAA1B,C;YAIAC,MAAA,CAAOC,OAAP,GAAiBrC,QAAA,CAASC,UAAT,CAAoBwB,MAApB,CAA2BxB,UAA3B,CAAjB,C;;;YCjFA,a;YAEA,IAAIqC,MAAA,GAASvC,QAAA,CAAQ,CAAR,CAAb,C;YACA,IAAIE,UAAA,GAAaF,QAAA,CAAQ,CAAR,CAAjB,C;YACA,IAAIwC,IAAA,GAAOxC,QAAA,CAAQ,CAAR,CAAX,C;YAEAqC,MAAA,CAAOC,OAAP,CAAeC,MAAf,GAAwBA,MAAxB,C;YACAF,MAAA,CAAOC,OAAP,CAAepC,UAAf,GAA4BA,UAA5B,C;YACAmC,MAAA,CAAOC,OAAP,CAAeE,IAAf,GAAsBA,IAAtB,C;;;YCRA,a;YAEA,IAAIzC,CAAA,GAAIC,QAAA,CAAQ,CAAR,CAAR,C;YACA,IAAIC,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YACA,IAAIwC,IAAA,GAAOxC,QAAA,CAAQ,CAAR,CAAX,C;YAMA,IAAIuC,MAAA,GAAS;AAAA,oBACZE,IAAA,EAAM,GADM;AAAA,oBAEZC,UAAA,EAAY,MAFA;AAAA,oBAGZC,WAAA,EAAa,UAHD;AAAA,oBAIZC,iBAAA,EAAmB,MAJP;AAAA,oBAKZC,SAAA,EAAW,KALC;AAAA,oBAMZC,eAAA,EAAiB,KANL;AAAA,oBAOZC,eAAA,EAAiB,IAPL;AAAA,oBAQZC,KAAA,EAAO,KARK;AAAA,oBASZC,MAAA,EAAQ,EATI;AAAA,oBAUZC,aAAA,EAAe,YAAW;AAAA,qBAVd;AAAA,oBAWZC,UAAA,EAAY,KAXA;AAAA,iBAAb,C;YAcA,IAAIC,aAAA,GAAgB;AAAA,oBACnB,MADmB;AAAA,oBACX,YADW;AAAA,oBACG,aADH;AAAA,oBACkB,mBADlB;AAAA,oBACuC,WADvC;AAAA,oBAEnB,iBAFmB;AAAA,oBAEA,iBAFA;AAAA,oBAEmB,OAFnB;AAAA,oBAE4B,QAF5B;AAAA,oBAEsC,eAFtC;AAAA,oBAGnB,YAHmB;AAAA,iBAApB,C;YAWAb,MAAA,CAAOc,WAAP,GAAqB,UAAS7C,OAAT,EAAkB;AAAA,gBACtCA,OAAA,GAAUA,OAAA,IAAW,EAArB,CADsC;AAAA,gBAItCT,CAAA,CAAE2B,MAAF,CAAS,IAAT,EAAe3B,CAAA,CAAEuD,IAAF,CAAO9C,OAAP,EAAgB4C,aAAhB,CAAf,EAJsC;AAAA,gBAOtC,KAAK5C,OAAL,GAAeA,OAAf,CAPsC;AAAA,gBAStC,KAAK+C,UAAL,GAAkB,EAAlB,CATsC;AAAA,gBAUtC,KAAKC,cAAL,GAAsB,IAAtB,CAVsC;AAAA,gBAWtC,KAAKC,SAAL,GAAiB,EAAjB,CAXsC;AAAA,gBAYtC,KAAKC,OAAL,GAAe,EAAf,CAZsC;AAAA,gBActC,KAAKC,OAAL,GAAe1D,QAAA,CAAS0D,OAAxB,CAdsC;AAAA,gBAsBtC1D,QAAA,CAASsC,MAAT,CAAgBO,eAAhB,GAAkC,KAAKA,eAAvC,CAtBsC;AAAA,gBAwBtC7C,QAAA,CAASsC,MAAT,CAAgBqB,KAAhB,CAAsB,IAAtB,EAA4BC,SAA5B,EAxBsC;AAAA,gBA0BtC,IAAIrD,OAAA,CAAQuC,eAAZ,EAA6B;AAAA,oBAC5B,KAAKe,KAAL,CAAW,MAAX,EAAmB,UAASpD,MAAT,EAAiB;AAAA,wBACnC,KAAKqD,SAAL,CAAerD,MAAf,EADmC;AAAA,qBAApC,EAD4B;AAAA,iBA1BS;AAAA,aAAvC,C;YAiCA6B,MAAA,CAAOyB,kBAAP,GAA4B,YAAW;AAAA,gBACtC,IAAIC,QAAA,GAAWzB,IAAA,CAAKd,MAAL,CAAY,EAC1BwC,EAAA,EAAI,KAAKxB,UADiB,EAAZ,CAAf,CADsC;AAAA,gBAKtC,KAAKyB,SAAL,CAAe;AAAA,oBACdC,IAAA,EAAM,EADQ;AAAA,oBAEdC,MAAA,EAAQ,IAFM;AAAA,oBAGd7B,IAAA,EAAMyB,QAHQ;AAAA,iBAAf,EALsC;AAAA,aAAvC,C;YAYA1B,MAAA,CAAO+B,kBAAP,GAA4B,UAASC,aAAT,EAAwB7D,MAAxB,EAAgC;AAAA,gBAC3D,IAAI+C,SAAA,GAAY,KAAKA,SAArB,CAD2D;AAAA,gBAI3D,IAAIe,GAAJ,CAJ2D;AAAA,gBAK3D,KAAKA,GAAL,IAAYf,SAAZ,EAAuB;AAAA,oBACtB,IAAI1D,CAAA,CAAE0D,SAAF,EAAagB,GAAb,CAAiBD,GAAjB,CAAJ,EAA2B;AAAA,wBAC1B,OAAOf,SAAA,CAAUe,GAAV,CAAP,CAD0B;AAAA,qBADL;AAAA,iBALoC;AAAA,gBAW3D,IAAIL,SAAA,GAAY,KAAKZ,UAAL,CAAgBgB,aAAhB,CAAhB,CAX2D;AAAA,gBAc3D,OAAOxE,CAAA,CAAE0D,SAAF,EAAa/B,MAAb,CACN3B,CAAA,CAAEoE,SAAF,EAAanD,MAAb,CAAoB,kBAApB,CADM,EAENN,MAFM,CAAP,CAd2D;AAAA,aAA5D,C;YA0BC,IAAIgE,gBAAA,GAAmB;AAAA,oBACvB,KADuB;AAAA,oBAChB,MADgB;AAAA,oBACR,QADQ;AAAA,oBACE,WADF;AAAA,oBACe,MADf;AAAA,oBACuB,QADvB;AAAA,oBACiC,aADjC;AAAA,oBAEvB,aAFuB;AAAA,oBAER,kBAFQ;AAAA,iBAAvB,C;YAKDnC,MAAA,CAAO4B,SAAP,GAAmB,UAAS3D,OAAT,EAAkB;AAAA,gBACpC,IAAImE,MAAA,GAAS,IAAb,CADoC;AAAA,gBAGpCnE,OAAA,GAAUT,CAAA,CAAE,EAAF,EAAM6E,QAAN,CAAepE,OAAf,EAAwB;AAAA,oBACjC6D,MAAA,EAAQ,EADyB;AAAA,oBAEjCQ,gBAAA,EAAkB,EAFe;AAAA,oBAGjCC,WAAA,EAAa,EAHoB;AAAA,oBAIjCC,OAAA,EAAS,KAJwB;AAAA,iBAAxB,CAAV,CAHoC;AAAA,gBAUpC,IAAIZ,SAAA,GAAYpE,CAAA,CAAES,OAAF,EAAW8C,IAAX,CAAgBoB,gBAAhB,CAAhB,CAVoC;AAAA,gBAapC,IAAI3E,CAAA,CAAEiF,WAAF,CAAcb,SAAA,CAAUC,IAAxB,CAAJ,EAAmC;AAAA,oBAClCD,SAAA,CAAUC,IAAV,GAAiBrE,CAAA,CAAEkF,QAAF,CAAW,sBAAX,CAAjB,CADkC;AAAA,iBAbC;AAAA,gBAiBpC,IAAI,CAAClF,CAAA,CAAEmF,QAAF,CAAWf,SAAA,CAAUC,IAArB,CAAL,EAAiC;AAAA,oBAChC,MAAM,IAAIhC,KAAJ,CAAU,4CAAV,CAAN,CADgC;AAAA,iBAjBG;AAAA,gBAqBpC,IAAI+B,SAAA,CAAUC,IAAV,IAAkB,KAAKb,UAA3B,EAAuC;AAAA,oBACtC,MAAM,IAAInB,KAAJ,CAAU,oCAAoC+B,SAAA,CAAUC,IAA9C,GAAqD,GAA/D,CAAN,CADsC;AAAA,iBArBH;AAAA,gBAyBpC,IAAI,CAACD,SAAA,CAAU3B,IAAf,EAAqB;AAAA,oBACpB,MAAM,IAAIJ,KAAJ,CAAU,qCAAV,CAAN,CADoB;AAAA,iBAzBe;AAAA,gBA6BpC,IAAI,CAACrC,CAAA,CAAEmF,QAAF,CAAWf,SAAA,CAAUE,MAArB,CAAD,IAAiC,CAACtE,CAAA,CAAEoF,MAAF,CAAShB,SAAA,CAAUE,MAAnB,CAAtC,EAAkE;AAAA,oBACjE,MAAM,IAAIjC,KAAJ,CAAU,sDAAV,CAAN,CADiE;AAAA,iBA7B9B;AAAA,gBAiCpC,KAAKmB,UAAL,CAAgBY,SAAA,CAAUC,IAA1B,IAAkCD,SAAlC,CAjCoC;AAAA,gBAoCpC,IAAI,CAACpE,CAAA,CAAEiF,WAAF,CAAcb,SAAA,CAAUpD,GAAxB,CAAL,EAAmC;AAAA,oBAClC,KAAK+C,KAAL,CAAWK,SAAA,CAAUpD,GAArB,EAA0BoD,SAAA,CAAUC,IAApC,EAA0C,UAAS1D,MAAT,EAAiB;AAAA,wBAC1DiE,MAAA,CAAOL,kBAAP,CAA0BH,SAAA,CAAUC,IAApC,EAA0C1D,MAA1C,EAD0D;AAAA,wBAI1DiE,MAAA,CAAOS,iBAAP,CAAyBjB,SAAA,CAAUC,IAAnC,EAJ0D;AAAA,qBAA3D,EADkC;AAAA,iBApCC;AAAA,gBA8CpC,IAAI5D,OAAA,CAAQuE,OAAZ,EAAqB;AAAA,oBACpB,KAAKK,iBAAL,CAAuBjB,SAAA,CAAUC,IAAjC,EADoB;AAAA,iBA9Ce;AAAA,gBAkDpC,OAAO,IAAP,CAlDoC;AAAA,aAArC,C;YAqDA7B,MAAA,CAAO8C,wBAAP,GAAkC,UAASd,aAAT,EAAwBe,KAAxB,EAA+B;AAAA,gBAChE,IAAInB,SAAA,GAAY,KAAKZ,UAAL,CAAgBgB,aAAhB,CAAhB,CADgE;AAAA,gBAGhE,IAAI,CAACJ,SAAL,EAAgB;AAAA,oBACf,MAAM,IAAI/B,KAAJ,CAAU,kCAAkCmC,aAAlC,GAAkD,GAA5D,CAAN,CADe;AAAA,iBAHgD;AAAA,gBAOhE,IAAIgB,IAAA,GAAO,EAACnB,IAAA,EAAMG,aAAP,EAAX,CAPgE;AAAA,gBAQhE,IAAIe,KAAJ,EAAW;AAAA,oBACVC,IAAA,CAAKD,KAAL,GAAaA,KAAb,CADU;AAAA,iBARqD;AAAA,gBAYhE,IAAIvF,CAAA,CAAEmF,QAAF,CAAWf,SAAA,CAAUE,MAArB,CAAJ,EAAkC;AAAA,oBACjC,OAAO,KAAKgB,wBAAL,CAA8BlB,SAAA,CAAUE,MAAxC,EAAgDkB,IAAhD,CAAP,CADiC;AAAA,iBAAlC,MAEO;AAAA,oBACN,OAAOA,IAAP,CADM;AAAA,iBAdyD;AAAA,aAAjE,C;YAmBAhD,MAAA,CAAOiD,2BAAP,GAAqC,UAASC,OAAT,EAAkBF,IAAlB,EAAwB;AAAA,gBAC5D,IAAI,CAACE,OAAD,IAAYA,OAAA,CAAQrB,IAAR,KAAiBmB,IAAA,CAAKnB,IAAlC,IAA0C,CAACqB,OAAA,CAAQC,IAAvD;AAAA,oBAA6D,OAAO,IAAP,CADD;AAAA,gBAE5D,IAAIvB,SAAA,GAAY,KAAKZ,UAAL,CAAgBgC,IAAA,CAAKnB,IAArB,CAAhB,CAF4D;AAAA,gBAG5D,IAAIqB,OAAA,CAAQC,IAAR,YAAwBvB,SAAA,CAAU3B,IAAlC,KAA2C,KAA/C;AAAA,oBAAsD,OAAO,IAAP,CAHM;AAAA,gBAI5D,IAAI,CAACiD,OAAA,CAAQC,IAAR,CAAaC,UAAb,EAAL;AAAA,oBAAgC,OAAO,IAAP,CAJ4B;AAAA,gBAK5D,OAAO,CAACF,OAAA,CAAQC,IAAR,CAAaE,WAAb,EAAR,CAL4D;AAAA,aAA7D,C;YAQArD,MAAA,CAAOsD,oBAAP,GAA8B,UAASnF,MAAT,EAAiBoF,QAAjB,EAA2B;AAAA,gBACxD,IAAIC,IAAA,GAAO,IAAX,CADwD;AAAA,gBAGxD,IAAIC,UAAA,GAAatF,MAAA,CAAOsF,UAAxB,CAHwD;AAAA,gBAKxD,IAAIC,WAAA,GAAc,UAASR,OAAT,EAAkBF,IAAlB,EAAwB;AAAA,oBAGzC,IAAIW,SAAA,GAAYX,IAAA,CAAKD,KAArB,CAHyC;AAAA,oBAIzC,OAAOC,IAAA,CAAKD,KAAZ,CAJyC;AAAA,oBAMzC,IAAIU,UAAJ,EAAgB;AAAA,wBACfA,UAAA,CAAWV,KAAX,GAAmBC,IAAnB,CADe;AAAA,qBAAhB,MAEO;AAAA,wBACNQ,IAAA,CAAKvC,cAAL,GAAsB+B,IAAtB,CADM;AAAA,qBARkC;AAAA,oBAYzC,IAAIW,SAAJ,EAAe;AAAA,wBACdH,IAAA,CAAKF,oBAAL,CAA0B;AAAA,4BACzBG,UAAA,EAAYT,IADa;AAAA,4BAEzBE,OAAA,EAASA,OAAA,IAAWA,OAAA,CAAQH,KAAnB,IAA4B,IAFZ;AAAA,4BAGzBC,IAAA,EAAMW,SAHmB;AAAA,yBAA1B,EAIGJ,QAJH,EADc;AAAA,qBAAf,MAMO;AAAA,wBACNA,QAAA,GADM;AAAA,qBAlBkC;AAAA,iBAA1C,CALwD;AAAA,gBA4BxD,IAAIP,IAAA,GAAO7E,MAAA,CAAO6E,IAAlB,CA5BwD;AAAA,gBA6BxD,IAAIE,OAAA,GAAU/E,MAAA,CAAO+E,OAArB,CA7BwD;AAAA,gBA8BxD,IAAItB,SAAA,GAAY,KAAKZ,UAAL,CAAgBgC,IAAA,CAAKnB,IAArB,CAAhB,CA9BwD;AAAA,gBAgCxD,IAAI+B,aAAA,GAAgB,UAAST,IAAT,EAAe;AAAA,oBAClCH,IAAA,CAAKG,IAAL,GAAYA,IAAZ,CADkC;AAAA,oBAElCA,IAAA,CAAKU,OAAL,GAFkC;AAAA,oBAIlC,IAAIjC,SAAA,CAAUkC,SAAd,EAAyB;AAAA,wBACxB,IAAI,CAACL,UAAL,EAAiB;AAAA,4BAChB,MAAM,IAAI5D,KAAJ,CAAU,sDACf,oBADK,CAAN,CADgB;AAAA,yBADO;AAAA,wBAMxB4D,UAAA,CAAWN,IAAX,CAAgBY,OAAhB,CAAwBZ,IAAxB,EAA8BvB,SAAA,CAAUkC,SAAxC,EANwB;AAAA,wBAOxBL,UAAA,CAAWN,IAAX,CAAgBa,WAAhB,GAPwB;AAAA,qBAAzB,MAQO;AAAA,wBACNb,IAAA,CAAKc,MAAL,GADM;AAAA,qBAZ2B;AAAA,oBAiBlCP,WAAA,CAAY,IAAZ,EAAkBV,IAAlB,EAjBkC;AAAA,iBAAnC,CAhCwD;AAAA,gBAoDxD,IAAIG,IAAJ,CApDwD;AAAA,gBAqDxD,IAAI,KAAKF,2BAAL,CAAiCC,OAAjC,EAA0CF,IAA1C,CAAJ,EAAqD;AAAA,oBAKpDG,IAAA,GAAO,IAAKvB,SAAA,CAAU3B,IAAf,CACNzC,CAAA,CAAEoE,SAAF,EACEsC,KADF,GAEEnD,IAFF,CAEO,QAFP,EAEiB,aAFjB,EAGEsB,QAHF,CAGW7E,CAAA,CAAEoE,SAAF,EAAanD,MAAb,CAAoB,aAApB,CAHX,EAIEU,MAJF,CAIS,EAACiD,MAAA,EAAQ,IAAT,EAJT,EAKE+B,KALF,EADM,CAAP,CALoD;AAAA,oBAcpD,IAAIhB,IAAA,CAAKiB,SAAL,EAAJ,EAAsB;AAAA,wBAErBjB,IAAA,CAAKkB,IAAL,CAAU,SAAV,EAAqB,YAAW;AAAA,4BAC/BT,aAAA,CAAcT,IAAd,EAD+B;AAAA,yBAAhC,EAFqB;AAAA,qBAAtB,MAKO;AAAA,wBACNS,aAAA,CAAcT,IAAd,EADM;AAAA,qBAnB6C;AAAA,iBAArD,MAsBO;AAAA,oBAENA,IAAA,GAAOD,OAAA,CAAQC,IAAf,CAFM;AAAA,oBAIN,IAAImB,YAAA,GAAepB,OAAA,CAAQH,KAA3B,CAJM;AAAA,oBAON,IAAIwB,qBAAJ,CAPM;AAAA,oBAQN,IAAID,YAAA,IAAgBA,YAAA,CAAanB,IAAjC,EAAuC;AAAA,wBACtCoB,qBAAA,GAAwBD,YAAA,CAAanB,IAAb,CAAkBW,SAA1C,CADsC;AAAA,wBAEtCX,IAAA,CAAKqB,UAAL,CAAgBF,YAAA,CAAanB,IAA7B,EAAmCoB,qBAAnC,EAFsC;AAAA,qBARjC;AAAA,oBAaNvB,IAAA,CAAKG,IAAL,GAAYA,IAAZ,CAbM;AAAA,oBAcNA,IAAA,CAAKU,OAAL,GAdM;AAAA,oBAeNV,IAAA,CAAKc,MAAL,GAfM;AAAA,oBAkBN,IAAIK,YAAA,IAAgBA,YAAA,CAAanB,IAAjC,EAAuC;AAAA,wBACtCA,IAAA,CAAKY,OAAL,CAAaO,YAAA,CAAanB,IAA1B,EAAgCoB,qBAAhC,EADsC;AAAA,qBAlBjC;AAAA,oBAuBNb,WAAA,CAAYR,OAAZ,EAAqBF,IAArB,EAvBM;AAAA,iBA3EiD;AAAA,aAAzD,C;YAsGAhD,MAAA,CAAO6C,iBAAP,GAA2B,UAASb,aAAT,EAAwBuB,QAAxB,EAAkC;AAAA,gBAC5DA,QAAA,GAAWA,QAAA,IAAY/F,CAAA,CAAEiH,IAAzB,CAD4D;AAAA,gBAG5D,IAAIC,iBAAA,GAAoB,KAAK5B,wBAAL,CAA8Bd,aAA9B,CAAxB,CAH4D;AAAA,gBAK5D,KAAKsB,oBAAL,CAA0B;AAAA,oBACzBG,UAAA,EAAY,IADa;AAAA,oBAEzBP,OAAA,EAAS,KAAKjC,cAFW;AAAA,oBAGzB+B,IAAA,EAAM0B,iBAHmB;AAAA,iBAA1B,EAIGnB,QAJH,EAL4D;AAAA,aAA7D,C;YAgBAvD,MAAA,CAAOuB,KAAP,GAAe,UAAS/C,GAAT,EAAcqD,IAAd,EAAoB0B,QAApB,EAA8B;AAAA,gBAC5C,IAAInB,MAAA,GAAS,IAAb,CAD4C;AAAA,gBAG5C,IAAI5E,CAAA,CAAEmH,UAAF,CAAa9C,IAAb,CAAJ,EAAwB;AAAA,oBACvB0B,QAAA,GAAW1B,IAAX,CADuB;AAAA,oBAEvBA,IAAA,GAAO,EAAP,CAFuB;AAAA,iBAHoB;AAAA,gBAQ5CnE,QAAA,CAASsC,MAAT,CAAgBX,SAAhB,CAA0BkC,KAA1B,CAAgCjC,IAAhC,CAAqC,IAArC,EAA2Cd,GAA3C,EAAgDqD,IAAhD,EAAsD,YAAW;AAAA,oBAChE,IAAI+C,IAAA,GAAOtD,SAAX,CADgE;AAAA,oBAGhEc,MAAA,CAAOyC,kBAAP,CAA0B;AAAA,wBACzBrG,GAAA,EAAKA,GADoB;AAAA,wBAEzBqD,IAAA,EAAMA,IAFmB;AAAA,wBAGzB0B,QAAA,EAAUA,QAHe;AAAA,qBAA1B,EAIG,YAAW;AAAA,wBACbA,QAAA,CAASlC,KAAT,CAAee,MAAf,EAAuBwC,IAAvB,EADa;AAAA,qBAJd,EAHgE;AAAA,iBAAjE,EAR4C;AAAA,aAA7C,C;YA4BA5E,MAAA,CAAO8E,QAAP,GAAkB,UAASC,QAAT,EAAmB9G,OAAnB,EAA4B;AAAA,gBAC7CA,OAAA,GAAUA,OAAA,IAAW,EAArB,CAD6C;AAAA,gBAG7C,IAAI8G,QAAA,CAASC,OAAT,CAAiB,KAAK9E,IAAtB,MAAgC,CAApC,EAAuC;AAAA,oBACtC6E,QAAA,GAAWA,QAAA,CAASE,SAAT,CAAmB,KAAK/E,IAAL,CAAUtB,MAA7B,CAAX,CADsC;AAAA,iBAHM;AAAA,gBAS7C,IAAIX,OAAA,CAAQiH,KAAZ,EAAmB;AAAA,oBAClB,KAAKJ,QAAL,CAAc,KAAKlE,UAAnB,EAA+B;AAAA,wBAC9BuE,OAAA,EAASlH,OAAA,CAAQkH,OADa;AAAA,wBAE9B/F,OAAA,EAAS,KAFqB;AAAA,qBAA/B,EADkB;AAAA,oBAMlBnB,OAAA,GAAUT,CAAA,CAAES,OAAF,EAAWiG,KAAX,GAAmBkB,IAAnB,CAAwB,OAAxB,EAAiCjG,MAAjC,CAAwC,EAACgG,OAAA,EAAS,IAAV,EAAxC,EAAyDhB,KAAzD,EAAV,CANkB;AAAA,oBAQlB,OAAO,KAAKW,QAAL,CAAcC,QAAd,EAAwB9G,OAAxB,CAAP,CARkB;AAAA,iBAT0B;AAAA,gBAqB7CA,OAAA,GAAUT,CAAA,CAAES,OAAA,IAAW,EAAb,EAAiBoE,QAAjB,CAA0B;AAAA,oBACnCjD,OAAA,EAAS,IAD0B;AAAA,oBAEnCjB,MAAA,EAAQ,EAF2B;AAAA,iBAA1B,CAAV,CArB6C;AAAA,gBA2B7C,IAAIkH,EAAA,GAAKpH,OAAA,CAAQoH,EAAjB,CA3B6C;AAAA,gBA6B7C,IAAIA,EAAJ,EAAQ;AAAA,oBAEP7H,CAAA,CAAE6H,EAAF,EAAMC,IAAN,CAAW,UAASC,GAAT,EAActD,GAAd,EAAmBoD,EAAnB,EAAuB;AAAA,wBACjC,IAAIE,GAAA,KAAQC,SAAR,IAAqBD,GAAA,KAAQ,IAAjC;AAAA,4BAAuC,OAAOF,EAAA,CAAGpD,GAAH,CAAP,CADN;AAAA,qBAAlC,EAFO;AAAA,oBAOP8C,QAAA,GAAW,KAAKU,UAAL,CAAgBV,QAAhB,EAA0BM,EAA1B,CAAX,CAPO;AAAA,oBASP,OAAOpH,OAAA,CAAQoH,EAAf,CATO;AAAA,iBA7BqC;AAAA,gBAyC7C3H,QAAA,CAASsC,MAAT,CAAgBX,SAAhB,CAA0ByF,QAA1B,CAAmCxF,IAAnC,CAAwC,IAAxC,EAA8CyF,QAA9C,EAAwD9G,OAAxD,EAzC6C;AAAA,aAA9C,C;YAiDA+B,MAAA,CAAO6E,kBAAP,GAA4B,UAAStD,KAAT,EAAgBmE,IAAhB,EAAsB;AAAA,gBACjDA,IAAA,GADiD;AAAA,aAAlD,C;YAYA1F,MAAA,CAAO2F,UAAP,GAAoB,UAASA,UAAT,EAAqB;AAAA,gBACxC,IAAIvD,MAAA,GAAS,IAAb,CADwC;AAAA,gBAGxC,IAAIwD,iBAAA,GAAoB,KAAKf,kBAA7B,CAHwC;AAAA,gBAKxC,KAAKA,kBAAL,GAA0B,UAAStD,KAAT,EAAgBmE,IAAhB,EAAsB;AAAA,oBAC/CE,iBAAA,CAAkBtG,IAAlB,CAAuB8C,MAAvB,EAA+Bb,KAA/B,EAAsC,YAAW;AAAA,wBAChDoE,UAAA,CAAWrG,IAAX,CAAgB8C,MAAhB,EAAwBb,KAAxB,EAA+BmE,IAA/B,EADgD;AAAA,qBAAjD,EAD+C;AAAA,iBAAhD,CALwC;AAAA,gBAWxC,OAAO,IAAP,CAXwC;AAAA,aAAzC,C;YAmBA1F,MAAA,CAAOwB,SAAP,GAAmB,UAASrD,MAAT,EAAiB;AAAA,gBACnC,IAAIiE,MAAA,GAAS,IAAb,CADmC;AAAA,gBAGnC,IAAI5D,GAAA,GAAML,MAAA,CAAOK,GAAjB,CAHmC;AAAA,gBAInC,OAAOL,MAAA,CAAOK,GAAd,CAJmC;AAAA,gBAMnC,IAAIqH,UAAA,GAAarI,CAAA,CAAEgB,GAAA,CAAIsH,KAAJ,CAAU,GAAV,CAAF,EAAkBC,IAAlB,CAAuBvI,CAAA,CAAEwI,QAAzB,KAAsC,KAAK3F,iBAA5D,CANmC;AAAA,gBASnC4F,OAAA,CAAQ,CAAC,KAAK7F,WAAL,GAAmByF,UAApB,CAAR,EAAyC,UAASK,UAAT,EAAqB;AAAA,oBAE7D,IAAI,CAAC9D,MAAA,CAAOjB,OAAP,CAAe0E,UAAf,CAAL,EAAiC;AAAA,wBAEhCK,UAAA,CAAW9D,MAAX,EAFgC;AAAA,wBAKhCA,MAAA,CAAOjB,OAAP,CAAe0E,UAAf,IAA6B,IAA7B,CALgC;AAAA,wBAQhCzD,MAAA,CAAO0C,QAAP,CAAgBtG,GAAhB,EAAqB;AAAA,4BACpB2G,OAAA,EAAS,IADW;AAAA,4BAEpBD,KAAA,EAAO,IAFa;AAAA,4BAGpBG,EAAA,EAAIlH,MAHgB;AAAA,yBAArB,EARgC;AAAA,qBAF4B;AAAA,iBAA9D,EAgBG,KAAKwC,aAhBR,EATmC;AAAA,aAApC,C;YAgCAX,MAAA,CAAOmG,KAAP,GAAe,YAAW;AAAA,gBACzB,KAAK1E,kBAAL,GADyB;AAAA,gBAGzB/D,QAAA,CAAS0D,OAAT,CAAiB+E,KAAjB,CAAuB;AAAA,oBACtB7F,SAAA,EAAW,KAAKA,SADM;AAAA,oBAEtBJ,IAAA,EAAM,KAAKA,IAFW;AAAA,iBAAvB,EAHyB;AAAA,aAA1B,C;YASAJ,MAAA,CAAOC,OAAP,GAAiBrC,QAAA,CAASsC,MAAT,CAAgBb,MAAhB,CAAuBa,MAAvB,CAAjB,C;;;YC1cA,a;YAEA,IAAIxC,CAAA,GAAIC,QAAA,CAAQ,CAAR,CAAR,C;YACA,IAAIC,QAAA,GAAWD,QAAA,CAAQ,CAAR,CAAf,C;YAMA,IAAI2I,CAAA,GAAI1I,QAAA,CAAS0I,CAAjB,C;YAMA,IAAIC,MAAA,GAASC,KAAA,CAAMjH,SAAN,CAAgBgH,MAA7B,C;YAMA,IAAIE,qBAAA,GAAwB,gBAA5B,C;YAEA,IAAIC,gBAAA,GAAmB;AAAA,oBAAC,OAAD;AAAA,oBAAU,aAAV;AAAA,oBAAyB,QAAzB;AAAA,iBAAvB,C;YAMA,IAAIvG,IAAA,GAAO,EAKVwG,eAAA,EAAiB,EALP,EAAX,C;YAQA,IAAIlE,WAAA,GAAc;AAAA,oBACjB,QADiB;AAAA,oBACP,aADO;AAAA,oBACQ,OADR;AAAA,oBACiB,QADjB;AAAA,oBAC2B,MAD3B;AAAA,oBACmC,QADnC;AAAA,oBAEjB,iBAFiB;AAAA,iBAAlB,C;YAKAtC,IAAA,CAAKyG,IAAL,GAAY,YAAW;AAAA,gBACtB,IAAIlD,IAAA,GAAO,IAAX,CADsB;AAAA,gBAEtB,KAAKmD,QAAL,GAAgB,IAAhB,CAFsB;AAAA,gBAItB,OAAO,YAAW;AAAA,oBACjBnD,IAAA,CAAKmD,QAAL,GAAgB,KAAhB,CADiB;AAAA,oBAEjBnD,IAAA,CAAKpE,OAAL,CAAa,SAAb,EAFiB;AAAA,iBAAlB,CAJsB;AAAA,aAAvB,C;YAUAa,IAAA,CAAKmE,SAAL,GAAiB,YAAW;AAAA,gBAC3B,OAAO,KAAKuC,QAAZ,CAD2B;AAAA,aAA5B,C;YAUA1G,IAAA,CAAKa,WAAL,GAAmB,UAAS7C,OAAT,EAAkB;AAAA,gBACpC,IAAIuF,IAAA,GAAO,IAAX,CADoC;AAAA,gBAGpCvF,OAAA,GAAUA,OAAA,IAAW,EAArB,CAHoC;AAAA,gBAMpC,KAAK2I,KAAL,GAAa,EAAb,CANoC;AAAA,gBAQpC,KAAK/H,IAAL,GAAY,KAAKA,IAAL,IAAa,EAAzB,CARoC;AAAA,gBAWpCrB,CAAA,CAAE2B,MAAF,CAAS,IAAT,EAAe3B,CAAA,CAAEuD,IAAF,CAAO9C,OAAP,EAAgBsE,WAAhB,CAAf,EAXoC;AAAA,gBAapC,KAAKtE,OAAL,GAAeA,OAAf,CAboC;AAAA,gBAepC,IAAI,KAAK4I,QAAL,IAAiB,CAACrJ,CAAA,CAAEmH,UAAF,CAAa,KAAKkC,QAAlB,CAAtB,EAAmD;AAAA,oBAClD,MAAM,IAAIhH,KAAJ,CAAU,6CAAV,CAAN,CADkD;AAAA,iBAff;AAAA,gBAmBpC,KAAKiH,eAAL,GAnBoC;AAAA,gBAoBpC,KAAKC,oBAAL,GApBoC;AAAA,gBAsBpC,KAAKJ,QAAL,GAAgB,KAAhB,CAtBoC;AAAA,gBAyBpCjJ,QAAA,CAASuC,IAAT,CAAcoB,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,EAzBoC;AAAA,gBA4BpC,IAAI,KAAK0F,WAAT,EAAsB;AAAA,oBACrBxJ,CAAA,CAAE,KAAKwJ,WAAP,EAAoB1B,IAApB,CAAyB,UAAS7F,UAAT,EAAqBwC,GAArB,EAA0B;AAAA,wBAClDuB,IAAA,CAAKyD,oBAAL,CAA0B,aAA1B,EAAyChF,GAAzC,EAA8CxC,UAA9C,EADkD;AAAA,qBAAnD,EADqB;AAAA,iBA5Bc;AAAA,gBAmCpC,IAAI,KAAKyH,MAAT,EAAiB;AAAA,oBAChB1J,CAAA,CAAE,KAAK0J,MAAP,EAAe5B,IAAf,CAAoB,UAAStH,KAAT,EAAgBiE,GAAhB,EAAqB;AAAA,wBACxCuB,IAAA,CAAKyD,oBAAL,CAA0B,QAA1B,EAAoChF,GAApC,EAAyCjE,KAAzC,EADwC;AAAA,qBAAzC,EADgB;AAAA,iBAnCmB;AAAA,aAArC,C;YA0CAiC,IAAA,CAAK4D,OAAL,GAAe,UAAShF,IAAT,EAAe;AAAA,gBAC7B,IAAIA,IAAJ;AAAA,oBAAU,KAAKA,IAAL,GAAYA,IAAZ,CADmB;AAAA,aAA9B,C;YAIAoB,IAAA,CAAKoD,WAAL,GAAmB,YAAW;AAAA,gBAC7B,OAAO,IAAP,CAD6B;AAAA,aAA9B,C;YAQApD,IAAA,CAAKgE,MAAL,GAAc,UAAShG,OAAT,EAAkB;AAAA,gBAC/B,IAAI,KAAKmG,SAAL,EAAJ;AAAA,oBAAsB,OAAO,IAAP,CADS;AAAA,gBAG/BnG,OAAA,GAAUA,OAAA,IAAW,EAArB,CAH+B;AAAA,gBAK/B,IACC,KAAK4I,QAAL,IACC,CAAA5I,OAAA,CAAQiH,KAAR,IAAiB,CAAC,KAAK9B,UAAL,EAAlB,IAAuC,CAAC,KAAKC,WAAL,EAAxC,CAFF,EAGE;AAAA,oBACD,KAAK8D,sBAAL,GADC;AAAA,oBAKD,KAAKC,oBAAL,GAA4B,IAA5B,CALC;AAAA,iBAR6B;AAAA,gBAiB/B,KAAKC,MAAL,GAjB+B;AAAA,gBAoB/B,KAAKrD,WAAL,CAAiB/F,OAAjB,EApB+B;AAAA,gBAuB/B,IAAI,KAAKqJ,GAAL,CAASxF,MAAT,GAAkBlD,MAAtB,EAA8B;AAAA,oBAC7B,KAAK2I,iBAAL,GAD6B;AAAA,iBAvBC;AAAA,gBA2B/B,OAAO,IAAP,CA3B+B;AAAA,aAAhC,C;YAkCAtH,IAAA,CAAKuH,eAAL,GAAuB,YAAW;AAAA,gBACjC,OAAO,KAAK3I,IAAZ,CADiC;AAAA,aAAlC,C;YAWAoB,IAAA,CAAKwH,cAAL,GAAsB,UAASZ,QAAT,EAAmBhI,IAAnB,EAAyB;AAAA,gBAC9CA,IAAA,GAAOrB,CAAA,CAAE,IAAF,EAAQ0G,KAAR,GAAgBzF,MAAhB,CAAuB,iBAAvB,EAA0CU,MAA1C,CAAiDN,IAAjD,EAAuDsF,KAAvD,EAAP,CAD8C;AAAA,gBAI9C,OAAO0C,QAAA,CAAShI,IAAT,CAAP,CAJ8C;AAAA,aAA/C,C;YAaAoB,IAAA,CAAKkH,sBAAL,GAA8B,YAAW;AAAA,gBACxC,IAAIO,YAAA,GAAe,KAAKF,eAAL,EAAnB,CADwC;AAAA,gBAExC,IAAIG,IAAA,GAAO,KAAKF,cAAL,CAAoB,KAAKZ,QAAzB,EAAmCa,YAAnC,CAAX,CAFwC;AAAA,gBAGxC,IAAIE,KAAA,GAAQxB,CAAA,CAAEuB,IAAF,CAAZ,CAHwC;AAAA,gBAKxC,IAAIC,KAAA,CAAMhJ,MAAN,GAAe,CAAnB,EAAsB;AAAA,iBALkB;AAAA,gBASxC,IAAIiJ,MAAA,GAASD,KAAA,CAAME,KAAN,EAAb,CATwC;AAAA,gBAYxC,IAAI,KAAKR,GAAL,CAASxF,MAAT,GAAkBlD,MAAtB,EAA8B;AAAA,oBAC7B,KAAK0I,GAAL,CAASS,WAAT,CAAqBF,MAArB,EAD6B;AAAA,iBAZU;AAAA,gBAgBxC,KAAKG,UAAL,CAAgBH,MAAhB,EAAwB,IAAxB,EAhBwC;AAAA,gBAkBxC,OAAO,IAAP,CAlBwC;AAAA,aAAzC,C;YA4BA5H,IAAA,CAAK+D,WAAL,GAAmB,UAAS/F,OAAT,EAAkB;AAAA,gBACpC,IAAIuF,IAAA,GAAO,IAAX,CADoC;AAAA,gBAIpChG,CAAA,CAAE,KAAKoJ,KAAP,EAActB,IAAd,CAAmB,UAAS2C,UAAT,EAAqBnE,SAArB,EAAgC;AAAA,oBAElD,IAAI,CAACmE,UAAA,CAAWrJ,MAAhB;AAAA,wBAAwB,OAF0B;AAAA,oBAKlDpB,CAAA,CAAEyK,UAAF,EAAc3C,IAAd,CAAmB,UAASnC,IAAT,EAAe;AAAA,wBACjCA,IAAA,CAAKc,MAAL,CAAYhG,OAAZ,EADiC;AAAA,qBAAlC,EALkD;AAAA,oBAUlD,IAAIiK,UAAA,GAAapE,SAAA,GAAYN,IAAA,CAAK4C,CAAL,CAAOtC,SAAP,EAAkBgE,KAAlB,EAAZ,GAAwCtE,IAAA,CAAK8D,GAA9D,CAVkD;AAAA,oBAYlD,IAAI,CAACY,UAAA,CAAWtJ,MAAhB,EAAwB;AAAA,wBACvB,MAAM,IAAIiB,KAAJ,CAAU,gBAAgBiE,SAAhB,GAA4B,gBAAtC,CAAN,CADuB;AAAA,qBAZ0B;AAAA,oBAgBlD,IAAItG,CAAA,CAAEyK,UAAF,EAAcE,IAAd,CAAmB,UAAShF,IAAT,EAAe;AAAA,4BACrC,OAAO,CAACA,IAAA,CAAKC,UAAL,EAAD,IAAsB,CAAC8E,UAAA,CAAWE,EAAX,CAAcjF,IAAA,CAAKmE,GAAL,CAASxF,MAAT,EAAd,CAA9B,CADqC;AAAA,yBAAlC,CAAJ,EAEI;AAAA,wBAEHoG,UAAA,CAAWG,MAAX,CAAkB7K,CAAA,CAAEyK,UAAF,EAAcK,KAAd,CAAoB,KAApB,CAAlB,EAFG;AAAA,qBAlB8C;AAAA,iBAAnD,EAJoC;AAAA,aAArC,C;YAsCArI,IAAA,CAAK8D,OAAL,GAAe9D,IAAA,CAAKsI,QAAL,GAAgB,UAAS3B,KAAT,EAAgB9C,SAAhB,EAA2B0E,KAA3B,EAAkC;AAAA,gBAChE,OAAO,KAAKC,YAAL,CAAkB,KAAlB,EAAyB7B,KAAzB,EAAgC9C,SAAhC,EAA2C0E,KAA3C,CAAP,CADgE;AAAA,aAAjE,C;YAQAvI,IAAA,CAAKyI,WAAL,GAAmBzI,IAAA,CAAK0I,YAAL,GAAoB,UAAS/B,KAAT,EAAgB9C,SAAhB,EAA2B0E,KAA3B,EAAkC;AAAA,gBACxE,OAAO,KAAKD,QAAL,CAAclH,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,CAAP,CADwE;AAAA,aAAzE,C;YAYArB,IAAA,CAAK2I,UAAL,GAAkB3I,IAAA,CAAK4I,WAAL,GAAmB,UAASjC,KAAT,EAAgB9C,SAAhB,EAA2B;AAAA,gBAC/D,OAAO,KAAKgF,WAAL,CAAiBlC,KAAjB,EAAwB9C,SAAxB,CAAP,CAD+D;AAAA,aAAhE,C;YAYA7D,IAAA,CAAK8I,WAAL,GAAmB9I,IAAA,CAAK+I,YAAL,GAAoB,UAASpC,KAAT,EAAgB9C,SAAhB,EAA2B;AAAA,gBACjE,OAAO,KAAKgF,WAAL,CAAiBlC,KAAjB,EAAwB9C,SAAxB,EAAmC,CAAnC,CAAP,CADiE;AAAA,aAAlE,C;YAaA7D,IAAA,CAAKgJ,UAAL,GAAkBhJ,IAAA,CAAK6I,WAAL,GAAmB,UAASlC,KAAT,EAAgB9C,SAAhB,EAA2B0E,KAA3B,EAAkC;AAAA,gBACtE,OAAO,KAAKC,YAAL,CAAkB,QAAlB,EAA4B7B,KAA5B,EAAmC9C,SAAnC,EAA8C0E,KAA9C,CAAP,CADsE;AAAA,aAAvE,C;YAcAvI,IAAA,CAAKuE,UAAL,GAAkBvE,IAAA,CAAKiJ,WAAL,GAAmB,UAAStC,KAAT,EAAgB9C,SAAhB,EAA2B0E,KAA3B,EAAkC;AAAA,gBACtE,IAAIlH,SAAA,CAAU1C,MAAV,GAAmB,CAAvB,EAA0B;AAAA,oBACzB,MAAM,IAAIiB,KAAJ,CAAU,gDAAV,CAAN,CADyB;AAAA,iBAD4C;AAAA,gBAKtE,IAAIrC,CAAA,CAAEmF,QAAF,CAAWiE,KAAX,CAAJ,EAAuB;AAAA,oBACtB4B,KAAA,GAAQ1E,SAAR,CADsB;AAAA,oBAEtBA,SAAA,GAAY8C,KAAZ,CAFsB;AAAA,oBAGtBA,KAAA,GAAQ,KAAKuC,OAAL,CAAarF,SAAb,EAAwB0E,KAAxB,CAAR,CAHsB;AAAA,oBAItB,IAAI,CAAC5B,KAAL;AAAA,wBAAY,OAAO,IAAP,CAJU;AAAA,iBAL+C;AAAA,gBAYtE,OAAO,KAAK6B,YAAL,CAAkB,QAAlB,EAA4B7B,KAA5B,EAAmC9C,SAAnC,CAAP,CAZsE;AAAA,aAAvE,C;YAsBA7D,IAAA,CAAKkJ,OAAL,GAAe,UAASrF,SAAT,EAAoB0E,KAApB,EAA2B;AAAA,gBACzC,OAAO,KAAKY,QAAL,CAActF,SAAd,EAAyB0E,KAAA,IAAS,CAAlC,KAAwC,IAA/C,CADyC;AAAA,aAA1C,C;YAUAvI,IAAA,CAAKmJ,QAAL,GAAgB,UAAStF,SAAT,EAAoB;AAAA,gBACnC,OAAOtG,CAAA,CAAEgC,KAAF,CAAQ,KAAKoH,KAAL,CAAW9C,SAAX,CAAR,KAAkC,EAAzC,CADmC;AAAA,aAApC,C;YAcA7D,IAAA,CAAKwI,YAAL,GAAoB,UAAS1K,MAAT,EAAiB6I,KAAjB,EAAwB9C,SAAxB,EAAmC0E,KAAnC,EAA0C;AAAA,gBAC7D,IAAIhF,IAAA,GAAO,IAAX,CAD6D;AAAA,gBAG7D,IAAI,CAACoD,KAAL,EAAY;AAAA,oBACX,MAAM,IAAI/G,KAAJ,CAAU,oCAAV,CAAN,CADW;AAAA,iBAHiD;AAAA,gBAO7D,IAAI,CAACrC,CAAA,CAAE6L,OAAF,CAAUzC,KAAV,CAAL;AAAA,oBAAuBA,KAAA,GAAQ,CAACA,KAAD,CAAR,CAPsC;AAAA,gBAS7D,IAAIqB,UAAA,GAAa,KAAKmB,QAAL,CAActF,SAAd,CAAjB,CAT6D;AAAA,gBAW7D,QAAQ/F,MAAR;AAAA,gBACC,KAAK,KAAL;AAAA,oBACC,IAAIkK,UAAA,CAAWrJ,MAAf,EAAuB;AAAA,wBACtB,IAAI0K,YAAA,GAAe,EAAnB,CADsB;AAAA,wBAItB,IAAI,OAAOd,KAAP,KAAiB,WAArB,EAAkC;AAAA,4BAGjCc,YAAA,GAAe,KAAKH,OAAL,CAAarF,SAAb,EAAwB0E,KAAxB,CAAf,CAHiC;AAAA,4BAIjCc,YAAA,GAAeA,YAAA,GAAe,CAACA,YAAD,CAAf,GAAgC,EAA/C,CAJiC;AAAA,yBAAlC,MAKO;AAAA,4BAENA,YAAA,GAAerB,UAAf,CAFM;AAAA,yBATe;AAAA,wBActB,IAAIqB,YAAA,CAAa1K,MAAjB,EAAyB;AAAA,4BAGxB,KAAK6J,YAAL,CAAkB,QAAlB,EAA4Ba,YAA5B,EAA0CxF,SAA1C,EAHwB;AAAA,4BAMxBtG,CAAA,CAAE8L,YAAF,EAAgBhE,IAAhB,CAAqB,UAASnC,IAAT,EAAe;AAAA,gCACnCA,IAAA,CAAKoG,MAAL,GADmC;AAAA,6BAApC,EANwB;AAAA,yBAdH;AAAA,qBADxB;AAAA,oBA4BC,KAAKd,YAAL,CAAkB,QAAlB,EAA4B7B,KAA5B,EAAmC9C,SAAnC,EAA8C0E,KAA9C,EA5BD;AAAA,oBA8BC,MA/BF;AAAA,gBAiCC,KAAK,QAAL;AAAA,oBACChL,CAAA,CAAEoJ,KAAF,EAAStB,IAAT,CAAc,UAASnC,IAAT,EAAe;AAAA,wBAC5B,IAAIA,IAAA,CAAKrB,MAAT,EAAiB;AAAA,4BAChBqB,IAAA,CAAKrB,MAAL,CAAY0C,UAAZ,CAAuBrB,IAAvB,EAA6BA,IAAA,CAAKW,SAAlC,EADgB;AAAA,yBADW;AAAA,qBAA7B,EADD;AAAA,oBAOC,IAAImE,UAAA,CAAWrJ,MAAf,EAAuB;AAAA,wBAEtB,IAAI,OAAO4J,KAAP,KAAiB,WAArB,EAAkC;AAAA,4BACjCA,KAAA,GAAQP,UAAA,CAAWrJ,MAAnB,CADiC;AAAA,yBAFZ;AAAA,wBAOtByH,MAAA,CAAOhF,KAAP,CAAa,KAAKuF,KAAL,CAAW9C,SAAX,CAAb,EAAoC;AAAA,4BAAC0E,KAAD;AAAA,4BAAQ,CAAR;AAAA,0BAAWgB,MAAX,CAAkB5C,KAAlB,CAApC,EAPsB;AAAA,qBAAvB,MAQO;AAAA,wBAEN,KAAKA,KAAL,CAAW9C,SAAX,IAAwB8C,KAAxB,CAFM;AAAA,qBAfR;AAAA,oBAqBCpJ,CAAA,CAAEoJ,KAAF,EAAStB,IAAT,CAAc,UAASnC,IAAT,EAAe;AAAA,wBAC5BA,IAAA,CAAKrB,MAAL,GAAc0B,IAAd,CAD4B;AAAA,wBAE5BL,IAAA,CAAKW,SAAL,GAAiBA,SAAjB,CAF4B;AAAA,qBAA7B,EArBD;AAAA,oBA0BC,KAAKmD,oBAAL,CAA0B,OAA1B,EAAmCnD,SAAnC,EAA8C8C,KAA9C,EA1BD;AAAA,oBA4BC,MA7DF;AAAA,gBA+DC,KAAK,QAAL;AAAA,oBACC,IAAI,CAACqB,UAAA,CAAWrJ,MAAhB;AAAA,wBAAwB,MADzB;AAAA,oBAGC,IAAI6K,QAAA,GAAWjM,CAAA,CAAE0G,KAAF,CAAQ0C,KAAR,EAAe8C,IAAf,GAAsBC,GAAtB,CAA0B,UAASxG,IAAT,EAAe;AAAA,4BACtD,OAAO;AAAA,gCACNA,IAAA,EAAMA,IADA;AAAA,gCAENqF,KAAA,EAAOhL,CAAA,CAAEwH,OAAF,CAAUiD,UAAV,EAAsB9E,IAAtB,CAFD;AAAA,6BAAP,CADsD;AAAA,yBAAzC,EAKXyG,MALW,CAKJ,UAASC,OAAT,EAAkB;AAAA,4BAC3B,OAAOA,OAAA,CAAQrB,KAAR,IAAiB,CAAxB,CAD2B;AAAA,yBALd,EAOXsB,MAPW,CAOJ,UAASD,OAAT,EAAkB;AAAA,4BAC3B,OAAO,CAACA,OAAA,CAAQrB,KAAhB,CAD2B;AAAA,yBAPd,EASXrE,KATW,EAAf,CAHD;AAAA,oBAcC,IAAI,CAACsF,QAAA,CAAS7K,MAAd;AAAA,wBAAsB,MAdvB;AAAA,oBAgBCpB,CAAA,CAAEiM,QAAF,EAAYnE,IAAZ,CAAiB,UAASuE,OAAT,EAAkB;AAAA,wBAClC,IAAI1G,IAAA,GAAO0G,OAAA,CAAQ1G,IAAnB,CADkC;AAAA,wBAIlCkD,MAAA,CAAO/G,IAAP,CAAYkE,IAAA,CAAKoD,KAAL,CAAW9C,SAAX,CAAZ,EAAmC+F,OAAA,CAAQrB,KAA3C,EAAkD,CAAlD,EAJkC;AAAA,wBAOlChF,IAAA,CAAKuG,sBAAL,CAA4B5G,IAA5B,EAPkC;AAAA,wBAUlC,OAAOA,IAAA,CAAKrB,MAAZ,CAVkC;AAAA,qBAAnC,EA/EF;AAAA,iBAX6D;AAAA,gBAwG7D,OAAO,IAAP,CAxG6D;AAAA,aAA9D,C;YA+GA7B,IAAA,CAAK+J,cAAL,GAAsB,UAASC,MAAT,EAAiB;AAAA,gBACtCA,MAAA,GAASA,MAAA,IAAUzM,CAAA,CAAEiB,MAAF,CAAS,IAAT,EAAe,QAAf,CAAnB,CADsC;AAAA,gBAEtC,IAAI,CAACwL,MAAL;AAAA,oBAAa,OAAO,IAAP,CAFyB;AAAA,gBAGtCA,MAAA,GAASzM,CAAA,CAAEyM,MAAF,EAAU7E,IAAV,CAAeoB,gBAAf,CAAT,CAHsC;AAAA,gBAItC,OAAO9I,QAAA,CAASuC,IAAT,CAAcZ,SAAd,CAAwB2K,cAAxB,CAAuC1K,IAAvC,CAA4C,IAA5C,EAAkD2K,MAAlD,CAAP,CAJsC;AAAA,aAAvC,C;YAOAhK,IAAA,CAAKgH,oBAAL,GAA4B,UAAS7I,IAAT,EAAe6D,GAAf,EAAoBiI,QAApB,EAA8B;AAAA,gBACzD,IAAI1G,IAAA,GAAO,IAAX,CADyD;AAAA,gBAEzD,IAAI,CAAChG,CAAA,CAAE6L,OAAF,CAAUa,QAAV,CAAL;AAAA,oBAA0BA,QAAA,GAAW,CAACA,QAAD,CAAX,CAF+B;AAAA,gBAGzD,IAAIC,SAAA,GAAY,KAAKC,iBAAL,CAAuBhM,IAAvB,EAA6B6D,GAA7B,CAAhB,CAHyD;AAAA,gBAIzD,IAAIkI,SAAJ,EAAe;AAAA,oBACd3M,CAAA,CAAE2M,SAAF,EAAa7E,IAAb,CAAkB,UAAS+E,QAAT,EAAmB;AAAA,wBACpC7M,CAAA,CAAE0M,QAAF,EAAY5E,IAAZ,CAAiB,UAASgF,MAAT,EAAiB;AAAA,4BACjC9G,IAAA,CAAK+G,QAAL,CAAcD,MAAd,EAAsBD,QAAA,CAASG,SAA/B,EAA0CH,QAAA,CAASI,OAAnD,EADiC;AAAA,yBAAlC,EADoC;AAAA,qBAArC,EADc;AAAA,iBAJ0C;AAAA,gBAWzD,OAAO,IAAP,CAXyD;AAAA,aAA1D,C;YAcAxK,IAAA,CAAK8J,sBAAL,GAA8B,UAASG,QAAT,EAAmB;AAAA,gBAChD,IAAI1G,IAAA,GAAO,IAAX,CADgD;AAAA,gBAEhD,IAAI,CAAChG,CAAA,CAAE6L,OAAF,CAAUa,QAAV,CAAL;AAAA,oBAA0BA,QAAA,GAAW,CAACA,QAAD,CAAX,CAFsB;AAAA,gBAGhD1M,CAAA,CAAE0M,QAAF,EAAY5E,IAAZ,CAAiB,UAASgF,MAAT,EAAiB;AAAA,oBACjC9G,IAAA,CAAKkH,aAAL,CAAmBJ,MAAnB,EADiC;AAAA,iBAAlC,EAHgD;AAAA,gBAMhD,OAAO,IAAP,CANgD;AAAA,aAAjD,C;YASArK,IAAA,CAAK8G,oBAAL,GAA4B,UAASkD,MAAT,EAAiB;AAAA,gBAC5C,IAAIzG,IAAA,GAAO,IAAX,CAD4C;AAAA,gBAI5C,KAAK4G,iBAAL,GAAyB,EAAzB,CAJ4C;AAAA,gBAK5C5M,CAAA,CAAEgJ,gBAAF,EAAoBlB,IAApB,CAAyB,UAASlH,IAAT,EAAe;AAAA,oBACvCoF,IAAA,CAAK4G,iBAAL,CAAuBhM,IAAvB,IAA+B,EAA/B,CADuC;AAAA,iBAAxC,EAL4C;AAAA,gBAS5C6L,MAAA,GAASA,MAAA,IAAUzM,CAAA,CAAEiB,MAAF,CAAS,IAAT,EAAe,QAAf,CAAnB,CAT4C;AAAA,gBAU5C,IAAI,CAACwL,MAAL;AAAA,oBAAa,OAV+B;AAAA,gBAa5CzM,CAAA,CAAEgJ,gBAAF,EAAoBlB,IAApB,CAAyB,UAASlH,IAAT,EAAe;AAAA,oBACvC,IAAIuM,cAAA,GAAiBnH,IAAA,CAAK4G,iBAAL,CAAuBhM,IAAvB,CAArB,CADuC;AAAA,oBAGvC,IAAI,CAACZ,CAAA,CAAEyM,MAAF,EAAU/H,GAAV,CAAc9D,IAAd,CAAD,IAAwB,CAACZ,CAAA,CAAEsB,QAAF,CAAWmL,MAAA,CAAO7L,IAAP,CAAX,CAA7B;AAAA,wBAAuD,OAHhB;AAAA,oBAKvCZ,CAAA,CAAEyM,MAAA,CAAO7L,IAAP,CAAF,EAAgBkH,IAAhB,CAAqB,UAASvH,MAAT,EAAiBkE,GAAjB,EAAsB;AAAA,wBAC1C,IAAI,CAACzE,CAAA,CAAEmH,UAAF,CAAa5G,MAAb,CAAL;AAAA,4BAA2BA,MAAA,GAASyF,IAAA,CAAKzF,MAAL,CAAT,CADe;AAAA,wBAE1C,IAAI,CAACA,MAAL;AAAA,4BAAa,OAF6B;AAAA,wBAG1C,IAAI6M,KAAA,GAAQ3I,GAAA,CAAI2I,KAAJ,CAAUrE,qBAAV,CAAZ,CAH0C;AAAA,wBAI1C,IAAIiE,SAAA,GAAYI,KAAA,CAAM,CAAN,CAAhB,CAJ0C;AAAA,wBAK1C,IAAIC,UAAA,GAAaD,KAAA,CAAM,CAAN,EAASzF,OAAT,CAAiB,QAAjB,EAA2B,GAA3B,EAAgCW,KAAhC,CAAsC,GAAtC,CAAjB,CAL0C;AAAA,wBAM1C/H,MAAA,GAASP,CAAA,CAAEsN,IAAF,CAAO/M,MAAP,EAAeyF,IAAf,CAAT,CAN0C;AAAA,wBAS1ChG,CAAA,CAAEqN,UAAF,EAAcvF,IAAd,CAAmB,UAASyF,SAAT,EAAoB;AAAA,4BACtCJ,cAAA,CAAeI,SAAf,IAA4BJ,cAAA,CAAeI,SAAf,KAA6B,EAAzD,CADsC;AAAA,4BAEtCJ,cAAA,CAAeI,SAAf,EAA0BC,IAA1B,CAA+B;AAAA,gCAC9BR,SAAA,EAAWA,SADmB;AAAA,gCAE9BC,OAAA,EAAS1M,MAFqB;AAAA,6BAA/B,EAFsC;AAAA,yBAAvC,EAT0C;AAAA,qBAA3C,EALuC;AAAA,iBAAxC,EAb4C;AAAA,aAA7C,C;YA0CAkC,IAAA,CAAK6G,eAAL,GAAuB,YAAW;AAAA,gBACjC,IAAItD,IAAA,GAAO,IAAX,CADiC;AAAA,gBAGjChG,CAAA,CAAE,KAAKoJ,KAAP,EAActB,IAAd,CAAmB,UAASsB,KAAT,EAAgB9C,SAAhB,EAA2B;AAAA,oBAC7C,IAAI,CAACtG,CAAA,CAAE6L,OAAF,CAAUzC,KAAV,CAAL,EAAuB;AAAA,wBACtBpD,IAAA,CAAKoD,KAAL,CAAW9C,SAAX,IAAwB,CAAC8C,KAAD,CAAxB,CADsB;AAAA,qBADsB;AAAA,iBAA9C,EAHiC;AAAA,aAAlC,C;YAcA3G,IAAA,CAAKmD,UAAL,GAAkB,YAAW;AAAA,gBAC5B,IAAID,IAAA,GAAO,KAAKmE,GAAL,CAASzI,IAAT,CAAc,cAAd,CAAX,CAD4B;AAAA,gBAE5B,OAAOoM,OAAA,CAAQ9H,IAAA,IAAQA,IAAA,KAAS,IAAzB,CAAP,CAF4B;AAAA,aAA7B,C;YAKAlD,IAAA,CAAKsH,iBAAL,GAAyB,YAAW;AAAA,gBAEnC/J,CAAA,CAAE,KAAKoJ,KAAP,EAActB,IAAd,CAAmB,UAAS2C,UAAT,EAAqB;AAAA,oBAEvC,IAAI,CAACA,UAAA,CAAWrJ,MAAhB;AAAA,wBAAwB,OAFe;AAAA,oBAKvCpB,CAAA,CAAEyK,UAAF,EAAc3C,IAAd,CAAmB,UAASnC,IAAT,EAAe;AAAA,wBACjCA,IAAA,CAAKoE,iBAAL,GADiC;AAAA,qBAAlC,EALuC;AAAA,iBAAxC,EAFmC;AAAA,gBAanC,IAAI,KAAKH,oBAAT,EAA+B;AAAA,oBAE9B,OAAO,KAAKA,oBAAZ,CAF8B;AAAA,oBAK9B,KAAK8D,WAAL,GAL8B;AAAA,iBAbI;AAAA,aAApC,C;YA4BAjL,IAAA,CAAKiL,WAAL,GAAmB,YAAW;AAAA,gBAC7B,OAAO,IAAP,CAD6B;AAAA,aAA9B,C;YAQAjL,IAAA,CAAKoH,MAAL,GAAc,YAAW;AAAA,gBAExB,IAAI,KAAKjE,UAAL,EAAJ;AAAA,oBAAuB,OAAO,IAAP,CAFC;AAAA,gBAKxB,IAAI+H,YAAA,GAAe,KAAK7D,GAAL,CAASzI,IAAT,CAAc,cAAd,CAAnB,CALwB;AAAA,gBAMxB,IAAIsM,YAAJ;AAAA,oBAAkBA,YAAA,CAAaC,MAAb,GANM;AAAA,gBASxB,KAAK9D,GAAL,CAASzI,IAAT,CAAc,cAAd,EAA8B,IAA9B,EAAoCwM,IAApC,CAAyC,cAAzC,EAAyD,KAAKC,GAA9D,EATwB;AAAA,gBAWxB,OAAO,IAAP,CAXwB;AAAA,aAAzB,C;YAcArL,IAAA,CAAKsL,YAAL,GAAoB,YAAW;AAAA,gBAE9B/N,CAAA,CAAE,KAAKoJ,KAAP,EAActB,IAAd,CAAmB,UAAS2C,UAAT,EAAqB;AAAA,oBAEvC,IAAI,CAACA,UAAA,CAAWrJ,MAAhB;AAAA,wBAAwB,OAFe;AAAA,oBAKvCpB,CAAA,CAAEyK,UAAF,EAAc3C,IAAd,CAAmB,UAASnC,IAAT,EAAe;AAAA,wBACjCA,IAAA,CAAKiI,MAAL,GADiC;AAAA,qBAAlC,EALuC;AAAA,iBAAxC,EAF8B;AAAA,aAA/B,C;YAmBAnL,IAAA,CAAKuL,YAAL,GAAoB,YAAW;AAAA,gBAC9B,OAAO,IAAP,CAD8B;AAAA,aAA/B,C;YAQAvL,IAAA,CAAKmL,MAAL,GAAc,YAAW;AAAA,gBAExB,IAAI,CAAC,KAAKhI,UAAL,EAAL;AAAA,oBAAwB,OAAO,IAAP,CAFA;AAAA,gBAKxB,KAAKmI,YAAL,GALwB;AAAA,gBAQxB,KAAKC,YAAL,GARwB;AAAA,gBAWxB,KAAKlE,GAAL,CAASmE,UAAT,CAAoB,cAApB,EAAoCC,UAApC,CAA+C,cAA/C,EAXwB;AAAA,gBAcxB,KAAKC,gBAAL,GAdwB;AAAA,gBAexB,KAAKjB,aAAL,GAfwB;AAAA,gBAiBxB,OAAO,IAAP,CAjBwB;AAAA,aAAzB,C;YAoBAzK,IAAA,CAAKsJ,MAAL,GAAc,YAAW;AAAA,gBACxB,IAAI,KAAKzH,MAAT,EAAiB;AAAA,oBAChB,KAAKA,MAAL,CAAY0C,UAAZ,CAAuB,IAAvB,EAA6B,KAAKV,SAAlC,EADgB;AAAA,iBADO;AAAA,gBAIxB,KAAKsH,MAAL,GAJwB;AAAA,gBAKxB,KAAKQ,cAAL,GALwB;AAAA,gBAMxB,OAAO,IAAP,CANwB;AAAA,aAAzB,C;YAeA3L,IAAA,CAAK4L,cAAL,GAAsB,UAASC,QAAT,EAAmB;AAAA,gBACxC,IAAIC,SAAA,GAAY3F,CAAA,CAAE0F,QAAF,CAAhB,CADwC;AAAA,gBAGxC,IAAI,CAACC,SAAA,CAAU3D,EAAV,CAAa,gBAAb,CAAL,EAAqC;AAAA,oBACpC2D,SAAA,GAAYA,SAAA,CAAUC,OAAV,CAAkB,gBAAlB,CAAZ,CADoC;AAAA,iBAHG;AAAA,gBAOxC,OAAOD,SAAA,CAAUnN,MAAV,GAAmBmN,SAAA,CAAUlN,IAAV,CAAe,cAAf,CAAnB,GAAoD,IAA3D,CAPwC;AAAA,aAAzC,C;YAUAiB,MAAA,CAAOC,OAAP,GAAiBrC,QAAA,CAASuC,IAAT,CAAcd,MAAd,CAAqBc,IAArB,CAAjB,C","file":"esencia.js","sourceRoot":".","sourcesContent":["'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\n\nvar Collection = {};\n\n// base methods map\nvar baseMethods = ['create', 'update', 'patch', 'delete', 'read'];\n\nvar execMethodType = 'PUT';\n\n/*\n * Override `sync` to add exec custom method functionality\n */\n\nCollection.sync = function(method, model, options) {\n\t// if sync is called for custom exec method\n\tif (!_.contains(baseMethods, method)) {\n\t\toptions = options || {};\n\n\t\tvar params = {\n\t\t\ttype: execMethodType,\n\t\t\tdataType: 'json',\n\t\t\tcontentType: 'application/json',\n\t\t\tprocessData: false\n\t\t};\n\n\t\t// Ensure that we have a URL and add method name to it\n\t\tif (!options.url) {\n\t\t\tvar url = _.result(model, 'url') || urlError();\n\t\t\tparams.url = url + (url.charAt(url.length - 1) === '/' ? '' : '/') + method;\n\t\t}\n\n\t\t// stringify data to json\n\t\tif (options.data && _.isObject(options.data)) {\n\t\t\toptions.data = JSON.stringify(options.data);\n\t\t}\n\n\t\t// Make the request, allowing the user to override any Ajax options.\n\t\tvar xhr = options.xhr = backbone.ajax(_.extend(params, options));\n\t\tmodel.trigger('request', model, xhr, options);\n\t\treturn xhr;\n\t} else {\n\t\t// call default backbone.Collection sync for base REST methods\n\t\treturn backbone.Collection.prototype.sync.call(this, method, model, options);\n\t}\n};\n\n/*\n * Exec custom non-REST method on collection\n * It trigger `exec:[method]` event after success collection sync\n *\n * @param {String} method\n * @param {Object} options\n */\n\nCollection.exec = function(method, options) {\n\toptions = options ? _.clone(options) : {};\n\n\tvar collection = this;\n\tvar success = options.success;\n\toptions.success = function(resp) {\n\t\tif (success) success(collection, resp, options);\n\t\tcollection.trigger('exec:' + method, collection, resp, options);\n\t};\n\n\tvar error = options.error;\n\toptions.error = function(resp) {\n\t\tif (error) error(collection, resp, options);\n\t\tcollection.trigger('error', collection, resp, options);\n\t};\n\n\treturn this.sync(method, this, options);\n};\n\n// Throw an error when a URL is needed, and none is supplied.\nvar urlError = function() {\n\tthrow new Error('A \"url\" property or function must be specified');\n};\n\nmodule.exports = backbone.Collection.extend(Collection);\n","'use strict';\n\nvar Router = require('./router');\nvar Collection = require('./collection');\nvar View = require('./view');\n\nmodule.exports.Router = Router;\nmodule.exports.Collection = Collection;\nmodule.exports.View = View;\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar View = require('./view');\n\n/**\n * Router extends default backbone Router\n */\n\nvar Router = {\n\troot: '/',\n\trootViewEl: 'html',\n\tmodulesPath: 'modules/',\n\tdefaultModuleName: 'main',\n\tpushState: false,\n\tnamedParameters: false,\n\tautoloadModules: true,\n\tdebug: false,\n\tconfig: {},\n\tonModuleError: function() {},\n\tnowhereUrl: '___'\n};\n\nvar routerOptions = [\n\t'root', 'rootViewEl', 'modulesPath', 'defaultModuleName', 'pushState',\n\t'namedParameters', 'autoloadModules', 'debug', 'config', 'onModuleError',\n\t'nowhereUrl'\n];\n\n/*\n * Override `constructor`\n * @param {Object} [options]\n */\n\nRouter.constructor = function(options) {\n\toptions = options || {};\n\n\t// populate Router instance with fields from options\n\t_.extend(this, _.pick(options, routerOptions));\n\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\tthis.components = {};\n\tthis.componentsTree = null;\n\tthis.urlParams = {};\n\tthis.modules = {};\n\n\tthis.history = backbone.history;\n\n\t/*\n\t * All query parameters can be passed in a single hash using the key\n\t * referenced from the route definition (backbone queryparams will\n\t * do it for us)\n\t */\n\n\tbackbone.Router.namedParameters = this.namedParameters;\n\n\tbackbone.Router.apply(this, arguments);\n\n\tif (options.autoloadModules) {\n\t\tthis.route('*url', function(params) {\n\t\t\tthis.setModule(params);\n\t\t});\n\t}\n};\n\nRouter._initRootComponent = function() {\n\tvar RootView = View.extend({\n\t\tel: this.rootViewEl\n\t});\n\n\tthis.component({\n\t\tname: '',\n\t\tparent: null,\n\t\tView: RootView\n\t});\n};\n\nRouter._populateUrlParams = function(componentName, params) {\n\tvar urlParams = this.urlParams;\n\n\t// clean old values from urlParams object\n\tvar key;\n\tfor (key in urlParams) {\n\t\tif (_(urlParams).has(key)) {\n\t\t\tdelete urlParams[key];\n\t\t}\n\t}\n\n\tvar component = this.components[componentName];\n\n\t// populate urlParams with new params\n\treturn _(urlParams).extend(\n\t\t_(component).result('defaultUrlParams'),\n\t\tparams\n\t);\n};\n\n/*\n * Add component to router and bind it to url\n *\n * @param {Object} component\n */\n\n var componentOptions = [\n\t'url', 'name', 'parent', 'container', 'View', 'models', 'collections',\n\t'viewOptions', 'defaultUrlParams'\n];\n\nRouter.component = function(options) {\n\tvar router = this;\n\n\toptions = _({}).defaults(options, {\n\t\tparent: '',\n\t\tdefaultUrlParams: {},\n\t\tviewOptions: {},\n\t\tprocess: false\n\t});\n\n\tvar component = _(options).pick(componentOptions);\n\n\t// generate uniq component name if name is omitted\n\tif (_.isUndefined(component.name)) {\n\t\tcomponent.name = _.uniqueId('auto-named-component');\n\t}\n\n\tif (!_.isString(component.name)) {\n\t\tthrow new Error('Component `name` option should be a string');\n\t}\n\n\tif (component.name in this.components) {\n\t\tthrow new Error('Duplicate component with name \"' + component.name + '\"');\n\t}\n\n\tif (!component.View) {\n\t\tthrow new Error('Component `View` option is required');\n\t}\n\n\tif (!_.isString(component.parent) && !_.isNull(component.parent)) {\n\t\tthrow new Error('Component `parent` option should be a string or null');\n\t}\n\n\tthis.components[component.name] = component;\n\n\t// bind component to route\n\tif (!_.isUndefined(component.url)) {\n\t\tthis.route(component.url, component.name, function(params) {\n\t\t\trouter._populateUrlParams(component.name, params);\n\n\t\t\t// process components tree\n\t\t\trouter._processComponent(component.name);\n\t\t});\n\t}\n\n\t// process components tree in force mode\n\tif (options.process) {\n\t\tthis._processComponent(component.name);\n\t}\n\n\treturn this;\n};\n\nRouter._calculateComponentsTree = function(componentName, child) {\n\tvar component = this.components[componentName];\n\n\tif (!component) {\n\t\tthrow new Error('Unknown component with name \"' + componentName + '\"');\n\t}\n\n\tvar node = {name: componentName};\n\tif (child) {\n\t\tnode.child = child;\n\t}\n\n\tif (_.isString(component.parent)) {\n\t\treturn this._calculateComponentsTree(component.parent, node);\n\t} else {\n\t\treturn node;\n\t}\n};\n\nRouter._isComponentTreeNodeChanged = function(oldNode, node) {\n\tif (!oldNode || oldNode.name !== node.name || !oldNode.view) return true;\n\tvar component = this.components[node.name];\n\tif (oldNode.view instanceof component.View === false) return true;\n\tif (!oldNode.view.isAttached()) return true;\n\treturn !oldNode.view.isUnchanged();\n};\n\nRouter._applyComponentsTree = function(params, callback) {\n\tvar self = this;\n\n\tvar parentNode = params.parentNode;\n\n\tvar iterateNode = function(oldNode, node) {\n\t\t// omit child field in new node because it will set recursive\n\t\t// and should not exist if error case\n\t\tvar childNode = node.child;\n\t\tdelete node.child;\n\n\t\tif (parentNode) {\n\t\t\tparentNode.child = node;\n\t\t} else {\n\t\t\tself.componentsTree = node;\n\t\t}\n\n\t\tif (childNode) {\n\t\t\tself._applyComponentsTree({\n\t\t\t\tparentNode: node,\n\t\t\t\toldNode: oldNode && oldNode.child || null,\n\t\t\t\tnode: childNode\n\t\t\t}, callback);\n\t\t} else {\n\t\t\tcallback();\n\t\t}\n\t};\n\n\tvar node = params.node;\n\tvar oldNode = params.oldNode;\n\tvar component = this.components[node.name];\n\n\tvar onViewResolve = function(view) {\n\t\tnode.view = view;\n\t\tview.setData();\n\n\t\tif (component.container) {\n\t\t\tif (!parentNode) {\n\t\t\t\tthrow new Error('Parent component should exist for component with ' +\n\t\t\t\t\t'`container` option');\n\t\t\t}\n\n\t\t\tparentNode.view.setView(view, component.container);\n\t\t\tparentNode.view.renderViews();\n\t\t} else {\n\t\t\tview.render();\n\t\t}\n\n\t\t// stop processing old components tree\n\t\titerateNode(null, node);\n\t};\n\n\tvar view;\n\tif (this._isComponentTreeNodeChanged(oldNode, node)) {\n\t\t// @TODO: we need to clean previous view container here, because new view\n\t\t// may not replace it\n\n\t\t// create new view\n\t\tview = new (component.View)(\n\t\t\t_(component)\n\t\t\t\t.chain()\n\t\t\t\t.pick('models', 'collections')\n\t\t\t\t.defaults(_(component).result('viewOptions'))\n\t\t\t\t.extend({router: this})\n\t\t\t\t.value()\n\t\t);\n\n\t\tif (view.isWaiting()) {\n\t\t\t// wait when view will be resolved\n\t\t\tview.once('resolve', function() {\n\t\t\t\tonViewResolve(view);\n\t\t\t});\n\t\t} else {\n\t\t\tonViewResolve(view);\n\t\t}\n\t} else {\n\t\t// get view from old node because it is not changed\n\t\tview = oldNode.view;\n\n\t\tvar oldChildNode = oldNode.child;\n\n\t\t// temporary remove child node view\n\t\tvar oldChildNodeContainer;\n\t\tif (oldChildNode && oldChildNode.view) {\n\t\t\toldChildNodeContainer = oldChildNode.view.container;\n\t\t\tview.removeView(oldChildNode.view, oldChildNodeContainer);\n\t\t}\n\n\t\tnode.view = view;\n\t\tview.setData();\n\t\tview.render();\n\n\t\t// revert child node view\n\t\tif (oldChildNode && oldChildNode.view) {\n\t\t\tview.setView(oldChildNode.view, oldChildNodeContainer);\n\t\t}\n\n\t\t// proprocessing old components tree\n\t\titerateNode(oldNode, node);\n\t}\n};\n\nRouter._processComponent = function(componentName, callback) {\n\tcallback = callback || _.noop;\n\n\tvar newComponentsTree = this._calculateComponentsTree(componentName);\n\n\tthis._applyComponentsTree({\n\t\tparentNode: null,\n\t\toldNode: this.componentsTree,\n\t\tnode: newComponentsTree\n\t}, callback);\n};\n\n/*\n * Override `route` to add middleware processing functionality\n */\n\nRouter.route = function(url, name, callback) {\n\tvar router = this;\n\n\tif (_.isFunction(name)) {\n\t\tcallback = name;\n\t\tname = '';\n\t}\n\n\tbackbone.Router.prototype.route.call(this, url, name, function() {\n\t\tvar args = arguments;\n\n\t\trouter._defaultMiddleware({\n\t\t\turl: url,\n\t\t\tname: name,\n\t\t\tcallback: callback\n\t\t}, function() {\n\t\t\tcallback.apply(router, args);\n\t\t});\n\t});\n};\n\n/*\n * Override `navigate`\n * @param {String} fragment\n * @param {Object} [options] - hash of params\n * @param {Object} [options.qs] - query string hash\n */\n\nRouter.navigate = function(fragment, options) {\n\toptions = options || {};\n\n\tif (fragment.indexOf(this.root) === 0) {\n\t\tfragment = fragment.substring(this.root.length);\n\t}\n\n\t// force to go to the selected fragment even if we currently on it\n\t// @TODO: block nowhere url via `execute` after upgrade backbone (1.1.1)\n\tif (options.force) {\n\t\tthis.navigate(this.nowhereUrl, {\n\t\t\treplace: options.replace,\n\t\t\ttrigger: false\n\t\t});\n\n\t\toptions = _(options).chain().omit('force').extend({replace: true}).value();\n\n\t\treturn this.navigate(fragment, options);\n\t}\n\n\t// set `trigger` to true by default\n\toptions = _(options || {}).defaults({\n\t\ttrigger: true,\n\t\tparams: {}\n\t});\n\n\t// add support of query string using `toFragment` from backbone.queryparams\n\tvar qs = options.qs;\n\n\tif (qs) {\n\t\t// reject undefined and null qs parameters\n\t\t_(qs).each(function(val, key, qs) {\n\t\t\tif (val === undefined || val === null) delete qs[key];\n\t\t});\n\t\t// qs = _(qs).chain().omit(_.isNull).omit(_.isUndefined).value();\n\n\t\tfragment = this.toFragment(fragment, qs);\n\n\t\tdelete options.qs;\n\t}\n\n\tbackbone.Router.prototype.navigate.call(this, fragment, options);\n};\n\n\n/*\n * Default middleware function\n */\n\nRouter._defaultMiddleware = function(route, next) {\n\tnext();\n};\n\n/**\n * Use passed function as `middleware`\n *\n * @param {Function} middleware - middleware function,\n * `route` and `next` will be passed as arguments.\n * context (`this`) is link to the router object.\n */\n\nRouter.middleware = function(middleware) {\n\tvar router = this;\n\n\tvar defaultMiddleware = this._defaultMiddleware;\n\n\tthis._defaultMiddleware = function(route, next) {\n\t\tdefaultMiddleware.call(router, route, function() {\n\t\t\tmiddleware.call(router, route, next);\n\t\t});\n\t};\n\n\treturn this;\n};\n\n/*\n * Require module file and init it\n * @param {String} params.url Url without query string\n */\n\nRouter.setModule = function(params) {\n\tvar router = this;\n\n\tvar url = params.url;\n\tdelete params.url;\n\n\tvar moduleName = _(url.split('/')).find(_.identity) || this.defaultModuleName;\n\n\t// require module file\n\trequire([this.modulesPath + moduleName], function(moduleInit) {\n\t\t// if module is loaded first time\n\t\tif (!router.modules[moduleName]) {\n\t\t\t// init it\n\t\t\tmoduleInit(router);\n\n\t\t\t// set module init flag to true\n\t\t\trouter.modules[moduleName] = true;\n\n\t\t\t// and navigate again with force flag\n\t\t\trouter.navigate(url, {\n\t\t\t\treplace: true,\n\t\t\t\tforce: true,\n\t\t\t\tqs: params\n\t\t\t});\n\t\t}\n\t}, this.onModuleError);\n};\n\n/*\n * Start routes handling\n */\n\nRouter.start = function() {\n\tthis._initRootComponent();\n\n\tbackbone.history.start({\n\t\tpushState: this.pushState,\n\t\troot: this.root\n\t});\n};\n\nmodule.exports = backbone.Router.extend(Router);\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\n\n/*\n * Take jquery or other selectors lib from backbone\n */\n\nvar $ = backbone.$;\n\n/*\n * Helpers\n */\n\nvar splice = Array.prototype.splice;\n\n/*\n * Cached regex to split keys for `delegate`.\n */\n\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\n\nvar nestedEventTypes = ['views', 'collections', 'models'];\n\n/*\n * Base View class extend backbone View class\n */\n\nvar View = {\n\t/*\n\t * Helpers (Object|Fuction) which will be passed to the template\n\t */\n\n\ttemplateHelpers: {}\n};\n\nvar viewOptions = [\n\t'models', 'collections', 'views', 'events', 'data', 'router',\n\t'templateHelpers'\n];\n\nView.wait = function() {\n\tvar self = this;\n\tthis._waiting = true;\n\n\treturn function() {\n\t\tself._waiting = false;\n\t\tself.trigger('resolve');\n\t};\n};\n\nView.isWaiting = function() {\n\treturn this._waiting;\n};\n\n/*\n * Override constructor\n *\n * @param {Object} [options]\n */\n\nView.constructor = function(options) {\n\tvar self = this;\n\n\toptions = options || {};\n\n\t// Nested views hash is empty by default\n\tthis.views = {};\n\n\tthis.data = this.data || {};\n\n\t// populate View instance with fields from options\n\t_.extend(this, _.pick(options, viewOptions));\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\tif (this.template && !_.isFunction(this.template)) {\n\t\tthrow new Error('View `template` option should be a function');\n\t}\n\n\tthis._normalizeViews();\n\tthis._prepareNestedEvents();\n\n\tthis._waiting = false;\n\n\t// apply backbone.View constructor\n\tbackbone.View.apply(this, arguments);\n\n\t// delegate events for each collection\n\tif (this.collections) {\n\t\t_(this.collections).each(function(collection, key) {\n\t\t\tself.delegateNestedEvents('collections', key, collection);\n\t\t});\n\t}\n\n\t// delegate events for each model\n\tif (this.models) {\n\t\t_(this.models).each(function(model, key) {\n\t\t\tself.delegateNestedEvents('models', key, model);\n\t\t});\n\t}\n};\n\nView.setData = function(data) {\n\tif (data) this.data = data;\n};\n\nView.isUnchanged = function() {\n\treturn true;\n};\n\n/*\n * Override `render`\n */\n\nView.render = function(options) {\n\tif (this.isWaiting()) return this;\n\n\toptions = options || {};\n\n\tif (\n\t\tthis.template &&\n\t\t(options.force || !this.isAttached() || !this.isUnchanged())\n\t) {\n\t\tthis._createTemplateElement();\n\n\t\t// set tricky flag that used for calling after render\n\t\t// only after _createTemplateElement\n\t\tthis._isAfterAttachNeeded = true;\n\t}\n\n\t// attach view to dom element\n\tthis.attach();\n\n\t// render nested views\n\tthis.renderViews(options);\n\n\t// call after attach method if el was set in parent view\n\tif (this.$el.parent().length) {\n\t\tthis._afterAttachViews();\n\t}\n\n\treturn this;\n};\n\n/*\n * Get data for template rendering\n */\n\nView.getTemplateData = function() {\n\treturn this.data;\n};\n\n/*\n * Render template with data. Returns html.\n *\n * @param {function} template for rendering\n * @params {object} data for rendering\n */\n\nView.renderTemplate = function(template, data) {\n\tdata = _(this).chain().result('templateHelpers').extend(data).value();\n\n\t// get html\n\treturn template(data);\n};\n\n/*\n * Set html to $el element\n *\n * @param {object} [data] data for rendering (return value of getData)\n */\n\nView._createTemplateElement = function() {\n\tvar templateData = this.getTemplateData();\n\tvar html = this.renderTemplate(this.template, templateData);\n\tvar $html = $(html);\n\n\tif ($html.length > 1) {\n\t\t// @TODO: show warning here or something better?\n\t}\n\n\tvar $newEl = $html.first();\n\n\t// insert html to $el\n\tif (this.$el.parent().length) {\n\t\tthis.$el.replaceWith($newEl);\n\t}\n\n\tthis.setElement($newEl, true);\n\n\treturn this;\n};\n\n\n/*\n * Render all nested view\n *\n * @TODO: add some rendering optimizations\n*/\n\nView.renderViews = function(options) {\n\tvar self = this;\n\n\t// iterate by each views group\n\t_(this.views).each(function(viewsGroup, container) {\n\t\t// return if view group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call render for each views from view group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\tview.render(options);\n\t\t});\n\n\t\t// get first container or $el\n\t\tvar $container = container ? self.$(container).first() : self.$el;\n\n\t\tif (!$container.length) {\n\t\t\tthrow new Error('Container \"' + container + '\" is not found');\n\t\t}\n\n\t\tif (_(viewsGroup).some(function(view) {\n\t\t\treturn !view.isAttached() || !$container.is(view.$el.parent());\n\t\t})) {\n\t\t\t// put to $container\n\t\t\t$container.append(_(viewsGroup).pluck('$el'));\n\t\t}\n\t});\n};\n\n/*\n * Set view(s) to views group or replace some view in specified position\n * If index is passed it replace only one view with index in views group\n *\n * @param {View | View[]} views - view(s) to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n */\n\nView.setView = View.setViews = function(views, container, index) {\n\treturn this._updateViews('set', views, container, index);\n};\n\n/*\n * Alias for setViews\n */\n\nView.replaceView = View.replaceViews = function(views, container, index) {\n\treturn this.setViews.apply(this, arguments);\n};\n\n/*\n * Append view(s) to end of views group\n * This method is alias for insertViews without index argument\n *\n * @param {View | View[]} views\n * @param {String} container - container of views group\n */\n\nView.appendView = View.appendViews = function(views, container) {\n\treturn this.insertViews(views, container);\n};\n\n/*\n * Prepend view(s) to start of views group\n * This method is alias for insertViews with `0` as index argument value\n *\n * @param {View | View[]} views\n * @param {String} container - container of views group\n */\n\nView.prependView = View.prependViews = function(views, container) {\n\treturn this.insertViews(views, container, 0);\n};\n\n/*\n * Insert view(s) to specified position of views group\n * If index is not passed views will insert to end of views group (append)\n *\n * @param {View | View[]} views\n * @param {String} container - container of views group\n * @param {Number} [index] - position in views group\n */\n\nView.insertView = View.insertViews = function(views, container, index) {\n\treturn this._updateViews('insert', views, container, index);\n};\n\n/*\n * Remove view(s) from views group by index or views instances list\n * If index is passed it remove only one view in index position\n * If views is passed it remove some of them, that places in views group\n *\n * @param {View | View[]} [views] - view(s) to remove\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in views group\n */\n\nView.removeView = View.removeViews = function(views, container, index) {\n\tif (arguments.length < 2) {\n\t\tthrow new Error('\"views\" or \"index\" arguments must be specified');\n\t}\n\n\tif (_.isString(views)) {\n\t\tindex = container;\n\t\tcontainer = views;\n\t\tviews = this.getView(container, index);\n\t\tif (!views) return this;\n\t}\n\n\treturn this._updateViews('remove', views, container);\n};\n\n/*\n * Get single view by container and index\n *\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in views group\n */\n\nView.getView = function(container, index) {\n\treturn this.getViews(container)[index || 0] || null;\n};\n\n/*\n * Get views group by container\n *\n * @param {String} container - container of views group\n */\n\nView.getViews = function(container) {\n\treturn _.clone(this.views[container]) || [];\n};\n\n/*\n * Common method for updating view(s) in views group with method\n *  `set`, `insert` or `remove`.\n *\n * @param {String} method - `set`, `insert` or `remove`\n * @paran {View | View[]} views\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in group\n */\n\nView._updateViews = function(method, views, container, index) {\n\tvar self = this;\n\n\tif (!views) {\n\t\tthrow new Error('\"views\" argument must be specified');\n\t}\n\n\tif (!_.isArray(views)) views = [views];\n\n\tvar viewsGroup = this.getViews(container);\n\n\tswitch (method) {\n\t\tcase 'set':\n\t\t\tif (viewsGroup.length) {\n\t\t\t\tvar removedViews = [];\n\n\t\t\t\t// if views group is not empty\n\t\t\t\tif (typeof index !== 'undefined') {\n\t\t\t\t\t// if index is specified\n\t\t\t\t\t// remove view from specific position\n\t\t\t\t\tremovedViews = this.getView(container, index);\n\t\t\t\t\tremovedViews = removedViews ? [removedViews] : [];\n\t\t\t\t} else {\n\t\t\t\t\t// if no index - remove all views from views group\n\t\t\t\t\tremovedViews = viewsGroup;\n\t\t\t\t}\n\n\t\t\t\tif (removedViews.length) {\n\t\t\t\t\t// if remove views array is not empty\n\t\t\t\t\t// remove from parent\n\t\t\t\t\tthis._updateViews('remove', removedViews, container);\n\n\t\t\t\t\t// and remove views\n\t\t\t\t\t_(removedViews).each(function(view) {\n\t\t\t\t\t\tview.remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// insert new views\n\t\t\tthis._updateViews('insert', views, container, index);\n\n\t\t\tbreak;\n\n\t\tcase 'insert':\n\t\t\t_(views).each(function(view) {\n\t\t\t\tif (view.parent) {\n\t\t\t\t\tview.parent.removeView(view, view.container);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (viewsGroup.length) {\n\t\t\t\t// if index is not specified set it value as last index of views group\n\t\t\t\tif (typeof index === 'undefined') {\n\t\t\t\t\tindex = viewsGroup.length;\n\t\t\t\t}\n\n\t\t\t\t// insert views\n\t\t\t\tsplice.apply(this.views[container], [index, 0].concat(views));\n\t\t\t} else {\n\t\t\t\t// if group is empty - set views as whole views group value\n\t\t\t\tthis.views[container] = views;\n\t\t\t}\n\n\t\t\t// set each view parent to current\n\t\t\t_(views).each(function(view) {\n\t\t\t\tview.parent = self;\n\t\t\t\tview.container = container;\n\t\t\t});\n\n\t\t\tthis.delegateNestedEvents('views', container, views);\n\n\t\t\tbreak;\n\n\t\tcase 'remove':\n\t\t\tif (!viewsGroup.length) break;\n\n\t\t\tvar viewObjs = _.chain(views).uniq().map(function(view) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tview: view,\n\t\t\t\t\t\tindex: _.indexOf(viewsGroup, view)\n\t\t\t\t\t};\n\t\t\t\t}).filter(function(viewObj) {\n\t\t\t\t\treturn viewObj.index >= 0;\n\t\t\t\t}).sortBy(function(viewObj) {\n\t\t\t\t\treturn -viewObj.index;\n\t\t\t\t}).value();\n\n\t\t\tif (!viewObjs.length) break;\n\n\t\t\t_(viewObjs).each(function(viewObj) {\n\t\t\t\tvar view = viewObj.view;\n\n\t\t\t\t// remove item from group\n\t\t\t\tsplice.call(self.views[container], viewObj.index, 1);\n\n\t\t\t\t// undelegate all nested entity events\n\t\t\t\tself.undelegateNestedEvents(view);\n\n\t\t\t\t// unset view parent\n\t\t\t\tdelete view.parent;\n\t\t\t});\n\t}\n\n\treturn this;\n};\n\n/*\n * Override delegateEvents\n */\n\nView.delegateEvents = function(events) {\n\tevents = events || _.result(this, 'events');\n\tif (!events) return this;\n\tevents = _(events).omit(nestedEventTypes);\n\treturn backbone.View.prototype.delegateEvents.call(this, events);\n};\n\nView.delegateNestedEvents = function(type, key, entities) {\n\tvar self = this;\n\tif (!_.isArray(entities)) entities = [entities];\n\tvar listeners = this._nestedEventsHash[type][key];\n\tif (listeners) {\n\t\t_(listeners).each(function(listener) {\n\t\t\t_(entities).each(function(entity) {\n\t\t\t\tself.listenTo(entity, listener.eventName, listener.handler);\n\t\t\t});\n\t\t});\n\t}\n\treturn this;\n};\n\nView.undelegateNestedEvents = function(entities) {\n\tvar self = this;\n\tif (!_.isArray(entities)) entities = [entities];\n\t_(entities).each(function(entity) {\n\t\tself.stopListening(entity);\n\t});\n\treturn this;\n};\n\nView._prepareNestedEvents = function(events) {\n\tvar self = this;\n\n\t// Hash for nested views events fast search\n\tthis._nestedEventsHash = {};\n\t_(nestedEventTypes).each(function(type) {\n\t\tself._nestedEventsHash[type] = {};\n\t});\n\n\tevents = events || _.result(this, 'events');\n\tif (!events) return;\n\n\t// bind all prefixed events to view then call native delegate events\n\t_(nestedEventTypes).each(function(type) {\n\t\tvar typeEventsHash = self._nestedEventsHash[type];\n\n\t\tif (!_(events).has(type) || !_.isObject(events[type])) return;\n\n\t\t_(events[type]).each(function(method, key) {\n\t\t\tif (!_.isFunction(method)) method = self[method];\n\t\t\tif (!method) return;\n\t\t\tvar match = key.match(delegateEventSplitter);\n\t\t\tvar eventName = match[1];\n\t\t\tvar entityKeys = match[2].replace(/ *, */g, ',').split(',');\n\t\t\tmethod = _.bind(method, self);\n\n\t\t\t// fill _nestedEventsHash\n\t\t\t_(entityKeys).each(function(entityKey) {\n\t\t\t\ttypeEventsHash[entityKey] = typeEventsHash[entityKey] || [];\n\t\t\t\ttypeEventsHash[entityKey].push({\n\t\t\t\t\teventName: eventName,\n\t\t\t\t\thandler: method\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n};\n\n/*\n * Wrap all non-array views groups to arrays with one element\n */\n\nView._normalizeViews = function() {\n\tvar self = this;\n\n\t_(this.views).each(function(views, container) {\n\t\tif (!_.isArray(views)) {\n\t\t\tself.views[container] = [views];\n\t\t}\n\t});\n};\n\n/*\n * Get view attached state\n */\n\nView.isAttached = function() {\n\tvar view = this.$el.data('esencia-view');\n\treturn Boolean(view && view === this);\n};\n\nView._afterAttachViews = function() {\n\t// iterate by each nested views groups\n\t_(this.views).each(function(viewsGroup) {\n\t\t// return if views group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call _afterAttachViews for each views from views group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\tview._afterAttachViews();\n\t\t});\n\t});\n\n\t// call afterAttach for current view\n\tif (this._isAfterAttachNeeded) {\n\t\t// remove after attach flag\n\t\tdelete this._isAfterAttachNeeded;\n\n\t\t// call after attach\n\t\tthis.afterAttach();\n\t}\n};\n\n/*\n * afterAttach is empty by default.\n * It called after _createTemplateElement, renderViews and attach calls\n * Override it to add some specific logic after template render.\n */\n\nView.afterAttach = function() {\n\treturn this;\n};\n\n/*\n * Detach all previous views and attach new view to current view $el\n */\n\nView.attach = function() {\n\t// return if current view is already attached\n\tif (this.isAttached()) return this;\n\n\t// detach previous instance attached to this element\n\tvar previousView = this.$el.data('esencia-view');\n\tif (previousView) previousView.detach();\n\n\t// attach current view and set attr\n\tthis.$el.data('esencia-view', this).attr('esencia-view', this.cid);\n\n\treturn this;\n};\n\nView._detachViews = function() {\n\t// iterate by each views groups\n\t_(this.views).each(function(viewsGroup) {\n\t\t// return if views group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call _detachViews for each nested view from views group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\tview.detach();\n\t\t});\n\t});\n};\n\n/*\n * beforeDetach is empty by default.\n * It called before detach calls\n * Override it to add some specific logic before view detach from dom.\n */\n\nView.beforeDetach = function() {\n\treturn this;\n};\n\n/*\n * Detach view from current view $el\n */\n\nView.detach = function() {\n\t// return if current view is not already attached\n\tif (!this.isAttached()) return this;\n\n\t// detach all nested views\n\tthis._detachViews();\n\n\t// do some user actions\n\tthis.beforeDetach();\n\n\t// remove attr and data from $el\n\tthis.$el.removeData('esencia-view').removeAttr('esencia-view');\n\n\t// disable all events\n\tthis.undelegateEvents();\n\tthis.stopListening();\n\n\treturn this;\n};\n\nView.remove = function() {\n\tif (this.parent) {\n\t\tthis.parent.removeView(this, this.container);\n\t}\n\tthis.detach();\n\tthis._removeElement();\n\treturn this;\n};\n\n/*\n * Get view, that attached to closest element with attr `esencia-view`\n *\n * @param {String | $} selector\n */\n\nView.getClosestView = function(selector) {\n\tvar $selector = $(selector);\n\n\tif (!$selector.is('[esencia-view]')) {\n\t\t$selector = $selector.closest('[esencia-view]');\n\t}\n\n\treturn $selector.length ? $selector.data('esencia-view') : null;\n};\n\nmodule.exports = backbone.View.extend(View);\n"]}