{"version":3,"sources":["lib/collection.js","lib/componentsManager.js","lib/esencia.js","lib/model.js","lib/router.js","lib/utils/exec.js","lib/view.js"],"names":["_","_require","backbone","execUtils","Collection","sync","method","collection","options","prepareOptions","getFakeBaseMethod","prototype","call","exec","extend","parse","success","resp","fetch","reset","context","trigger","wrapError","module","exports","View","ComponentsManager","pick","componentManagerOptions","components","componentsTree","initialize","apply","arguments","componentOptions","Events","rootComponentEl","addRootComponent","RootView","el","add","name","parent","defaults","process","component","isUndefined","uniqueId","isString","Error","isNull","get","remove","callback","noop","newComponentsTree","_calculateTree","_applyTree","parentNode","oldNode","node","child","_isTreeNodeChanged","view","attached","isUnchanged","params","self","iterateNode","childNode","onViewResolve","setData","container","setView","renderViews","attachViews","render","oldView","detach","chain","extendOwn","result","viewOptions","value","isWaiting","listenToOnce","oldChildView","oldChildViewContainer","removeView","Router","Model","model","serverAttrs","set","root","pushState","namedParameters","nowhereUrl","config","autoloadModules","modulesPath","defaultModuleName","onModuleError","routerOptions","constructor","componentsManager","router","urlParams","modules","history","route","setModule","_populateUrlParams","key","has","filter","isObject","each","isFunction","url","defaultUrlParams","args","_defaultMiddleware","navigate","fragment","indexOf","substring","length","force","replace","omit","qs","toFragment","val","undefined","next","middleware","defaultMiddleware","moduleName","split","find","identity","require","moduleInit","start","DEFAULT_EXEC_TYPE","urlError","error","type","dataType","contentType","processData","data","JSON","stringify","baseMethodsMap","toUpperCase","$","splice","Array","delegateEventSplitter","nestedEventTypes","templateHelpers","waitsCounter","waitAvailable","views","collections","models","template","_prepareEvents","_prepareViews","wait","delegateNestedEvents","once","defer","_render","html","renderTemplate","getTemplateData","$el","setElement","_ensureElement","$container","attach","viewsGroup","first","containerEl","domChanged","some","$els","push","append","index","_updateViews","setViews","appendView","_insertViews","appendViews","prependView","prependViews","insertView","insertViews","getView","_removeViews","removeViews","getViews","clone","concat","removedViews","viewObjs","uniq","map","viewObj","sortBy","undelegateNestedEvents","element","$previousEl","_setElement","replaceWith","delegateEvents","events","entities","isArray","listeners","_nestedEventsHash","listener","entity","listenTo","eventName","handler","stopListening","typeEventsHash","match","entityKeys","bind","entityKey","afterAttach","previousView","attr","cid","detachViews","beforeDetach","removeData","removeAttr","undelegateEvents","getClosestView","selector","$selector","is","closest"],"mappings":"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","file":"esencia.js","sourceRoot":".","sourcesContent":["'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar execUtils = require('./utils/exec');\n\nvar Collection = {};\n\n/*\n * Override `sync` to add exec custom method functionality\n */\n\nCollection.sync = function(method, collection, options) {\n\toptions = execUtils.prepareOptions(method, collection, options);\n\tmethod = execUtils.getFakeBaseMethod(options);\n\treturn backbone.Collection.prototype.sync.call(\n\t\tthis, method, collection, options\n\t);\n};\n\n/*\n * Exec custom non-REST method on collection\n * It trigger `exec:[method]` event after success method exec\n *\n * @param {String} method\n * @param {Object} options\n */\n\nCollection.exec = function(method, options) {\n\toptions = _.extend({parse: true}, options);\n\tvar collection = this;\n\tvar success = options.success;\n\toptions.success = function(resp) {\n\t\tif (options.fetch) collection[options.reset ? 'reset' : 'set'](resp, options);\n\t\tif (success) success.call(options.context, collection, resp, options);\n\t\tcollection.trigger('exec:' + method, collection, resp, options);\n\t};\n\texecUtils.wrapError(this, options);\n\treturn this.sync(method, this, options);\n};\n\nmodule.exports = backbone.Collection.extend(Collection);\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar View = require('./view');\n\nvar ComponentsManager = function(options) {\n\t// populate ComponentsManager instance with fields from options\n\t_.extend(this, _.pick(options, componentManagerOptions));\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\t// all components hash\n\tthis.components = {};\n\n\t// current components tree that rendered at this moment\n\tthis.componentsTree = null;\n\n\tthis.initialize.apply(this, arguments);\n};\n\nvar componentManagerOptions = ['rootComponentEl', 'viewOptions'];\n\n var componentOptions = [\n\t'name', 'parent', 'container', 'View', 'models', 'collections', 'viewOptions'\n];\n\n_.extend(ComponentsManager.prototype, backbone.Events, {\n\trootComponentEl: 'html',\n\n\t/*\n\t * Initialize is an empty function by default. Override it with your own\n\t * initialization logic.\n\t */\n\n\tinitialize: function() {},\n\n\t/*\n\t * Add root component to components list\n\t */\n\n\taddRootComponent: function() {\n\t\tvar RootView = View.extend({\n\t\t\tel: this.rootComponentEl\n\t\t});\n\n\t\tthis.add({\n\t\t\tname: '',\n\t\t\tparent: null,\n\t\t\tView: RootView\n\t\t});\n\t},\n\n\t/*\n\t * Add component to components list\n\t *\n\t * @param {Object} options - component options\n\t */\n\n\tadd: function(options) {\n\t\toptions = _({}).defaults(options, {\n\t\t\tparent: '',\n\t\t\tprocess: false\n\t\t});\n\n\t\tvar component = _(options).pick(componentOptions);\n\n\t\t// generate uniq component name if name is omitted\n\t\tif (_.isUndefined(component.name)) {\n\t\t\tcomponent.name = _.uniqueId('auto-named-component');\n\t\t}\n\n\t\tif (!_.isString(component.name)) {\n\t\t\tthrow new Error('Component `name` option should be a string');\n\t\t}\n\n\t\tif (component.name in this.components) {\n\t\t\tthrow new Error('Duplicate component with name \"' + component.name + '\"');\n\t\t}\n\n\t\tif (!component.View) {\n\t\t\tthrow new Error('Component `View` option is required');\n\t\t}\n\n\t\tif (!_.isString(component.parent) && !_.isNull(component.parent)) {\n\t\t\tthrow new Error('Component `parent` option should be a string or null');\n\t\t}\n\n\t\tthis.components[component.name] = component;\n\n\t\t// process components tree in force mode\n\t\tif (options.process) {\n\t\t\tthis.process(component.name);\n\t\t}\n\n\t\treturn component;\n\t},\n\n\t/*\n\t * Get component by name\n\t *\n\t * @param {String} name - component name\n\t */\n\n\tget: function(name) {\n\t\treturn this.components[name] || null;\n\t},\n\n\t/*\n\t * Remove component by name\n\t *\n\t * @param {String} name - component name\n\t */\n\n\tremove: function(name) {\n\t\tdelete this.components[name];\n\t},\n\n\t/*\n\t * Process components tree and call a callback on done\n\t *\n\t * @param {String} name - component name\n\t * @params {Function} callback\n\t */\n\n\tprocess: function(name, callback) {\n\t\tcallback = callback || _.noop;\n\n\t\tvar newComponentsTree = this._calculateTree(name);\n\n\t\tthis._applyTree({\n\t\t\tparentNode: null,\n\t\t\toldNode: this.componentsTree,\n\t\t\tnode: newComponentsTree\n\t\t}, callback);\n\t},\n\n\t_calculateTree: function(name, child) {\n\t\tvar component = this.components[name];\n\n\t\tif (!component) {\n\t\t\tthrow new Error('Unknown component with name \"' + name + '\"');\n\t\t}\n\n\t\tvar node = {name: name};\n\t\tif (child) {\n\t\t\tnode.child = child;\n\t\t}\n\n\t\tif (_.isString(component.parent)) {\n\t\t\treturn this._calculateTree(component.parent, node);\n\t\t} else {\n\t\t\treturn node;\n\t\t}\n\t},\n\n\t_isTreeNodeChanged: function(oldNode, node) {\n\t\tif (!oldNode || oldNode.name !== node.name || !oldNode.view) return true;\n\t\tvar component = this.components[node.name];\n\t\tif (oldNode.view instanceof component.View === false) return true;\n\t\tif (!oldNode.view.attached) return true;\n\t\treturn !oldNode.view.isUnchanged();\n\t},\n\n\t_applyTree: function(params, callback) {\n\t\tvar self = this;\n\n\t\tvar parentNode = params.parentNode;\n\n\t\tvar iterateNode = function(oldNode, node) {\n\t\t\t// omit child field in new node because it will set recursive\n\t\t\t// and should not exist if error case\n\t\t\tvar childNode = node.child;\n\t\t\tdelete node.child;\n\n\t\t\tif (parentNode) {\n\t\t\t\tparentNode.child = node;\n\t\t\t} else {\n\t\t\t\tself.componentsTree = node;\n\t\t\t}\n\n\t\t\tif (childNode) {\n\t\t\t\tself._applyTree({\n\t\t\t\t\tparentNode: node,\n\t\t\t\t\toldNode: oldNode && oldNode.child || null,\n\t\t\t\t\tnode: childNode\n\t\t\t\t}, callback);\n\t\t\t} else {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t};\n\n\t\tvar node = params.node;\n\t\tvar oldNode = params.oldNode;\n\t\tvar component = this.components[node.name];\n\n\t\tvar onViewResolve = function(view) {\n\t\t\tnode.view = view;\n\t\t\tview.setData();\n\n\t\t\tif (component.container) {\n\t\t\t\tif (!parentNode) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t'Parent component should exist for component with `container` option'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tparentNode.view\n\t\t\t\t\t.setView(view, component.container)\n\t\t\t\t\t.renderViews()\n\t\t\t\t\t.attachViews();\n\t\t\t} else {\n\t\t\t\tview.render();\n\t\t\t}\n\n\t\t\t// stop processing old components tree\n\t\t\titerateNode(null, node);\n\t\t};\n\n\t\t// get view from old node\n\t\tvar oldView = oldNode && oldNode.view;\n\n\t\tif (this._isTreeNodeChanged(oldNode, node)) {\n\t\t\tif (oldView) {\n\t\t\t\tif (oldView.container) {\n\t\t\t\t\t// remove old view if container for new view dirrent\n\t\t\t\t\tif (!component.container || oldView.container !== component.container) {\n\t\t\t\t\t\toldView.remove();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// detach old view if it has not a container\n\t\t\t\t\toldView.detach();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// create new view\n\t\t\tvar view = new (component.View)(\n\t\t\t\t_(component)\n\t\t\t\t\t.chain()\n\t\t\t\t\t.pick('models', 'collections')\n\t\t\t\t\t.extendOwn(_(component).result('viewOptions'), this.viewOptions)\n\t\t\t\t\t.value()\n\t\t\t);\n\n\t\t\tif (view.isWaiting()) {\n\t\t\t\t// wait when view will be resolved\n\t\t\t\tself.listenToOnce(view, 'resolve', function() {\n\t\t\t\t\tonViewResolve(view);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tonViewResolve(view);\n\t\t\t}\n\t\t} else {\n\t\t\t// get old child view if exists\n\t\t\tvar oldChildView = oldNode.child && oldNode.child.view;\n\n\t\t\t// temporary remove child node view from container\n\t\t\t// to prevent recursive renderViews\n\t\t\tvar oldChildViewContainer;\n\t\t\tif (oldChildView) {\n\t\t\t\toldChildViewContainer = oldChildView.container;\n\n\t\t\t\tif (oldChildViewContainer) {\n\t\t\t\t\toldView.removeView(oldChildView, oldChildViewContainer);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// save old view to new node\n\t\t\tnode.view = oldView;\n\n\t\t\t// set data and re-render old view\n\t\t\toldView.setData();\n\t\t\toldView.render();\n\n\t\t\t// revert child node view\n\t\t\tif (oldChildView && oldChildViewContainer) {\n\t\t\t\toldView.setView(oldChildView, oldChildViewContainer);\n\t\t\t}\n\n\t\t\t// proprocessing old components tree\n\t\t\titerateNode(oldNode, node);\n\t\t}\n\t}\n});\n\n/*\n * There is no good exports of extend method from backbone.\n * Take it from View and add to ComponentsManager\n *  because no other ways, ughh :-S.\n */\n\nComponentsManager.extend = View.extend;\n\nmodule.exports = ComponentsManager;\n","'use strict';\n\nvar Router = require('./router');\nvar Collection = require('./collection');\nvar Model = require('./model');\nvar View = require('./view');\nvar ComponentsManager = require('./componentsManager');\n\nmodule.exports.Router = Router;\nmodule.exports.Collection = Collection;\nmodule.exports.Model = Model;\nmodule.exports.View = View;\nmodule.exports.ComponentsManager = ComponentsManager;\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar execUtils = require('./utils/exec');\n\nvar Model = {};\n\n/*\n * Override `sync` to add exec custom method functionality\n */\n\nModel.sync = function(method, model, options) {\n\toptions = execUtils.prepareOptions(method, model, options);\n\tmethod = execUtils.getFakeBaseMethod(options);\n\treturn backbone.Model.prototype.sync.call(this, method, model, options);\n};\n\n/*\n * Exec custom non-REST method on model\n * It trigger `exec:[method]` event after success method exec\n *\n * @param {String} method\n * @param {Object} options\n */\n\nModel.exec = function(method, options) {\n\toptions = _.extend({parse: true}, options);\n\tvar model = this;\n\tvar success = options.success;\n\toptions.success = function(resp) {\n\t\tif (options.fetch) {\n\t\t\tvar serverAttrs = options.parse ? model.parse(resp, options) : resp;\n\t\t\tif (!model.set(serverAttrs, options)) return false;\n\t\t}\n\t\tif (success) success.call(options.context, model, resp, options);\n\t\tmodel.trigger('exec:' + method, model, resp, options);\n\t};\n\texecUtils.wrapError(this, options);\n\treturn this.sync(method, this, options);\n};\n\nmodule.exports = backbone.Model.extend(Model);\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar ComponentsManager = require('./componentsManager');\n\n/**\n * Router extends default backbone Router\n */\n\nvar Router = {\n\troot: '/',\n\tpushState: false,\n\tnamedParameters: false,\n\tnowhereUrl: '___',\n\tconfig: {},\n\tautoloadModules: true,\n\tmodulesPath: 'modules/',\n\tdefaultModuleName: 'main',\n\tonModuleError: function() {}\n};\n\nvar routerOptions = [\n\t'root', 'pushState', 'namedParameters', 'nowhereUrl', 'config',\n\t'autoloadModules', 'modulesPath', 'defaultModuleName', 'onModuleError'\n];\n\n/*\n * @constructor\n * @param {Object} [options]\n */\n\nRouter.constructor = function(options) {\n\toptions = options || {};\n\n\t// populate Router instance with fields from options\n\t_.extend(this, _.pick(options, routerOptions));\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\tthis.componentsManager = new ComponentsManager(\n\t\t_.extend({}, options, {viewOptions: {router: this}})\n\t);\n\n\tthis.urlParams = {};\n\tthis.modules = {};\n\n\tthis.history = backbone.history;\n\n\t/*\n\t * All query parameters can be passed in a single hash using the key\n\t * referenced from the route definition (backbone queryparams will\n\t * do it for us)\n\t */\n\n\tbackbone.Router.namedParameters = this.namedParameters;\n\n\tbackbone.Router.apply(this, arguments);\n\n\tif (options.autoloadModules) {\n\t\tthis.route('*url', function(params) {\n\t\t\tthis.setModule(params);\n\t\t});\n\t}\n};\n\n/*\n * Extend all arguments to single object and replace urlParams with it\n *\n * @param {Object | Function} params1\n * @param {Object | Function} params2\n * etc. ...\n */\n\nRouter._populateUrlParams = function(/* params1, params2, ... */) {\n\tvar self = this;\n\n\t// clean old values from urlParams object\n\tvar key;\n\tfor (key in this.urlParams) {\n\t\tif (_(this.urlParams).has(key)) {\n\t\t\tdelete this.urlParams[key];\n\t\t}\n\t}\n\n\t// populate urlParams with new params\n\t_(arguments)\n\t\t.chain()\n\t\t.filter(_.isObject)\n\t\t.each(function(params) {\n\t\t\tparams = _.isFunction(params) ? params.call(self) : params;\n\t\t\t_.extendOwn(self.urlParams, params);\n\t\t});\n\n\treturn this.urlParams;\n};\n\n/*\n * Add new component to components manager\n *\n * @param {Object} options - component options\n */\n\nRouter.component = function(options) {\n\tvar self = this;\n\n\tvar component = this.componentsManager.add(options);\n\n\t// bind component to route\n\tif (!_.isUndefined(options.url)) {\n\t\tthis.route(options.url, component.name, function(params) {\n\t\t\tself._populateUrlParams(options.defaultUrlParams, params);\n\n\t\t\t// process components tree\n\t\t\tself.componentsManager.process(component.name);\n\t\t});\n\t}\n};\n\n/*\n * Override `route` to add middleware processing functionality\n */\n\nRouter.route = function(url, name, callback) {\n\tvar router = this;\n\n\tif (_.isFunction(name)) {\n\t\tcallback = name;\n\t\tname = '';\n\t}\n\n\tbackbone.Router.prototype.route.call(this, url, name, function() {\n\t\tvar args = arguments;\n\n\t\trouter._defaultMiddleware({\n\t\t\turl: url,\n\t\t\tname: name,\n\t\t\tcallback: callback\n\t\t}, function() {\n\t\t\tcallback.apply(router, args);\n\t\t});\n\t});\n};\n\n/*\n * Override `navigate`\n *\n * @param {String} fragment\n * @param {Object} [options] - hash of params\n * @param {Object} [options.qs] - query string hash\n */\n\nRouter.navigate = function(fragment, options) {\n\toptions = options || {};\n\n\tif (fragment.indexOf(this.root) === 0) {\n\t\tfragment = fragment.substring(this.root.length);\n\t}\n\n\t// force to go to the selected fragment even if we currently on it\n\tif (options.force) {\n\t\tthis.navigate(this.nowhereUrl, {\n\t\t\treplace: options.replace,\n\t\t\ttrigger: false\n\t\t});\n\n\t\toptions = _(options).chain().omit('force').extend({replace: true}).value();\n\n\t\treturn this.navigate(fragment, options);\n\t}\n\n\t// set `trigger` to true by default\n\toptions = _(options || {}).defaults({\n\t\ttrigger: true,\n\t\tparams: {}\n\t});\n\n\t// add support of query string using `toFragment` from backbone.queryparams\n\tvar qs = options.qs;\n\n\tif (this.toFragment && qs) {\n\t\t// reject undefined and null qs parameters\n\t\t_(qs).each(function(val, key, qs) {\n\t\t\tif (val === undefined || val === null) delete qs[key];\n\t\t});\n\n\t\tfragment = this.toFragment(fragment, qs);\n\n\t\tdelete options.qs;\n\t}\n\n\tbackbone.Router.prototype.navigate.call(this, fragment, options);\n};\n\n\n/*\n * Default middleware function\n */\n\nRouter._defaultMiddleware = function(route, next) {\n\tnext();\n};\n\n/**\n * Use passed function as `middleware`\n *\n * @param {Function} middleware - middleware function,\n * `route` and `next` will be passed as arguments.\n * context (`this`) is link to the router object.\n */\n\nRouter.middleware = function(middleware) {\n\tvar router = this;\n\n\tvar defaultMiddleware = this._defaultMiddleware;\n\n\tthis._defaultMiddleware = function(route, next) {\n\t\tdefaultMiddleware.call(router, route, function() {\n\t\t\tmiddleware.call(router, route, next);\n\t\t});\n\t};\n\n\treturn this;\n};\n\n/*\n * Require module file and init it\n *\n * @param {String} params.url Url without query string\n */\n\nRouter.setModule = function(params) {\n\tvar router = this;\n\n\tvar url = params.url;\n\tdelete params.url;\n\n\tvar moduleName = _(url.split('/')).find(_.identity) || this.defaultModuleName;\n\n\t// require module file\n\trequire([this.modulesPath + moduleName], function(moduleInit) {\n\t\t// if module is loaded first time\n\t\tif (!router.modules[moduleName]) {\n\t\t\t// init it\n\t\t\tmoduleInit(router);\n\n\t\t\t// set module init flag to true\n\t\t\trouter.modules[moduleName] = true;\n\n\t\t\t// and navigate again with force flag\n\t\t\trouter.navigate(url, {\n\t\t\t\treplace: true,\n\t\t\t\tforce: true,\n\t\t\t\tqs: params\n\t\t\t});\n\t\t}\n\t}, this.onModuleError);\n};\n\n/*\n * Start routes handling\n */\n\nRouter.start = function() {\n\tthis.componentsManager.addRootComponent();\n\n\tbackbone.history.start({\n\t\tpushState: this.pushState,\n\t\troot: this.root\n\t});\n};\n\nmodule.exports = backbone.Router.extend(Router);\n","'use strict';\n\nvar _ = require('underscore');\n\n// Default http method type for exec methods\nvar DEFAULT_EXEC_TYPE = 'PUT';\n\n// Throw an error when a URL is needed, and none is supplied.\nvar urlError = function() {\n\tthrow new Error('A \"url\" property or function must be specified');\n};\n\n// Wrap an optional error callback with a fallback error event.\nmodule.exports.wrapError = function(model, options) {\n\tvar error = options.error;\n\toptions.error = function(resp) {\n\t\tif (error) error.call(options.context, model, resp, options);\n\t\tmodel.trigger('error', model, resp, options);\n\t};\n};\n\nmodule.exports.prepareOptions = function(method, model, options) {\n\toptions = _({\n\t\ttype: DEFAULT_EXEC_TYPE,\n\t\tdataType: 'json',\n\t\tcontentType: 'application/json',\n\t\tprocessData: false\n\t}).extend(options);\n\n\t// Ensure that we have a URL and add method name to it\n\tif (!options.url) {\n\t\tvar url = _.result(model, 'url') || urlError();\n\t\toptions.url = url.replace(/[^\\/]$/, '$&/') + method;\n\t}\n\n\t// stringify data to json\n\tif (options.data && _.isObject(options.data) && !options.processData) {\n\t\toptions.data = JSON.stringify(options.data);\n\t}\n\n\treturn options;\n};\n\n// HTTP type to backbone sync methods map\nvar baseMethodsMap = {\n\t'POST': 'create',\n\t'PUT': 'update',\n\t'PATCH': 'patch',\n\t'DELETE': 'delete',\n\t'GET': 'read'\n};\n\nmodule.exports.getFakeBaseMethod = function(options) {\n\treturn baseMethodsMap[options.type.toUpperCase()];\n};\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\n\n// Take jquery or other selectors lib from backbone\nvar $ = backbone.$;\n\nvar splice = Array.prototype.splice;\n\n// Cached regex to split keys for `delegate`.\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\n\n// List of events type for nested entities processed by current view\nvar nestedEventTypes = ['views', 'collections', 'models'];\n\n/**\n * @class Esencia.View\n * @extend Backbone.View\n */\n\nvar View = {\n\t// Helpers (Object|Fuction) which will be passed to the template\n\ttemplateHelpers: {},\n\n\t// views are in the resolved state by default\n\twaitsCounter: 0,\n\n\t// this flag is used to check that .wait() is called\n\t// in the constructor/initialize\n\twaitAvailable: true,\n\n\t// views are not attached by default\n\tattached: false\n};\n\nvar viewOptions = [\n\t'views', 'collections', 'models', 'data', 'events', 'router', 'templateHelpers'\n];\n\n/**\n * @constructor\n * @param {Object} [options]\n */\n\nView.constructor = function(options) {\n\tvar self = this;\n\n\toptions = options || {};\n\n\t// nested views, collections, models and data are empty by default\n\tthis.views = {};\n\tthis.collections = {};\n\tthis.models = {};\n\tthis.data = {};\n\n\t// populate View instance with fields from options\n\t_.extend(this, _.pick(options, viewOptions));\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\tif (this.template && !_.isFunction(this.template)) {\n\t\tthrow new Error('View `template` option should be a function');\n\t}\n\n\t// create special hash object for all events for fast search\n\tthis._prepareEvents();\n\n\t// normalize nested views hash\n\tthis._prepareViews();\n\n\t// apply default backbone.View constructor\n\tbackbone.View.apply(this, arguments);\n\n\t// set waiting state for current view if some nested view is in waiting state\n\t_(this.views).each(function(views) {\n\t\t_(views).each(function(view) {\n\t\t\tif (view.isWaiting()) {\n\t\t\t\tself.listenToOnce(view, 'resolve', self.wait());\n\t\t\t}\n\t\t});\n\t});\n\n\t// disable .wait(), it available only in the constructor/initialize\n\tthis.waitAvailable = false;\n\n\t// we should delegate events after parent constructor call because\n\t// collections and models could be created in the initialize method\n\n\t// delegate events for each collection\n\t_(this.collections).each(function(collection, key) {\n\t\tself.delegateNestedEvents('collections', key, collection);\n\t});\n\n\t// delegate events for each model\n\t_(this.models).each(function(model, key) {\n\t\tself.delegateNestedEvents('models', key, model);\n\t});\n};\n\n/**\n * Update view data\n * Method is used to update view state, could be overriden to modify nested\n * views state\n *\n * @param {Object} [data] - new data object\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.setData = function(data) {\n\tif (data) this.data = data;\n\treturn this;\n};\n\n/**\n * Check that view is changed and should be re-rendered\n * Method returns true by default (always unchanged), could be overriden\n * for specific logic\n *\n * @return {Boolean}\n */\n\nView.isUnchanged = function() {\n\treturn true;\n};\n\n/**\n * Switch view to the waiting state\n *\n * @return {Function} - callback function, should be called to resolve view\n */\n\nView.wait = function() {\n\tif (!this.waitAvailable) {\n\t\tthrow new Error('Method .wait() is available only in the constructor');\n\t}\n\n\tvar self = this;\n\n\tthis.waitsCounter++;\n\n\t// TODO: think about promises\n\treturn _.once(function() {\n\t\t_.defer(function() {\n\t\t\tself.waitsCounter--;\n\t\t\tif (!self.isWaiting()) {\n\t\t\t\tself.trigger('resolve');\n\t\t\t}\n\t\t});\n\t});\n};\n\n/**\n * @return {Boolean}\n */\n\nView.isWaiting = function() {\n\treturn this.waitsCounter > 0;\n};\n\n/**\n * Render view\n *\n * @override render\n * @param {Object} options\n * @param {Boolean} options.force\n * @return {Esencia.View} - view instance for chaining\n */\n\nView._render = function(options) {\n\t// stop rendering if view in `waiting` state, resolve it first\n\tif (this.isWaiting()) return this;\n\n\toptions = options || {};\n\n\tif (this.template) {\n\t\t// re-render template only if it exists and if it is necessary\n\t\tif (options.force || !this.attached || !this.isUnchanged()) {\n\t\t\t// detach view from DOM element\n\t\t\tthis.detach();\n\n\t\t\t// render template with data\n\t\t\tvar html = this.renderTemplate(this.template, this.getTemplateData());\n\n\t\t\t// render html with jqeury (or other lib) call\n\t\t\tvar $el = $(html);\n\n\t\t\tif (!$el.length) {\n\t\t\t\tthrow new Error('View template produces empty html');\n\t\t\t}\n\n\t\t\tif ($el.length > 1) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'View template produces html with more than one root elements'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.setElement($el);\n\t\t}\n\t} else {\n\t\t// re-ensure element if it is not ensured\n\t\tif (!this.$el.length) this._ensureElement();\n\t}\n\n\t// render nested views\n\tthis.renderViews(options);\n\n\tif (!this.parent || this.$container) {\n\t\t// attach all nested views first\n\t\tthis.attachViews();\n\n\t\t// attach current view\n\t\tthis.attach();\n\t}\n\n\t// return this for chaining\n\treturn this;\n};\n\n/**\n * Render view by calling private _render method\n *\n * @override render\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.render = function(options) {\n\treturn this._render(options);\n};\n\n/*\n * Get data for template rendering\n * Returns data by default, could be overriden\n *\n * @return {Object}\n */\n\nView.getTemplateData = function() {\n\treturn this.data;\n};\n\n/*\n * Render template with data. Returns html.\n *\n * @param {Function} template - template function for rendering\n * @param {Object} data - data for rendering\n * @return {String} - rendered html\n */\n\nView.renderTemplate = function(template, data) {\n\tdata = _(this).chain().result('templateHelpers').extend(data).value();\n\n\t// get html\n\treturn template(data);\n};\n\n/*\n * Render all nested view\n *\n * @param {Object} options\n * @param {Boolean} options.force\n * @return {Esencia.View} - view instance for chaining\n*/\n\nView.renderViews = function(options) {\n\tvar self = this;\n\n\t// iterate by each views group\n\t_(this.views).each(function(viewsGroup, container) {\n\t\t// return if view group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call render for each views from view group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\tview.render(options);\n\t\t});\n\n\t\t// get first container or $el\n\t\tvar $container = container ? self.$(container).first() : self.$el;\n\n\t\tif (!$container.length) {\n\t\t\tthrow new Error('Container \"' + container + '\" is not found');\n\t\t}\n\n\t\tvar containerEl = $container.get(0);\n\n\t\t// dom is changed if some view from group is not in current container\n\t\tvar domChanged = _(viewsGroup).some(function(view) {\n\t\t\treturn (\n\t\t\t\t!view.attached ||\n\t\t\t\t!view.$container ||\n\t\t\t\tview.$container.get(0) !== containerEl\n\t\t\t);\n\t\t});\n\n\t\tif (domChanged) {\n\t\t\t// re-append views group to container\n\t\t\tvar $els = [];\n\n\t\t\t_(viewsGroup).each(function(view) {\n\t\t\t\tview.$container = $container;\n\t\t\t\t$els.push(view.$el);\n\t\t\t});\n\n\t\t\t// TODO: add some rendering optimizations here\n\n\t\t\t// put all views to $container\n\t\t\t$container.append($els);\n\t\t}\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/*\n * Set view to views group or replace some view in specified position\n * If index is passed it replace only one view with index in views group\n *\n * @param {Esencia.View} view - view to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.setView = function(view, container, index) {\n\treturn this._updateViews([view], container, index);\n};\n\n/*\n * Set views to views group or replace some view in specified position\n * If index is passed it replace only one view with index in views group\n *\n * @param {Esencia.View[]} views - views to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.setViews = function(views, container, index) {\n\treturn this._updateViews(views, container, index);\n};\n\n/*\n * Append view to end of views group\n * This method is alias for insertView without index argument\n *\n * @param {Esencia.View} view - view to append\n * @param {String} container - container of views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.appendView = function(view, container) {\n\treturn this._insertViews([view], container);\n};\n\n/*\n * Append views to end of views group\n * This method is alias for insertViews without index argument\n *\n * @param {Esencia.View[]} views - views to append\n * @param {String} container - container of views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.appendViews = function(views, container) {\n\treturn this._insertViews(views, container);\n};\n\n/*\n * Prepend view to start of views group\n * This method is alias for insertView with `0` as index argument value\n *\n * @param {Esencia.View} view - view to prepend\n * @param {String} container - container of views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.prependView = function(view, container) {\n\treturn this._insertViews([view], container, 0);\n};\n\n/*\n * Prepend views to start of views group\n * This method is alias for insertViews with `0` as index argument value\n *\n * @param {Esencia.View[]} views - view to prepend\n * @param {String} container - container of views group\n  * @return {Esencia.View} - view instance for chaining\n */\n\nView.prependViews = function(views, container) {\n\treturn this._insertViews(views, container, 0);\n};\n\n/*\n * Insert view to specified position of views group in the container\n * If index is not passed method inserts view to the end of views group (append)\n *\n * @param {Esencia.View} view - view to insert\n * @param {String} container - container of views group\n * @param {Number} [index] - position in views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.insertView = function(view, container, index) {\n\treturn this._insertViews([view], container, index);\n};\n\n/*\n * Insert views to specified position of views group container\n * If index is not passed method inserts views to the end of views group\n *\n * @param {Esencia.View[]} views - views to insert\n * @param {String} container - container of views group\n * @param {Number} [index] - position in views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.insertViews = function(views, container, index) {\n\treturn this._insertViews(views, container, index);\n};\n\n/*\n * Remove view from views group container by index or view instance\n * If index is passed it remove view in the index position\n *\n * @param {Esencia.View} [view] - view to remove\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.removeView = function(view, container, index) {\n\tif (arguments.length < 2) {\n\t\tthrow new Error('\"view\" or \"index\" arguments must be specified');\n\t}\n\n\tif (_.isString(view)) {\n\t\tindex = container;\n\t\tcontainer = view;\n\t\tview = this.getView(container, index);\n\t\tif (!view) return this;\n\t}\n\n\treturn this._removeViews([view], container);\n};\n\n/*\n * Remove views from views group container\n * If views are passed remove only these views\n * Othervise remove all views from container\n *\n * @param {Esencia.View[]} [views] - views to remove\n * @param {String} container - container of views group\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.removeViews = function(views, container) {\n\tif (_.isString(views)) {\n\t\tcontainer = views;\n\t\tviews = this.getViews(container);\n\t}\n\n\treturn this._removeViews(views, container);\n};\n\n/*\n * Get single view from container by index\n *\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in views group\n * @return {Esencia.View}\n */\n\nView.getView = function(container, index) {\n\treturn this.getViews(container)[index || 0] || null;\n};\n\n/*\n * Get views group from container\n *\n * @param {String} container - container of views group\n * @return {Esencia.View[]}\n */\n\nView.getViews = function(container) {\n\treturn _.clone(this.views[container]) || [];\n};\n\nView._insertViews = function(views, container, index) {\n\tvar self = this;\n\n\tvar viewsGroup = this.getViews(container);\n\n\t_(views).each(function(view) {\n\t\tif (view.parent) {\n\t\t\tview.parent.removeView(view, view.container);\n\t\t}\n\t});\n\n\tif (viewsGroup.length) {\n\t\t// if index is not specified set it value as last index of views group\n\t\tif (typeof index === 'undefined') {\n\t\t\tindex = viewsGroup.length;\n\t\t}\n\n\t\t// insert views\n\t\tsplice.apply(this.views[container], [index, 0].concat(views));\n\t} else {\n\t\t// if group is empty - set views as whole views group value\n\t\tthis.views[container] = views;\n\t}\n\n\t// set each view parent to current\n\t_(views).each(function(view) {\n\t\tview.parent = self;\n\t\tview.container = container;\n\t});\n\n\tthis.delegateNestedEvents('views', container, views);\n\n\treturn this;\n};\n\nView._updateViews = function(views, container, index) {\n\tvar viewsGroup = this.getViews(container);\n\n\tif (viewsGroup.length) {\n\t\tvar removedViews = [];\n\n\t\t// if views group is not empty\n\t\tif (typeof index !== 'undefined') {\n\t\t\t// if index is specified\n\t\t\t// remove view from specific position\n\t\t\tremovedViews = this.getView(container, index);\n\t\t\tremovedViews = removedViews ? [removedViews] : [];\n\t\t} else {\n\t\t\t// if no index - remove all views from views group\n\t\t\tremovedViews = viewsGroup;\n\t\t}\n\n\t\tif (removedViews.length) {\n\t\t\t// if remove views array is not empty\n\t\t\t// remove from parent\n\t\t\tthis._removeViews(removedViews, container);\n\n\t\t\t// and remove views\n\t\t\t_(removedViews).each(function(view) {\n\t\t\t\tview.remove();\n\t\t\t});\n\t\t}\n\t}\n\n\t// insert new views\n\treturn this._insertViews(views, container, index);\n};\n\nView._removeViews = function(views, container) {\n\tvar self = this;\n\n\tvar viewsGroup = this.getViews(container);\n\n\tif (!viewsGroup.length) return this;\n\n\tvar viewObjs = _.chain(views).uniq().map(function(view) {\n\t\t\treturn {\n\t\t\t\tview: view,\n\t\t\t\tindex: _.indexOf(viewsGroup, view)\n\t\t\t};\n\t\t}).filter(function(viewObj) {\n\t\t\treturn viewObj.index >= 0;\n\t\t}).sortBy(function(viewObj) {\n\t\t\treturn -viewObj.index;\n\t\t}).value();\n\n\tif (!viewObjs.length) return this;\n\n\t_(viewObjs).each(function(viewObj) {\n\t\tvar view = viewObj.view;\n\n\t\t// remove item from group\n\t\tsplice.call(self.views[container], viewObj.index, 1);\n\n\t\t// undelegate all nested entity events\n\t\tself.undelegateNestedEvents(view);\n\n\t\t// unset view parent\n\t\tdelete view.parent;\n\t});\n\n\treturn this;\n};\n\n/*\n * Original setElement do undelegateEvents/delegateEvents, we remove it\n * because we have special detach/attach methods for this purpose\n *\n * @override setElement\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.setElement = function(element) {\n\tvar $previousEl = this.$el;\n\n\tthis._setElement(element);\n\n\t// insert html to $el\n\tif ($previousEl && this.$container) {\n\t\t$previousEl.replaceWith(this.$el);\n\t}\n\n\treturn this;\n};\n\n/*\n * @override delegateEvents\n */\n\nView.delegateEvents = function(events) {\n\tevents = events || _.result(this, 'events');\n\tif (!events) return this;\n\tevents = _(events).omit(nestedEventTypes);\n\treturn backbone.View.prototype.delegateEvents.call(this, events);\n};\n\nView.delegateNestedEvents = function(type, key, entities) {\n\tvar self = this;\n\tif (!_.isArray(entities)) entities = [entities];\n\tvar listeners = this._nestedEventsHash[type][key];\n\tif (listeners) {\n\t\t_(listeners).each(function(listener) {\n\t\t\t_(entities).each(function(entity) {\n\t\t\t\tself.listenTo(entity, listener.eventName, listener.handler);\n\t\t\t});\n\t\t});\n\t}\n\treturn this;\n};\n\nView.undelegateNestedEvents = function(entities) {\n\tvar self = this;\n\tif (!_.isArray(entities)) entities = [entities];\n\t_(entities).each(function(entity) {\n\t\tself.stopListening(entity);\n\t});\n\treturn this;\n};\n\nView._prepareEvents = function(events) {\n\tvar self = this;\n\n\t// Hash for nested views events fast search\n\tthis._nestedEventsHash = {};\n\t_(nestedEventTypes).each(function(type) {\n\t\tself._nestedEventsHash[type] = {};\n\t});\n\n\tevents = events || _.result(this, 'events');\n\tif (!events) return;\n\n\t// bind all prefixed events to view then call native delegate events\n\t_(nestedEventTypes).each(function(type) {\n\t\tvar typeEventsHash = self._nestedEventsHash[type];\n\n\t\tif (!_(events).has(type) || !_.isObject(events[type])) return;\n\n\t\t_(events[type]).each(function(method, key) {\n\t\t\tif (!_.isFunction(method)) method = self[method];\n\t\t\tif (!method) return;\n\t\t\tvar match = key.match(delegateEventSplitter);\n\t\t\tvar eventName = match[1];\n\t\t\tvar entityKeys = match[2].replace(/ *, */g, ',').split(',');\n\t\t\tmethod = _.bind(method, self);\n\n\t\t\t// fill _nestedEventsHash\n\t\t\t_(entityKeys).each(function(entityKey) {\n\t\t\t\ttypeEventsHash[entityKey] = typeEventsHash[entityKey] || [];\n\t\t\t\ttypeEventsHash[entityKey].push({\n\t\t\t\t\teventName: eventName,\n\t\t\t\t\thandler: method\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n};\n\n/*\n * Wrap all non-array view groups to arrays with one element and delegate events\n */\n\nView._prepareViews = function() {\n\tvar self = this;\n\n\t_(this.views).each(function(views, container) {\n\t\tif (!_.isArray(views)) views = [views];\n\t\tself.views[container] = views;\n\t\tself.delegateNestedEvents('views', container, views);\n\t});\n};\n\n/**\n * Attach all nested views\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.attachViews = function() {\n\t// iterate by each nested views groups\n\t_(this.views).each(function(viewsGroup) {\n\t\t// return if views group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call attach method for each nested view from views group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\t// recursive attach all nested views\n\t\t\tview.attachViews();\n\n\t\t\t// attach current view\n\t\t\tview.attach();\n\t\t});\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/*\n * afterAttach is empty by default\n * It called after attach call, could be verriden to add some specific logic\n * for DOM manipulations\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.afterAttach = function() {\n\treturn this;\n};\n\n/*\n * Attach new view to current view $el\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.attach = function() {\n\t// return if current view is already attached\n\tif (this.attached) return this;\n\n\t// detach previous view\n\tvar previousView = this.$el.data('esencia-view');\n\tif (previousView) previousView.detach();\n\n\t// attach current view and set attr\n\tthis.$el.data('esencia-view', this).attr('esencia-view', this.cid);\n\n\t// enable all DOM events\n\tthis.delegateEvents();\n\n\tthis.attached = true;\n\n\t// do some user afterAttach actions\n\tthis.afterAttach();\n\n\t// trigger attach event\n\tthis.trigger('attach');\n\n\treturn this;\n};\n\n/**\n * Detach all nested views\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.detachViews = function() {\n\t// iterate by each views groups\n\t_(this.views).each(function(viewsGroup) {\n\t\t// return if views group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call detach method for each nested view from views group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\t// recursive detach all nested views\n\t\t\tview.detachViews();\n\n\t\t\t// detach current view\n\t\t\tview.detach();\n\t\t});\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/*\n * beforeDetach is empty by default\n * It called before detach method call, could be overriden to add some specific\n * logic before view detach from dom\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.beforeDetach = function() {\n\treturn this;\n};\n\n/*\n * Detach view from current view $el\n *\n * @return {Esencia.View} - view instance for chaining\n */\n\nView.detach = function() {\n\t// return if current view is not already attached\n\tif (!this.attached) return this;\n\n\t// trigger detach event\n\tthis.trigger('detach');\n\n\t// do some user beforeDetach actions\n\tthis.beforeDetach();\n\n\t// remove attr and data from $el\n\tthis.$el.removeData('esencia-view').removeAttr('esencia-view');\n\n\t// disable all DOM events\n\tthis.undelegateEvents();\n\n\tthis.attached = false;\n\n\t// return this for chaining\n\treturn this;\n};\n\n/**\n * Remove view from parent container and remove element from DOM\n */\n\nView.remove = function() {\n\t// remove current view from parent view container\n\tif (this.parent) {\n\t\tthis.parent.removeView(this, this.container);\n\t}\n\n\t// detach all nested views first\n\tthis.detachViews();\n\n\t// detach current view\n\tthis.detach();\n\n\t// remove DOM element\n\treturn backbone.View.prototype.remove.call(this);\n};\n\n/*\n * Get view, that attached to closest element with attr `esencia-view`\n *\n * @param {String | $} selector\n * @return {Esencia.View | Null}\n */\n\nView.getClosestView = function(selector) {\n\tvar $selector = $(selector);\n\n\tif (!$selector.is('[esencia-view]')) {\n\t\t$selector = $selector.closest('[esencia-view]');\n\t}\n\n\treturn $selector.length ? $selector.data('esencia-view') : null;\n};\n\nmodule.exports = backbone.View.extend(View);\n"]}