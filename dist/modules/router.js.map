{"version":3,"sources":["lib/router.js","lib/view.js"],"names":["_","_require","backbone","View","Router","root","rootViewEl","modulesPath","defaultModuleName","pushState","namedParameters","autoloadModules","debug","config","onModuleError","nowhereUrl","routerOptions","constructor","options","extend","pick","components","componentsTree","urlParams","modules","history","apply","arguments","route","params","setModule","_initRootComponent","RootView","el","component","name","parent","_populateUrlParams","componentName","key","has","result","componentOptions","router","defaults","defaultUrlParams","viewOptions","process","isUndefined","uniqueId","isString","Error","isNull","url","_processComponent","_calculateComponentsTree","child","node","_isComponentTreeNodeChanged","oldNode","view","attached","isUnchanged","_applyComponentsTree","callback","self","parentNode","iterateNode","childNode","onViewResolve","setData","container","setView","renderViews","attachViews","render","oldView","remove","detach","chain","value","waiting","once","oldChildView","oldChildViewContainer","removeView","noop","newComponentsTree","isFunction","prototype","call","args","_defaultMiddleware","navigate","fragment","indexOf","substring","length","force","replace","trigger","omit","qs","toFragment","each","val","undefined","next","middleware","defaultMiddleware","moduleName","split","find","identity","require","moduleInit","start","module","exports","$","splice","Array","delegateEventSplitter","nestedEventTypes","templateHelpers","views","data","template","_normalizeViews","_prepareNestedEvents","collections","collection","delegateNestedEvents","models","model","wait","console","log","$el","html","renderTemplate","getTemplateData","setElement","_ensureElement","$container","attach","viewsGroup","first","containerEl","get","domChanged","some","$els","push","append","index","_updateViews","setViews","replaceView","replaceViews","appendView","_insertViews","appendViews","prependView","prependViews","insertView","insertViews","getView","_removeViews","removeViews","getViews","clone","concat","removedViews","viewObjs","uniq","map","filter","viewObj","sortBy","undelegateNestedEvents","element","$previousEl","_setElement","replaceWith","delegateEvents","events","type","entities","isArray","listeners","_nestedEventsHash","listener","entity","listenTo","eventName","handler","stopListening","typeEventsHash","isObject","method","match","entityKeys","bind","entityKey","afterAttach","previousView","attr","cid","detachViews","beforeDetach","removeData","removeAttr","undelegateEvents","getClosestView","selector","$selector","is","closest"],"mappings":"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","file":"router.js","sourceRoot":".","sourcesContent":["'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\nvar View = require('./view');\n\n/**\n * Router extends default backbone Router\n */\n\nvar Router = {\n\troot: '/',\n\trootViewEl: 'html',\n\tmodulesPath: 'modules/',\n\tdefaultModuleName: 'main',\n\tpushState: false,\n\tnamedParameters: false,\n\tautoloadModules: true,\n\tdebug: false,\n\tconfig: {},\n\tonModuleError: function() {},\n\tnowhereUrl: '___'\n};\n\nvar routerOptions = [\n\t'root', 'rootViewEl', 'modulesPath', 'defaultModuleName', 'pushState',\n\t'namedParameters', 'autoloadModules', 'debug', 'config', 'onModuleError',\n\t'nowhereUrl'\n];\n\n/*\n * Override `constructor`\n * @param {Object} [options]\n */\n\nRouter.constructor = function(options) {\n\toptions = options || {};\n\n\t// populate Router instance with fields from options\n\t_.extend(this, _.pick(options, routerOptions));\n\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\tthis.components = {};\n\tthis.componentsTree = null;\n\tthis.urlParams = {};\n\tthis.modules = {};\n\n\tthis.history = backbone.history;\n\n\t/*\n\t * All query parameters can be passed in a single hash using the key\n\t * referenced from the route definition (backbone queryparams will\n\t * do it for us)\n\t */\n\n\tbackbone.Router.namedParameters = this.namedParameters;\n\n\tbackbone.Router.apply(this, arguments);\n\n\tif (options.autoloadModules) {\n\t\tthis.route('*url', function(params) {\n\t\t\tthis.setModule(params);\n\t\t});\n\t}\n};\n\nRouter._initRootComponent = function() {\n\tvar RootView = View.extend({\n\t\tel: this.rootViewEl\n\t});\n\n\tthis.component({\n\t\tname: '',\n\t\tparent: null,\n\t\tView: RootView\n\t});\n};\n\nRouter._populateUrlParams = function(componentName, params) {\n\tvar urlParams = this.urlParams;\n\n\t// clean old values from urlParams object\n\tvar key;\n\tfor (key in urlParams) {\n\t\tif (_(urlParams).has(key)) {\n\t\t\tdelete urlParams[key];\n\t\t}\n\t}\n\n\tvar component = this.components[componentName];\n\n\t// populate urlParams with new params\n\treturn _(urlParams).extend(\n\t\t_(component).result('defaultUrlParams'),\n\t\tparams\n\t);\n};\n\n/*\n * Add component to router and bind it to url\n *\n * @param {Object} component\n */\n\n var componentOptions = [\n\t'url', 'name', 'parent', 'container', 'View', 'models', 'collections',\n\t'viewOptions', 'defaultUrlParams'\n];\n\nRouter.component = function(options) {\n\tvar router = this;\n\n\toptions = _({}).defaults(options, {\n\t\tparent: '',\n\t\tdefaultUrlParams: {},\n\t\tviewOptions: {},\n\t\tprocess: false\n\t});\n\n\tvar component = _(options).pick(componentOptions);\n\n\t// generate uniq component name if name is omitted\n\tif (_.isUndefined(component.name)) {\n\t\tcomponent.name = _.uniqueId('auto-named-component');\n\t}\n\n\tif (!_.isString(component.name)) {\n\t\tthrow new Error('Component `name` option should be a string');\n\t}\n\n\tif (component.name in this.components) {\n\t\tthrow new Error('Duplicate component with name \"' + component.name + '\"');\n\t}\n\n\tif (!component.View) {\n\t\tthrow new Error('Component `View` option is required');\n\t}\n\n\tif (!_.isString(component.parent) && !_.isNull(component.parent)) {\n\t\tthrow new Error('Component `parent` option should be a string or null');\n\t}\n\n\tthis.components[component.name] = component;\n\n\t// bind component to route\n\tif (!_.isUndefined(component.url)) {\n\t\tthis.route(component.url, component.name, function(params) {\n\t\t\trouter._populateUrlParams(component.name, params);\n\n\t\t\t// process components tree\n\t\t\trouter._processComponent(component.name);\n\t\t});\n\t}\n\n\t// process components tree in force mode\n\tif (options.process) {\n\t\tthis._processComponent(component.name);\n\t}\n\n\treturn this;\n};\n\nRouter._calculateComponentsTree = function(componentName, child) {\n\tvar component = this.components[componentName];\n\n\tif (!component) {\n\t\tthrow new Error('Unknown component with name \"' + componentName + '\"');\n\t}\n\n\tvar node = {name: componentName};\n\tif (child) {\n\t\tnode.child = child;\n\t}\n\n\tif (_.isString(component.parent)) {\n\t\treturn this._calculateComponentsTree(component.parent, node);\n\t} else {\n\t\treturn node;\n\t}\n};\n\nRouter._isComponentTreeNodeChanged = function(oldNode, node) {\n\tif (!oldNode || oldNode.name !== node.name || !oldNode.view) return true;\n\tvar component = this.components[node.name];\n\tif (oldNode.view instanceof component.View === false) return true;\n\tif (!oldNode.view.attached) return true;\n\treturn !oldNode.view.isUnchanged();\n};\n\nRouter._applyComponentsTree = function(params, callback) {\n\tvar self = this;\n\n\tvar parentNode = params.parentNode;\n\n\tvar iterateNode = function(oldNode, node) {\n\t\t// omit child field in new node because it will set recursive\n\t\t// and should not exist if error case\n\t\tvar childNode = node.child;\n\t\tdelete node.child;\n\n\t\tif (parentNode) {\n\t\t\tparentNode.child = node;\n\t\t} else {\n\t\t\tself.componentsTree = node;\n\t\t}\n\n\t\tif (childNode) {\n\t\t\tself._applyComponentsTree({\n\t\t\t\tparentNode: node,\n\t\t\t\toldNode: oldNode && oldNode.child || null,\n\t\t\t\tnode: childNode\n\t\t\t}, callback);\n\t\t} else {\n\t\t\tcallback();\n\t\t}\n\t};\n\n\tvar node = params.node;\n\tvar oldNode = params.oldNode;\n\tvar component = this.components[node.name];\n\n\tvar onViewResolve = function(view) {\n\t\tnode.view = view;\n\t\tview.setData();\n\n\t\tif (component.container) {\n\t\t\tif (!parentNode) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Parent component should exist for component with `container` option'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tparentNode.view\n\t\t\t\t.setView(view, component.container)\n\t\t\t\t.renderViews()\n\t\t\t\t.attachViews();\n\t\t} else {\n\t\t\tview.render();\n\t\t}\n\n\t\t// stop processing old components tree\n\t\titerateNode(null, node);\n\t};\n\n\t// get view from old node\n\tvar oldView = oldNode && oldNode.view;\n\n\tif (this._isComponentTreeNodeChanged(oldNode, node)) {\n\t\tif (oldView) {\n\t\t\tif (oldView.container) {\n\t\t\t\t// remove old view if container for new view dirrent\n\t\t\t\tif (!component.container || oldView.container !== component.container) {\n\t\t\t\t\toldView.remove();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// detach old view if it has not a container\n\t\t\t\toldView.detach();\n\t\t\t}\n\t\t}\n\n\t\t// create new view\n\t\tvar view = new (component.View)(\n\t\t\t_(component)\n\t\t\t\t.chain()\n\t\t\t\t.pick('models', 'collections')\n\t\t\t\t.defaults(_(component).result('viewOptions'))\n\t\t\t\t.extend({router: this})\n\t\t\t\t.value()\n\t\t);\n\n\t\tif (view.waiting) {\n\t\t\t// wait when view will be resolved\n\t\t\tview.once('resolve', function() {\n\t\t\t\tonViewResolve(view);\n\t\t\t});\n\t\t} else {\n\t\t\tonViewResolve(view);\n\t\t}\n\t} else {\n\t\t// get old child view if exists\n\t\tvar oldChildView = oldNode.child && oldNode.child.view;\n\n\t\t// temporary remove child node view from container\n\t\t// to prevent recursive renderViews\n\t\tvar oldChildViewContainer;\n\t\tif (oldChildView) {\n\t\t\toldChildViewContainer = oldChildView.container;\n\n\t\t\tif (oldChildViewContainer) {\n\t\t\t\toldView.removeView(oldChildView, oldChildViewContainer);\n\t\t\t}\n\t\t}\n\n\t\t// save old view to new node\n\t\tnode.view = oldView;\n\n\t\t// set data and re-render old view\n\t\toldView.setData();\n\t\toldView.render();\n\n\t\t// revert child node view\n\t\tif (oldChildView && oldChildViewContainer) {\n\t\t\toldView.setView(oldChildView, oldChildViewContainer);\n\t\t}\n\n\t\t// proprocessing old components tree\n\t\titerateNode(oldNode, node);\n\t}\n};\n\nRouter._processComponent = function(componentName, callback) {\n\tcallback = callback || _.noop;\n\n\tvar newComponentsTree = this._calculateComponentsTree(componentName);\n\n\tthis._applyComponentsTree({\n\t\tparentNode: null,\n\t\toldNode: this.componentsTree,\n\t\tnode: newComponentsTree\n\t}, callback);\n};\n\n/*\n * Override `route` to add middleware processing functionality\n */\n\nRouter.route = function(url, name, callback) {\n\tvar router = this;\n\n\tif (_.isFunction(name)) {\n\t\tcallback = name;\n\t\tname = '';\n\t}\n\n\tbackbone.Router.prototype.route.call(this, url, name, function() {\n\t\tvar args = arguments;\n\n\t\trouter._defaultMiddleware({\n\t\t\turl: url,\n\t\t\tname: name,\n\t\t\tcallback: callback\n\t\t}, function() {\n\t\t\tcallback.apply(router, args);\n\t\t});\n\t});\n};\n\n/*\n * Override `navigate`\n * @param {String} fragment\n * @param {Object} [options] - hash of params\n * @param {Object} [options.qs] - query string hash\n */\n\nRouter.navigate = function(fragment, options) {\n\toptions = options || {};\n\n\tif (fragment.indexOf(this.root) === 0) {\n\t\tfragment = fragment.substring(this.root.length);\n\t}\n\n\t// force to go to the selected fragment even if we currently on it\n\tif (options.force) {\n\t\tthis.navigate(this.nowhereUrl, {\n\t\t\treplace: options.replace,\n\t\t\ttrigger: false\n\t\t});\n\n\t\toptions = _(options).chain().omit('force').extend({replace: true}).value();\n\n\t\treturn this.navigate(fragment, options);\n\t}\n\n\t// set `trigger` to true by default\n\toptions = _(options || {}).defaults({\n\t\ttrigger: true,\n\t\tparams: {}\n\t});\n\n\t// add support of query string using `toFragment` from backbone.queryparams\n\tvar qs = options.qs;\n\n\tif (this.toFragment && qs) {\n\t\t// reject undefined and null qs parameters\n\t\t_(qs).each(function(val, key, qs) {\n\t\t\tif (val === undefined || val === null) delete qs[key];\n\t\t});\n\n\t\tfragment = this.toFragment(fragment, qs);\n\n\t\tdelete options.qs;\n\t}\n\n\tbackbone.Router.prototype.navigate.call(this, fragment, options);\n};\n\n\n/*\n * Default middleware function\n */\n\nRouter._defaultMiddleware = function(route, next) {\n\tnext();\n};\n\n/**\n * Use passed function as `middleware`\n *\n * @param {Function} middleware - middleware function,\n * `route` and `next` will be passed as arguments.\n * context (`this`) is link to the router object.\n */\n\nRouter.middleware = function(middleware) {\n\tvar router = this;\n\n\tvar defaultMiddleware = this._defaultMiddleware;\n\n\tthis._defaultMiddleware = function(route, next) {\n\t\tdefaultMiddleware.call(router, route, function() {\n\t\t\tmiddleware.call(router, route, next);\n\t\t});\n\t};\n\n\treturn this;\n};\n\n/*\n * Require module file and init it\n * @param {String} params.url Url without query string\n */\n\nRouter.setModule = function(params) {\n\tvar router = this;\n\n\tvar url = params.url;\n\tdelete params.url;\n\n\tvar moduleName = _(url.split('/')).find(_.identity) || this.defaultModuleName;\n\n\t// require module file\n\trequire([this.modulesPath + moduleName], function(moduleInit) {\n\t\t// if module is loaded first time\n\t\tif (!router.modules[moduleName]) {\n\t\t\t// init it\n\t\t\tmoduleInit(router);\n\n\t\t\t// set module init flag to true\n\t\t\trouter.modules[moduleName] = true;\n\n\t\t\t// and navigate again with force flag\n\t\t\trouter.navigate(url, {\n\t\t\t\treplace: true,\n\t\t\t\tforce: true,\n\t\t\t\tqs: params\n\t\t\t});\n\t\t}\n\t}, this.onModuleError);\n};\n\n/*\n * Start routes handling\n */\n\nRouter.start = function() {\n\tthis._initRootComponent();\n\n\tbackbone.history.start({\n\t\tpushState: this.pushState,\n\t\troot: this.root\n\t});\n};\n\nmodule.exports = backbone.Router.extend(Router);\n","'use strict';\n\nvar _ = require('underscore');\nvar backbone = require('backbone');\n\n/*\n * Take jquery or other selectors lib from backbone\n */\n\nvar $ = backbone.$;\n\n/*\n * Helpers\n */\n\nvar splice = Array.prototype.splice;\n\n/*\n * Cached regex to split keys for `delegate`.\n */\n\nvar delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\n\nvar nestedEventTypes = ['views', 'collections', 'models'];\n\n/*\n * Base View class extend backbone View class\n */\n\nvar View = {\n\t/*\n\t * Helpers (Object|Fuction) which will be passed to the template\n\t */\n\n\ttemplateHelpers: {}\n};\n\nvar viewOptions = [\n\t'models', 'collections', 'views', 'events', 'data', 'router',\n\t'templateHelpers'\n];\n\n/*\n * @override constructor\n *\n * @param {Object} [options]\n */\n\nView.constructor = function(options) {\n\tvar self = this;\n\n\toptions = options || {};\n\n\t// nested views hash is empty by default\n\tthis.views = {};\n\n\tthis.data = this.data || {};\n\n\t// populate View instance with fields from options\n\t_.extend(this, _.pick(options, viewOptions));\n\t// save original options, it is sometimes usefull\n\tthis.options = options;\n\n\tif (this.template && !_.isFunction(this.template)) {\n\t\tthrow new Error('View `template` option should be a function');\n\t}\n\n\t// normalize nested views hash\n\tthis._normalizeViews();\n\n\t// create special hash for all events for fast search\n\tthis._prepareNestedEvents();\n\n\t// views are in the resolved state by default\n\tthis.waiting = false;\n\n\t// views are not attached by default\n\tthis.attached = false;\n\n\t// apply default backbone.View constructor\n\tbackbone.View.apply(this, arguments);\n\n\t// we should delegate events after constructor call because collections and\n\t// models was created in the initialize method\n\n\t// delegate events for each collection\n\tif (this.collections) {\n\t\t_(this.collections).each(function(collection, key) {\n\t\t\tself.delegateNestedEvents('collections', key, collection);\n\t\t});\n\t}\n\n\t// delegate events for each model\n\tif (this.models) {\n\t\t_(this.models).each(function(model, key) {\n\t\t\tself.delegateNestedEvents('models', key, model);\n\t\t});\n\t}\n};\n\n/*\n * Method to change view data.\n * Router calls this method to update view data.\n *\n * @param {Object} [data]\n */\n\nView.setData = function(data) {\n\tif (data) this.data = data;\n};\n\n/*\n * Method to check that view is changed and should be re-rendered\n * Returns true by default, override this method for specific logic\n */\n\nView.isUnchanged = function() {\n\treturn true;\n};\n\n/*\n * Method to switch view to waiting state\n */\n\nView.wait = function() {\n\tvar self = this;\n\tthis.waiting = true;\n\n\treturn function() {\n\t\tself.waiting = false;\n\t\tself.trigger('resolve');\n\t};\n};\n\n/*\n * @override `render`\n */\n\nView.render = function(options) {\n\tconsole.log('>>>      render: %o %o', this, this.$el)\n\n\t// stop rendering if view in `waiting` state, resolve it first\n\tif (this.waiting) return this;\n\n\toptions = options || {};\n\n\tif (this.template) {\n\t\t// re-render template only if it exists and if it is necessary\n\t\tif (options.force || !this.attached || !this.isUnchanged()) {\n\t\t\t// detach view from DOM element\n\t\t\tthis.detach();\n\n\t\t\t// render template with data\n\t\t\tvar html = this.renderTemplate(this.template, this.getTemplateData());\n\n\t\t\t// render html with jqeury (or other lib) call\n\t\t\tvar $el = $(html);\n\n\t\t\tif (!$el.length) {\n\t\t\t\tthrow new Error('View template produce empty html');\n\t\t\t}\n\n\t\t\tif ($el.length > 1) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'View template produce html with more than one root elements'\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.setElement($el);\n\t\t}\n\t} else {\n\t\t// re-ensure element if it is not ensured\n\t\tif (!this.$el.length) this._ensureElement();\n\t}\n\n\t// render nested views\n\tthis.renderViews(options);\n\n\tif (!this.parent || this.$container) {\n\t\t// attach all nested views first\n\t\tthis.attachViews();\n\n\t\t// attach current view\n\t\tthis.attach();\n\t}\n\n\t// return this for chaining\n\treturn this;\n};\n\n/*\n * Get data for template rendering\n */\n\nView.getTemplateData = function() {\n\treturn this.data;\n};\n\n/*\n * Render template with data. Returns html.\n *\n * @param {function} template for rendering\n * @params {object} data for rendering\n */\n\nView.renderTemplate = function(template, data) {\n\tdata = _(this).chain().result('templateHelpers').extend(data).value();\n\n\t// get html\n\treturn template(data);\n};\n\n/*\n * Render all nested view\n*/\n\nView.renderViews = function(options) {\n\tconsole.log('>>> renderViews: %o %o', this, this.$el)\n\n\tvar self = this;\n\n\t// iterate by each views group\n\t_(this.views).each(function(viewsGroup, container) {\n\t\t// return if view group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call render for each views from view group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\tview.render(options);\n\t\t});\n\n\t\t// get first container or $el\n\t\tvar $container = container ? self.$(container).first() : self.$el;\n\n\t\tif (!$container.length) {\n\t\t\tthrow new Error('Container \"' + container + '\" is not found');\n\t\t}\n\n\t\tvar containerEl = $container.get(0);\n\n\t\t// dom is changed if some view from group is not in current container\n\t\tvar domChanged = _(viewsGroup).some(function(view) {\n\t\t\treturn (\n\t\t\t\t!view.attached ||\n\t\t\t\t!view.$container ||\n\t\t\t\tview.$container.get(0) !== containerEl\n\t\t\t);\n\t\t});\n\n\t\tif (domChanged) {\n\t\t\t// re-append views group to container\n\t\t\tvar $els = [];\n\n\t\t\t_(viewsGroup).each(function(view) {\n\t\t\t\tview.$container = $container;\n\t\t\t\t$els.push(view.$el);\n\t\t\t});\n\n\t\t\t// @TODO: add some rendering optimizations here\n\n\t\t\t// put all views to $container\n\t\t\t$container.append($els);\n\t\t}\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/*\n * Set view to views group or replace some view in specified position\n * If index is passed it replace only one view with index in views group\n *\n * @param {View} view - view to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n */\n\nView.setView = function(view, container, index) {\n\treturn this._updateViews([view], container, index);\n};\n\n/*\n * Set views to views group or replace some view in specified position\n * If index is passed it replace only one view with index in views group\n *\n * @param {View[]} views - views to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n */\n\nView.setViews = function(views, container, index) {\n\treturn this._updateViews(views, container, index);\n};\n\n/*\n * Alias for setView\n *\n * @param {View} view - view to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n */\n\nView.replaceView = function(view, container, index) {\n\treturn this._updateViews([view], container, index);\n};\n\n/*\n * Alias for setViews\n *\n * @param {View[]} views - views to set\n * @param {String} container - container to set\n * @param {Number} [index] - index of view to replace\n */\n\nView.replaceViews = function(views, container, index) {\n\treturn this._updateViews(views, container, index);\n};\n\n/*\n * Append view to end of views group\n * This method is alias for insertView without index argument\n *\n * @param {View} view - view to append\n * @param {String} container - container of views group\n */\n\nView.appendView = function(view, container) {\n\treturn this._insertViews([view], container);\n};\n\n/*\n * Append views to end of views group\n * This method is alias for insertViews without index argument\n *\n * @param {View[]} views - views to append\n * @param {String} container - container of views group\n */\n\nView.appendViews = function(views, container) {\n\treturn this._insertViews(views, container);\n};\n\n/*\n * Prepend view to start of views group\n * This method is alias for insertView with `0` as index argument value\n *\n * @param {View} views - view to prepend\n * @param {String} container - container of views group\n */\n\nView.prependView = function(view, container) {\n\treturn this._insertViews([view], container, 0);\n};\n\n/*\n * Prepend views to start of views group\n * This method is alias for insertViews with `0` as index argument value\n *\n * @param {View[]} views - view to prepend\n * @param {String} container - container of views group\n */\n\nView.prependViews = function(views, container) {\n\treturn this._insertViews(views, container, 0);\n};\n\n/*\n * Insert view to specified position of views group\n * If index is not passed method insert view to the end of views group (append)\n *\n * @param {View} view - view to insert\n * @param {String} container - container of views group\n * @param {Number} [index] - position in views group\n */\n\nView.insertView = function(view, container, index) {\n\treturn this._insertViews([view], container, index);\n};\n\n/*\n * Insert views to specified position of views group\n * If index is not passed method insert views to the end of views group (append)\n *\n * @param {View[]} views - views to insert\n * @param {String} container - container of views group\n * @param {Number} [index] - position in views group\n */\n\nView.insertViews = function(views, container, index) {\n\treturn this._insertViews(views, container, index);\n};\n\n/*\n * Remove view from views group by index or view instance\n * If index is passed it remove view in the index position\n *\n * @param {View} [view] - view to remove\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in views group\n */\n\nView.removeView = function(view, container, index) {\n\tif (arguments.length < 2) {\n\t\tthrow new Error('\"view\" or \"index\" arguments must be specified');\n\t}\n\n\tif (_.isString(view)) {\n\t\tindex = container;\n\t\tcontainer = view;\n\t\tview = this.getView(container, index);\n\t\tif (!view) return this;\n\t}\n\n\treturn this._removeViews([view], container);\n};\n\n/*\n * Remove views from views group\n * If views are passed remove only these views\n * Othervise remove all views from container\n *\n * @param {View[]} [views] - views to remove\n * @param {String} container - container of views group\n */\n\nView.removeViews = function(views, container) {\n\tif (_.isString(views)) {\n\t\tcontainer = views;\n\t\tviews = this.getViews(container);\n\t}\n\n\treturn this._removeViews(views, container);\n};\n\n/*\n * Get single view by container and index\n *\n * @param {String} container - container of views group\n * @param {Number} [index] - index of view in views group\n */\n\nView.getView = function(container, index) {\n\treturn this.getViews(container)[index || 0] || null;\n};\n\n/*\n * Get views group by container\n *\n * @param {String} container - container of views group\n */\n\nView.getViews = function(container) {\n\treturn _.clone(this.views[container]) || [];\n};\n\nView._insertViews = function(views, container, index) {\n\tconsole.log('>>> _insertViews:', views, container, index)\n\n\tvar self = this;\n\n\tvar viewsGroup = this.getViews(container);\n\n\t_(views).each(function(view) {\n\t\tif (view.parent) {\n\t\t\tview.parent.removeView(view, view.container);\n\t\t}\n\t});\n\n\tif (viewsGroup.length) {\n\t\t// if index is not specified set it value as last index of views group\n\t\tif (typeof index === 'undefined') {\n\t\t\tindex = viewsGroup.length;\n\t\t}\n\n\t\t// insert views\n\t\tsplice.apply(this.views[container], [index, 0].concat(views));\n\t} else {\n\t\t// if group is empty - set views as whole views group value\n\t\tthis.views[container] = views;\n\t}\n\n\t// set each view parent to current\n\t_(views).each(function(view) {\n\t\tview.parent = self;\n\t\tview.container = container;\n\t});\n\n\tthis.delegateNestedEvents('views', container, views);\n\n\treturn this;\n};\n\nView._updateViews = function(views, container, index) {\n\tconsole.log('>>> _updateViews:', views, container, index)\n\n\tvar viewsGroup = this.getViews(container);\n\n\tif (viewsGroup.length) {\n\t\tvar removedViews = [];\n\n\t\t// if views group is not empty\n\t\tif (typeof index !== 'undefined') {\n\t\t\t// if index is specified\n\t\t\t// remove view from specific position\n\t\t\tremovedViews = this.getView(container, index);\n\t\t\tremovedViews = removedViews ? [removedViews] : [];\n\t\t} else {\n\t\t\t// if no index - remove all views from views group\n\t\t\tremovedViews = viewsGroup;\n\t\t}\n\n\t\tif (removedViews.length) {\n\t\t\t// if remove views array is not empty\n\t\t\t// remove from parent\n\t\t\tthis._removeViews(removedViews, container);\n\n\t\t\t// and remove views\n\t\t\t_(removedViews).each(function(view) {\n\t\t\t\tview.remove();\n\t\t\t});\n\t\t}\n\t}\n\n\t// insert new views\n\treturn this._insertViews(views, container, index);\n};\n\nView._removeViews = function(views, container) {\n\tconsole.log('>>> _removeViews:', views, container)\n\n\tvar self = this;\n\n\tvar viewsGroup = this.getViews(container);\n\n\tif (!viewsGroup.length) return this;\n\n\tvar viewObjs = _.chain(views).uniq().map(function(view) {\n\t\t\treturn {\n\t\t\t\tview: view,\n\t\t\t\tindex: _.indexOf(viewsGroup, view)\n\t\t\t};\n\t\t}).filter(function(viewObj) {\n\t\t\treturn viewObj.index >= 0;\n\t\t}).sortBy(function(viewObj) {\n\t\t\treturn -viewObj.index;\n\t\t}).value();\n\n\tif (!viewObjs.length) return this;\n\n\t_(viewObjs).each(function(viewObj) {\n\t\tvar view = viewObj.view;\n\n\t\t// remove item from group\n\t\tsplice.call(self.views[container], viewObj.index, 1);\n\n\t\t// undelegate all nested entity events\n\t\tself.undelegateNestedEvents(view);\n\n\t\t// unset view parent\n\t\tdelete view.parent;\n\t});\n\n\treturn this;\n};\n\n/*\n * @override setElement\n * Original setElement do undelegateEvents/delegateEvents, we remove it\n * because we have special detach/attach methods for this\n */\n\nView.setElement = function(element) {\n\tvar $previousEl = this.$el;\n\n\tthis._setElement(element);\n\n\t// insert html to $el\n\tif ($previousEl && this.$container) {\n\t\t$previousEl.replaceWith(this.$el);\n\t}\n\n\treturn this;\n};\n\n/*\n * @override delegateEvents\n */\n\nView.delegateEvents = function(events) {\n\tevents = events || _.result(this, 'events');\n\tif (!events) return this;\n\tevents = _(events).omit(nestedEventTypes);\n\treturn backbone.View.prototype.delegateEvents.call(this, events);\n};\n\nView.delegateNestedEvents = function(type, key, entities) {\n\tvar self = this;\n\tif (!_.isArray(entities)) entities = [entities];\n\tvar listeners = this._nestedEventsHash[type][key];\n\tif (listeners) {\n\t\t_(listeners).each(function(listener) {\n\t\t\t_(entities).each(function(entity) {\n\t\t\t\tself.listenTo(entity, listener.eventName, listener.handler);\n\t\t\t});\n\t\t});\n\t}\n\treturn this;\n};\n\nView.undelegateNestedEvents = function(entities) {\n\tvar self = this;\n\tif (!_.isArray(entities)) entities = [entities];\n\t_(entities).each(function(entity) {\n\t\tself.stopListening(entity);\n\t});\n\treturn this;\n};\n\nView._prepareNestedEvents = function(events) {\n\tvar self = this;\n\n\t// Hash for nested views events fast search\n\tthis._nestedEventsHash = {};\n\t_(nestedEventTypes).each(function(type) {\n\t\tself._nestedEventsHash[type] = {};\n\t});\n\n\tevents = events || _.result(this, 'events');\n\tif (!events) return;\n\n\t// bind all prefixed events to view then call native delegate events\n\t_(nestedEventTypes).each(function(type) {\n\t\tvar typeEventsHash = self._nestedEventsHash[type];\n\n\t\tif (!_(events).has(type) || !_.isObject(events[type])) return;\n\n\t\t_(events[type]).each(function(method, key) {\n\t\t\tif (!_.isFunction(method)) method = self[method];\n\t\t\tif (!method) return;\n\t\t\tvar match = key.match(delegateEventSplitter);\n\t\t\tvar eventName = match[1];\n\t\t\tvar entityKeys = match[2].replace(/ *, */g, ',').split(',');\n\t\t\tmethod = _.bind(method, self);\n\n\t\t\t// fill _nestedEventsHash\n\t\t\t_(entityKeys).each(function(entityKey) {\n\t\t\t\ttypeEventsHash[entityKey] = typeEventsHash[entityKey] || [];\n\t\t\t\ttypeEventsHash[entityKey].push({\n\t\t\t\t\teventName: eventName,\n\t\t\t\t\thandler: method\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n};\n\n/*\n * Wrap all non-array view groups to arrays with one element\n */\n\nView._normalizeViews = function() {\n\tvar self = this;\n\n\t_(this.views).each(function(views, container) {\n\t\tif (!_.isArray(views)) {\n\t\t\tself.views[container] = [views];\n\t\t}\n\t});\n};\n\nView.attachViews = function() {\n\t// iterate by each nested views groups\n\t_(this.views).each(function(viewsGroup) {\n\t\t// return if views group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call attach method for each nested view from views group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\t// recursive attach all nested views\n\t\t\tview.attachViews();\n\n\t\t\t// attach current view\n\t\t\tview.attach();\n\t\t});\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/*\n * afterAttach is empty by default.\n * It called after attach call\n * Override it to add some specific logic for DOM manipulations.\n */\n\nView.afterAttach = function() {\n\treturn this;\n};\n\n/*\n * Detach all previous views and attach new view to current view $el\n */\n\nView.attach = function() {\n\t// return if current view is already attached\n\tif (this.attached) return this;\n\n\t// detach previous view\n\tvar previousView = this.$el.data('esencia-view');\n\tif (previousView) previousView.detach();\n\n\t// attach current view and set attr\n\tthis.$el.data('esencia-view', this).attr('esencia-view', this.cid);\n\n\t// enable all DOM events\n\tthis.delegateEvents();\n\n\tthis.attached = true;\n\n\t// do some user afterAttach actions\n\tconsole.log('>>>      attach: %o %o', this, this.$el)\n\tthis.afterAttach();\n\n\treturn this;\n};\n\nView.detachViews = function() {\n\t// iterate by each views groups\n\t_(this.views).each(function(viewsGroup) {\n\t\t// return if views group is empty\n\t\tif (!viewsGroup.length) return;\n\n\t\t// call detach method for each nested view from views group\n\t\t_(viewsGroup).each(function(view) {\n\t\t\t// recursive detach all nested views\n\t\t\tview.detachViews();\n\n\t\t\t// detach current view\n\t\t\tview.detach();\n\t\t});\n\t});\n\n\t// return this for chaining\n\treturn this;\n};\n\n/*\n * beforeDetach is empty by default.\n * It called before detach calls\n * Override it to add some specific logic before view detach from dom.\n */\n\nView.beforeDetach = function() {\n\treturn this;\n};\n\n/*\n * Detach view from current view $el\n */\n\nView.detach = function() {\n\t// return if current view is not already attached\n\tif (!this.attached) return this;\n\n\t// do some user beforeDetach actions\n\tconsole.log('>>>      detach: %o %o', this, this.$el)\n\tthis.beforeDetach();\n\n\t// remove attr and data from $el\n\tthis.$el.removeData('esencia-view').removeAttr('esencia-view');\n\n\t// disable all DOM events\n\tthis.undelegateEvents();\n\n\tthis.attached = false;\n\n\t// return this for chaining\n\treturn this;\n};\n\nView.remove = function() {\n\t// remove current view from parent view container\n\tif (this.parent) {\n\t\tthis.parent.removeView(this, this.container);\n\t}\n\n\t// detach all nested views first\n\tthis.detachViews();\n\n\t// detach current view\n\tthis.detach();\n\n\t// remove DOM element\n\treturn backbone.View.prototype.remove.call(this);\n};\n\n/*\n * Get view, that attached to closest element with attr `esencia-view`\n *\n * @param {String | $} selector\n */\n\nView.getClosestView = function(selector) {\n\tvar $selector = $(selector);\n\n\tif (!$selector.is('[esencia-view]')) {\n\t\t$selector = $selector.closest('[esencia-view]');\n\t}\n\n\treturn $selector.length ? $selector.data('esencia-view') : null;\n};\n\nmodule.exports = backbone.View.extend(View);\n"]}