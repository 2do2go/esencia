!function(e){"function"==typeof define&&define.amd?define(["underscore","backbone"],e):"object"==typeof exports?module.exports=e(require("underscore"),require("backbone")):this.Esencia.View=e(_,Backbone)}(function(e,t){function i(e){var t=i.cache[e];if(!t){var n={};t=i.cache[e]={id:e,exports:n},i.modules[e].call(n,t,n)}return t.exports}return i.cache=[],i.modules=[function(e,t){"use strict";var n=i(2),s=i(1),r=s.$,a=Array.prototype.splice,h=/^(\S+)\s*(.*)$/,c=["views","collections","models"],o={templateHelpers:{}},u=["models","collections","views","events","data","router","templateHelpers"];o.wait=function(){var e=this;return this._waiting=!0,function(){e._waiting=!1,e.trigger("resolve")}},o.isWaiting=function(){return this._waiting},o.constructor=function(e){var t=this;if(e=e||{},this.views={},this.data=this.data||{},n.extend(this,n.pick(e,u)),this.options=e,this.template&&!n.isFunction(this.template))throw new Error("View `template` option should be a function");this._normalizeViews(),this._prepareNestedEvents(),this._waiting=!1,s.View.apply(this,arguments),this.collections&&n(this.collections).each(function(e,i){t.delegateNestedEvents("collections",i,e)}),this.models&&n(this.models).each(function(e,i){t.delegateNestedEvents("models",i,e)})},o.setData=function(e){e&&(this.data=e)},o.isUnchanged=function(){return!0},o.render=function(e){return this.isWaiting()?this:(e=e||{},!this.template||!e.force&&this.isAttached()&&this.isUnchanged()||(this._createTemplateElement(),this._isAfterAttachNeeded=!0),this.attach(),this.renderViews(e),this.$el.parent().length&&this._afterAttachViews(),this)},o.getTemplateData=function(){return this.data},o.renderTemplate=function(e,t){return t=n(this).chain().result("templateHelpers").extend(t).value(),e(t)},o._createTemplateElement=function(){var e=this.getTemplateData(),t=this.renderTemplate(this.template,e),i=r(t);i.length>1;var n=i.first();return this.$el.parent().length&&this.$el.replaceWith(n),this.setElement(n,!0),this},o.renderViews=function(e){var t=this;n(this.views).each(function(i,s){if(i.length){n(i).each(function(t){t.render(e)});var r=s?t.$(s).first():t.$el;if(!r.length)throw new Error('Container "'+s+'" is not found');n(i).some(function(e){return!e.isAttached()||!r.is(e.$el.parent())})&&r.append(n(i).pluck("$el"))}})},o.setView=o.setViews=function(e,t,i){return this._updateViews("set",e,t,i)},o.replaceView=o.replaceViews=function(e,t,i){return this.setViews.apply(this,arguments)},o.appendView=o.appendViews=function(e,t){return this.insertViews(e,t)},o.prependView=o.prependViews=function(e,t){return this.insertViews(e,t,0)},o.insertView=o.insertViews=function(e,t,i){return this._updateViews("insert",e,t,i)},o.removeView=o.removeViews=function(e,t,i){if(arguments.length<2)throw new Error('"views" or "index" arguments must be specified');return n.isString(e)&&(i=t,t=e,e=this.getView(t,i),!e)?this:this._updateViews("remove",e,t)},o.getView=function(e,t){return this.getViews(e)[t||0]||null},o.getViews=function(e){return n.clone(this.views[e])||[]},o._updateViews=function(e,t,i,s){var r=this;if(!t)throw new Error('"views" argument must be specified');n.isArray(t)||(t=[t]);var h=this.getViews(i);switch(e){case"set":if(h.length){var c=[];"undefined"!=typeof s?(c=this.getView(i,s),c=c?[c]:[]):c=h,c.length&&(this._updateViews("remove",c,i),n(c).each(function(e){e.remove()}))}this._updateViews("insert",t,i,s);break;case"insert":n(t).each(function(e){e.parent&&e.parent.removeView(e,e.container)}),h.length?("undefined"==typeof s&&(s=h.length),a.apply(this.views[i],[s,0].concat(t))):this.views[i]=t,n(t).each(function(e){e.parent=r,e.container=i}),this.delegateNestedEvents("views",i,t);break;case"remove":if(!h.length)break;var o=n.chain(t).uniq().map(function(e){return{view:e,index:n.indexOf(h,e)}}).filter(function(e){return e.index>=0}).sortBy(function(e){return-e.index}).value();if(!o.length)break;n(o).each(function(e){var t=e.view;a.call(r.views[i],e.index,1),r.undelegateNestedEvents(t),delete t.parent})}return this},o.delegateEvents=function(e){return(e=e||n.result(this,"events"))?(e=n(e).omit(c),s.View.prototype.delegateEvents.call(this,e)):this},o.delegateNestedEvents=function(e,t,i){var s=this;n.isArray(i)||(i=[i]);var r=this._nestedEventsHash[e][t];return r&&n(r).each(function(e){n(i).each(function(t){s.listenTo(t,e.eventName,e.handler)})}),this},o.undelegateNestedEvents=function(e){var t=this;return n.isArray(e)||(e=[e]),n(e).each(function(e){t.stopListening(e)}),this},o._prepareNestedEvents=function(e){var t=this;this._nestedEventsHash={},n(c).each(function(e){t._nestedEventsHash[e]={}}),e=e||n.result(this,"events"),e&&n(c).each(function(i){var s=t._nestedEventsHash[i];n(e).has(i)&&n.isObject(e[i])&&n(e[i]).each(function(e,i){if(n.isFunction(e)||(e=t[e]),e){var r=i.match(h),a=r[1],c=r[2].replace(/ *, */g,",").split(",");e=n.bind(e,t),n(c).each(function(t){s[t]=s[t]||[],s[t].push({eventName:a,handler:e})})}})})},o._normalizeViews=function(){var e=this;n(this.views).each(function(t,i){n.isArray(t)||(e.views[i]=[t])})},o.isAttached=function(){var e=this.$el.data("esencia-view");return Boolean(e&&e===this)},o._afterAttachViews=function(){n(this.views).each(function(e){e.length&&n(e).each(function(e){e._afterAttachViews()})}),this._isAfterAttachNeeded&&(delete this._isAfterAttachNeeded,this.afterAttach())},o.afterAttach=function(){return this},o.attach=function(){if(this.isAttached())return this;var e=this.$el.data("esencia-view");return e&&e.detach(),this.$el.data("esencia-view",this).attr("esencia-view",this.cid),this},o._detachViews=function(){n(this.views).each(function(e){e.length&&n(e).each(function(e){e.detach()})})},o.beforeDetach=function(){return this},o.detach=function(){return this.isAttached()?(this._detachViews(),this.beforeDetach(),this.$el.removeData("esencia-view").removeAttr("esencia-view"),this.undelegateEvents(),this.stopListening(),this):this},o.remove=function(){return this.parent&&this.parent.removeView(this,this.container),this.detach(),this._removeElement(),this},o.getClosestView=function(e){var t=r(e);return t.is("[esencia-view]")||(t=t.closest("[esencia-view]")),t.length?t.data("esencia-view"):null},e.exports=s.View.extend(o)},function(e,i){e.exports=t},function(t,i){t.exports=e}],i(0)});
//# sourceMappingURL=view.min.js.map
